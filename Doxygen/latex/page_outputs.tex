\chapter{Code outputs }
\hypertarget{page_outputs}{}\label{page_outputs}\index{Code outputs@{Code outputs}}
 
    \textit{\scriptsize Footnotes are situated at the end of the chapter}


This page describes the various outputs that PB3D and POST can produce.

On the one hand, there are various text output files, which are discussed in section \doxysectlink{page_outputs_output_files}{Output Files}{1}.

Furthermore, a multitude of plots can be produced. This is the topic of section \doxysectlink{page_outputs_output_plots}{Output Plots}{1}.\hypertarget{page_outputs_output_files}{}\doxysection{\texorpdfstring{Output Files}{Output Files}}\label{page_outputs_output_files}
Some of these files are opened in open\+\_\+output(), but others are opened afterwards.\hypertarget{page_outputs_output_file_log}{}\doxysubsection{\texorpdfstring{Log file}{Log file}}\label{page_outputs_output_file_log}
Both PB3D and POST produce a log file, in addition to what is produced on the screen.

These log files are called {\ttfamily PB3\+D\+\_\+out.\+txt} and {\ttfamily POST\+\_\+out.\+txt} and they contain the same information as the output on the screen, but without the special formatting provided by the foul library (see \doxysectlink{page_installation_installation_introduction}{Introduction}{1}).\hypertarget{page_outputs_output_file_shell}{}\doxysubsection{\texorpdfstring{Shell commands file}{Shell commands file}}\label{page_outputs_output_file_shell}
Some output routines make use of use\+\_\+execute\+\_\+command\+\_\+line() in order to execute shell commands. This can be, for example, the creation of a plot by calling Gnu\+Plot, among other things.

However, this often does not work well by default (see \doxylink{page_inputs_fni30}{30} in \doxysectlink{page_inputs}{Input variables}{0}). In PB3D and POST, therefore, by default, these commands are not executed, but written to an output file. After execution of PB3D and POST has finished, this file can be made executed.

This behavior can be changed using the {\ttfamily --do\+\_\+execute\+\_\+command\+\_\+line} flag (see \doxysectlink{page_inputs}{Input variables}{0}).\hypertarget{page_outputs_output_file_HDF5}{}\doxysubsection{\texorpdfstring{HDF5 output file}{HDF5 output file}}\label{page_outputs_output_file_HDF5}
PB3D writes variables to an HDF5 output file during execution, as shown in table \doxytablelink{page_outputs_output_file_HDF5_tab}{1}. Note that there is a difference between the equilibrium styles because of the way how the equilibrium codes provide output:\+
\begin{DoxyItemize}
\item VMEC ({\ttfamily eq\+\_\+style = 1}) produces double Fourier series:\+
\begin{DoxyItemize}
\item This can be evaluated at arbitrary angular points.
\item In PB3D, the equilibrium and perturbation variables are therefore already calculated on the field-\/aligned grid.
\item Parallel integration can then be done directly.
\end{DoxyItemize}
\item HELENA ({\ttfamily eq\+\_\+style = 2}) produces 2-\/D tables for the poloidal cross-\/section.
\begin{DoxyItemize}
\item This needs to be interpolated along the magnetic field lines before parallel integration.
\item The equilibrium and perturbation variables are calculated first in the HELENA grid.
\end{DoxyItemize}
\end{DoxyItemize}

\hypertarget{page_outputs_output_file_HDF5_tab}{}

\begin{DoxyTable}{3}{Table 1. HDF5 output file}{page_outputs_output_file_HDF5_tab}{1}
\SetCell{bg=\tableheadbgcolor,font=\bfseries}variable type &\SetCell{bg=\tableheadbgcolor,font=\bfseries}VMEC ({\ttfamily eq\+\_\+style = 1}) &\SetCell{bg=\tableheadbgcolor,font=\bfseries}HELENA ({\ttfamily eq\+\_\+style = 2}) \\
\SetCell[r=1]{}inputs &\SetCell[c=2]{}in preliminary phase &\\
\SetCell[r=10]{}grids of \doxylink{structgrid__vars_1_1grid__type}{grid\+\_\+vars.\+grid\+\_\+type} &\SetCell[c=2]{c}{\bfseries{equilibrium}} &\\
&\SetCell[c=2]{}field-\/aligned-\/grid at every Richardson level&\\
&&also output HELENA grid at first Richardson level\\
&&used later for interpolation to field-\/aligned grid\\
&\SetCell[c=2]{c}{\bfseries{perturbation}} &\\
&\SetCell[c=2]{}field-\/aligned-\/grid at every Richardson level&\\
&&also output HELENA grid at first Richardson level\\
&&used later for interpolation to field-\/aligned grid\\
&\SetCell[c=2]{c}{\bfseries{solution}} &\\
&\SetCell[c=2]{}only at first Richardson level&\\
\SetCell[r=1]{}flux equilibria of \doxylink{structeq__vars_1_1eq__1__type}{eq\+\_\+vars.\+eq\+\_\+1\+\_\+type} &\SetCell[c=2]{}only at first Richardson level &\\
\SetCell[r=3]{}metric equilibria of \doxylink{structeq__vars_1_1eq__2__type}{eq\+\_\+vars.\+eq\+\_\+2\+\_\+type} &\SetCell[c=2]{}only at first Richardson level &\\
&&also output HELENA grid at first Richardson level\\
&&used later for interpolation to field-\/aligned grid\\
\SetCell[r=1]{}vacuums of \doxylink{structvac__vars_1_1vac__type}{vac\+\_\+vars.\+vac\+\_\+type} &at every Richardson level &only at first Richardson level \\
\SetCell[r=1]{}solutions of \doxylink{structsol__vars_1_1sol__type}{sol\+\_\+vars.\+sol\+\_\+type} &\SetCell[c=2]{}at every Richardson level &\\
\end{DoxyTable}


This data is used for Richardson restart (see variable {\ttfamily rich\+\_\+restart\+\_\+lvl} in \doxysectlink{page_inputs}{Input variables}{0}).

In the post-\/processing phase, POST reads this data as well.\hypertarget{page_outputs_output_file_EV}{}\doxysubsection{\texorpdfstring{Eigenvalue summary file}{Eigenvalue summary file}}\label{page_outputs_output_file_EV}
In each Richardson extrapolation level, after the solution of the eigenvalue system of equations, eigenvalues are stored in PB3D.
\begin{DoxyItemize}
\item For SLEPC, the results are saved in the procedure store\+\_\+results():\+
\begin{DoxyItemize}
\item If normalization is used, the normalization time scale is also stored.
\item If an unphysical complex eigenvalue is detected, this is indicated. See {\ttfamily option} retain\+\_\+all\+\_\+sol in \doxysectlink{page_inputs_inputs_PB3D_file}{Input file}{2}.
\end{DoxyItemize}
\end{DoxyItemize}\hypertarget{page_outputs_output_file_E_rec}{}\doxysubsection{\texorpdfstring{Energy reconstruction file}{Energy reconstruction file}}\label{page_outputs_output_file_E_rec}
If energy reconstruction is performed by POST (see {\ttfamily plot\+\_\+\+E\+\_\+rec} in \doxysectlink{page_inputs}{Input variables}{0}), the individual terms that make up the perturbed potential energy as well as the kinetic energy of the perturbation are calculated and plot. (\doxylink{page_outputs_fno3}{3}) Furthermore, the integration of these quantities over the whole volume, is returned in an output file.

In table \doxytablelink{page_outputs_e_rec_tab}{2}, an overview is given of the different terms. Here, $\rho$ is the density, $\sigma = \frac{\vec{B}\cdot\vec{J}}{B^2}$ is the parallel current and $\kappa = \frac{\vec{B}}{B} \cdot \nabla \frac{\vec{B}}{B}$ is the magnetic curvature. See calc\+\_\+e().

\hypertarget{page_outputs_e_rec_tab}{}

\begin{DoxyTable}{2}{Table 2. energy reconstruction}{page_outputs_e_rec_tab}{1}
\SetCell{bg=\tableheadbgcolor,font=\bfseries}potential energy $E_\text{pot}$ &\SetCell{bg=\tableheadbgcolor,font=\bfseries}kinetic energy $E_\text{kin}$ \\

\begin{DoxyItemize}
\item normal line bending term $\frac{1}{\left|\nabla\psi\right|^2 }\left(\frac{\nabla \psi}{\left|\nabla \psi\right|^2}\cdot \vec{Q}\right)^2$  
\item gedesic line bending term $\mathcal{J}^2\frac{\left|\nabla \psi\right|^2}{B^2} \left( \frac{\nabla \psi \times \vec{B}}{B^2}\cdot \vec{Q} \right)^2$  
\item normal ballooning term $-2 p\textnormal{\textquotesingle} \left(\nabla \psi \cdot \vec{\xi}\right)^2 \left(\nabla \psi \cdot \vec{\kappa}\right)$  
\item geodesic ballooning term $-2 p\textnormal{\textquotesingle} \left( \nabla \psi \cdot \vec{\xi} \right) \left( \frac{\nabla \psi \times \vec{B}}{\left|\nabla \psi \right|^2} \cdot \vec{\xi}\right)^* \left(\frac{\nabla \psi \times \vec{B}}{\left|\nabla \psi \right|^2} \cdot \vec{\kappa}\right)$  
\item normal kink term $-2 \sigma \left(\nabla \psi \cdot \vec{\xi}\right)^* \left(\frac{\nabla \psi \times \vec{B}}{B^2}\cdot \vec{Q} \right)$  
\item geodesic kink term $ 2 \sigma \left(\frac{\nabla \psi \times \vec{B}}{B^2} \cdot \vec{\xi}\right)^* \left(\nabla \psi\cdot \vec{Q} \right)$  
\end{DoxyItemize}&
\begin{DoxyItemize}
\item normal kinetic term $\frac{1}{\left|\nabla\psi\right|^2 }\left(\frac{\nabla \psi}{\left|\nabla \psi\right|^2}\cdot \vec{\xi}\right)^2$  
\item gedesic kinetic term $\mathcal{J}^2\frac{\left|\nabla \psi\right|^2}{B^2} \left( \frac{\nabla \psi \times \vec{B}}{B^2}\cdot \vec{\xi} \right)^2$  
\end{DoxyItemize}\\
\end{DoxyTable}
\hypertarget{page_outputs_output_file_mem}{}\doxysubsection{\texorpdfstring{Memory usage file}{Memory usage file}}\label{page_outputs_output_file_mem}
The memory usage of PB3D and POST can be monitored using the optional input argument {\ttfamily --mem\+\_\+info} (see \doxysectlink{page_inputs_inputs_PB3D_cmd}{Command-\/line inputs}{2}).

This is a rather crude implementation and more advance profiling methods should be used, such as \href{http://www.scalasca.org/}{\texttt{Scalasca}} on top of \href{http://www.vi-hps.org/projects/score-p/}{\texttt{Score-\/P}}.

\begin{DoxyNote}{Note}
Debug version only
\end{DoxyNote}
\hypertarget{page_outputs_output_plots}{}\doxysection{\texorpdfstring{Output Plots}{Output Plots}}\label{page_outputs_output_plots}
A multitude of plots can be produced by PB3D and POST.

POST can produce all the plots that PB3D can, and some more.

The plots themselves fall in two categories:\+
\begin{DoxyItemize}
\item Plots using an external program.
\begin{DoxyItemize}
\item Produced by \doxylink{interfaceoutput__ops_1_1print__ex__2d}{output\+\_\+ops.\+print\+\_\+ex\+\_\+2d()} or \doxylink{interfaceoutput__ops_1_1print__ex__3d}{output\+\_\+ops.\+print\+\_\+ex\+\_\+3d()} combined with draw\+\_\+ex().
\item A list of external programs is given in draw\+\_\+ex().
\item These plots require a shell command to be run, which is disabled by default and the commands are stored in a \doxysectlink{page_outputs_output_file_shell}{Shell commands file}{2}.
\item The produced plots can be 2-\/D or 3-\/D, and they can be interactive or not, depending on the {\ttfamily ex\+\_\+plot\+\_\+style} (see \doxysectlink{page_inputs}{Input variables}{0}).
\end{DoxyItemize}
\item Data files that can be used to produce plots with visualization software:\+
\begin{DoxyItemize}
\item The software used here was \href{https://visit.llnl.gov/}{\texttt{Vis\+It}}, based on personal preference, but \href{https://www.paraview.org/}{\texttt{Para\+View}} or other VTK-\/based solutions should work equally well.
\item Every plot creates two output files:\+ one heavy-\/data HDF5 file and one \href{www.xdmf.org/}{\texttt{XDMF}} file that contains specifics about the HDF5 file.
\item This is necessary, as HDF5 itself is too general a format for general visualization tools to interpret easily.
\item The XDMF file that accompanies each HDF5 file basically contains information about the saved variables, such as whether they are vectors or scalars, and on which grid type they are defined.
\item This is the file that should be opened by the visualzation software.
\item The dimensions of these plots can be 2-\/D or 3-\/D, depending on {\ttfamily eq\+\_\+style}. See \doxylink{page_inputs_fni19}{19} and \doxylink{page_inputs_fni20}{20} in \doxysectlink{page_inputs}{Input variables}{0}.
\end{DoxyItemize}
\end{DoxyItemize}

An overview of possible plots is now given in table \doxytablelink{page_outputs_output_plots_tab}{3}. The name of the respective input parameter is provided as well. See \doxysectlink{page_inputs}{Input variables}{0}.

\hypertarget{page_outputs_output_plots_tab}{}

\begin{DoxyTable}{3}{Table 3. possible plots}{page_outputs_output_plots_tab}{1}
\SetCell{bg=\tableheadbgcolor,font=\bfseries}plot type &\SetCell{bg=\tableheadbgcolor,font=\bfseries}external plot &\SetCell{bg=\tableheadbgcolor,font=\bfseries}HDF5 plot \\
\SetCell[r=1]{}flux quantities ({\ttfamily plot\+\_\+flux\+\_\+q}) &
\begin{DoxyItemize}
\item pressure $p$
\item poloidal flux $\Psi_\text{pol}$
\item toroidal flux $\Psi_\text{tor}$
\end{DoxyItemize}&
\begin{DoxyItemize}
\item safety factor $q$
\item rotational transform $\iota$
\item pressure $p$
\item poloidal flux $\Psi_\text{pol}$
\item toroidal flux $\Psi_\text{tor}$
\end{DoxyItemize}\\
\SetCell[r=1]{}resonance ({\ttfamily plot\+\_\+resonance}) &safety factor $q$ (poloidal flux) or rotational transform $\iota$ (toroidal flux) with the indication of the resonant flux surfaces (\doxylink{page_outputs_fno1}{1}) &surfaces of resonant values for safety factor $q$ (poloidal flux) or rotational transform $\iota$ (toroidal flux) (\doxylink{page_outputs_fno1}{1}) \\
\SetCell[r=1]{}magnetic grid ({\ttfamily plot\+\_\+magn\+\_\+grid}) &&magnetic grid lines in the magnetic flux surfaces, as a time collection \\
\SetCell[r=1]{}magnetic field $\vec{B}$ ({\ttfamily plot\+\_\+B}) &&co-\/ and contravariant components of magnetic field, as well as magnitude and vector plot \\
\SetCell[r=1]{}current density $\vec{J}$ ({\ttfamily plot\+\_\+J}) &&co-\/ and contravariant components of current density, as well as magnitude and vector plot \\
\SetCell[r=1]{}magnetic curvature $\vec{\kappa}$ ({\ttfamily plot\+\_\+kappa}) &&co-\/ and contravariant components of magnetic curvature, as well as magnitude and vector plot \\
\SetCell[r=1]{}solution normal mode $\vec{\xi}$ ({\ttfamily plot\+\_\+sol\+\_\+xi}) &&real and imaginary part and phase of perturbation of position, as well as vector plot \\
\SetCell[r=1]{}perturbated magnetic field due to solution normal mode $\vec{Q}$ ({\ttfamily plot\+\_\+sol\+\_\+Q}) &&real and imaginary part and phase of perturbation of magnetic field, as well as vector plot \\
\SetCell[r=1]{}energy reconstruction ({\ttfamily plot\+\_\+\+E\+\_\+rec}) &&different components of energy reconstruction, integrated as well as profiles (\doxylink{page_outputs_fno2}{2}) \\
\end{DoxyTable}


\begin{DoxyNote}{Note}

\begin{DoxyEnumerate}
\item \label{page_outputs_fno1}%
\Hypertarget{page_outputs_fno1}%
See {\ttfamily use\+\_\+pol\+\_\+flux\+\_\+F} in \doxysectlink{page_inputs}{Input variables}{0}.
\item \label{page_outputs_fno2}%
\Hypertarget{page_outputs_fno2}%
The integrated energy reconstruction terms are also output to a file. See \doxysectlink{page_outputs_output_file_E_rec}{Energy reconstruction file}{2}.
\item \label{page_outputs_fno3}%
\Hypertarget{page_outputs_fno3}%
Energy reconstruction only works well when {\ttfamily  POST\+\_\+style = 2 } is used, i.\+e. when the same grid is used as for PB3D. 
\end{DoxyEnumerate}
\end{DoxyNote}
