\doxysection{/\+\+Users/\+toonweyens/\+\+Code/\+\+PB3\+D/\+\+Modules/\+grid\+\_\+ops.f90 File Reference}
\hypertarget{grid__ops_8f90}{}\label{grid__ops_8f90}\index{/Users/toonweyens/Code/PB3D/Modules/grid\_ops.f90@{/Users/toonweyens/Code/PB3D/Modules/grid\_ops.f90}}
\doxysubsubsection*{Modules}
\begin{DoxyCompactItemize}
\item 
module \doxymbox{\hyperlink{namespacegrid__ops}{grid\+\_\+ops}}
\begin{DoxyCompactList}\small\item\em Operations that have to do with the grids and different coordinate systems. \end{DoxyCompactList}\end{DoxyCompactItemize}
\doxysubsubsection*{Functions/\+\+Subroutines}
\begin{DoxyCompactItemize}
\item 
integer function, public \doxymbox{\hyperlink{namespacegrid__ops_a7dd21871a4e65190fe6235eb2af4b6c2}{grid\+\_\+ops::\+calc\+\_\+norm\+\_\+range}} (style, in\+\_\+limits, eq\+\_\+limits, x\+\_\+limits, sol\+\_\+limits, r\+\_\+f\+\_\+eq, r\+\_\+f\+\_\+x, r\+\_\+f\+\_\+sol, jq)
\begin{DoxyCompactList}\small\item\em Calculates normal range for the input grid, the equilibrium grid and/\+or the solution grid. \end{DoxyCompactList}\item 
integer function \doxymbox{\hyperlink{grid__ops_8f90_aebe21d718069318bced62bc3d2d09393}{calc\+\_\+norm\+\_\+range\+\_\+pb3d\+\_\+in}} (in\+\_\+limits)
\begin{DoxyCompactList}\small\item\em PB3D input version. \end{DoxyCompactList}\item 
subroutine \doxymbox{\hyperlink{grid__ops_8f90_a868669b6df6c0fa6a8cedd993042f6ea}{calc\+\_\+norm\+\_\+range\+\_\+pb3d\+\_\+eq}} (eq\+\_\+limits)
\begin{DoxyCompactList}\small\item\em PB3D equilibrium version. \end{DoxyCompactList}\item 
integer function \doxymbox{\hyperlink{grid__ops_8f90_af80fd529f789cbf0338024afe3fe76ec}{calc\+\_\+norm\+\_\+range\+\_\+pb3d\+\_\+x}} (eq\+\_\+limits, x\+\_\+limits, r\+\_\+f\+\_\+eq, r\+\_\+f\+\_\+x, jq)
\begin{DoxyCompactList}\small\item\em PB3D perturbation version. \end{DoxyCompactList}\item 
integer function \doxymbox{\hyperlink{grid__ops_8f90_a6b55de41e75e249c934c4ab96cf10ee9}{calc\+\_\+norm\+\_\+range\+\_\+pb3d\+\_\+sol}} (sol\+\_\+limits, r\+\_\+f\+\_\+sol, n\+\_\+procs)
\begin{DoxyCompactList}\small\item\em PB3D solution version. \end{DoxyCompactList}\item 
subroutine \doxymbox{\hyperlink{grid__ops_8f90_a504fe64a9f5061c867bef7bee7538450}{calc\+\_\+norm\+\_\+range\+\_\+post}} (eq\+\_\+limits, x\+\_\+limits, sol\+\_\+limits, r\+\_\+f\+\_\+eq, r\+\_\+f\+\_\+x, r\+\_\+f\+\_\+sol)
\begin{DoxyCompactList}\small\item\em POST version. \end{DoxyCompactList}\item 
integer function, public \doxymbox{\hyperlink{namespacegrid__ops_af63366847d1caa64a7d329672292fd34}{grid\+\_\+ops::\+setup\+\_\+grid\+\_\+eq}} (grid\+\_\+eq, eq\+\_\+limits)
\begin{DoxyCompactList}\small\item\em Sets up the equilibrium grid. \end{DoxyCompactList}\item 
integer function, public \doxymbox{\hyperlink{namespacegrid__ops_addd35a4585f818ae0a7d94ee2156f1bd}{grid\+\_\+ops::\+setup\+\_\+grid\+\_\+eq\+\_\+b}} (grid\+\_\+eq, grid\+\_\+eq\+\_\+b, eq, only\+\_\+half\+\_\+grid)
\begin{DoxyCompactList}\small\item\em Sets up the field-\/aligned equilibrium grid. \end{DoxyCompactList}\item 
integer function, public \doxymbox{\hyperlink{namespacegrid__ops_affff458bc90352a94138e63b4a0feebe}{grid\+\_\+ops::\+setup\+\_\+grid\+\_\+x}} (grid\+\_\+eq, grid\+\_\+x, r\+\_\+f\+\_\+x, x\+\_\+limits)
\begin{DoxyCompactList}\small\item\em Sets up the general perturbation grid, in which the perturbation variables are calculated. \end{DoxyCompactList}\item 
integer function, public \doxymbox{\hyperlink{namespacegrid__ops_acb93d3ad89ab0efeff8c1b31ff77cec1}{grid\+\_\+ops::\+setup\+\_\+grid\+\_\+sol}} (grid\+\_\+eq, grid\+\_\+x, grid\+\_\+sol, r\+\_\+f\+\_\+sol, sol\+\_\+limits)
\begin{DoxyCompactList}\small\item\em Sets up the general solution grid, in which the solution variables are calculated. \end{DoxyCompactList}\item 
integer function, public \doxymbox{\hyperlink{namespacegrid__ops_a06107dbdfd1dd62e372cc29ab0255bad}{grid\+\_\+ops::\+calc\+\_\+ang\+\_\+grid\+\_\+eq\+\_\+b}} (grid\+\_\+eq, eq, only\+\_\+half\+\_\+grid)
\begin{DoxyCompactList}\small\item\em Calculate equilibrium grid that follows magnetic field lines. \end{DoxyCompactList}\item 
integer function, public \doxymbox{\hyperlink{namespacegrid__ops_ab10ef5b486ee3861df2da4e53bc22630}{grid\+\_\+ops::\+redistribute\+\_\+output\+\_\+grid}} (grid, grid\+\_\+out, no\+\_\+outer\+\_\+trim)
\begin{DoxyCompactList}\small\item\em Redistribute a grid to match the normal distribution of solution grid. \end{DoxyCompactList}\item 
integer function, public \doxymbox{\hyperlink{namespacegrid__ops_addd76b7b3be0b51e0863ae0cdfef41e6}{grid\+\_\+ops::\+magn\+\_\+grid\+\_\+plot}} (grid)
\begin{DoxyCompactList}\small\item\em Plots the grid in real 3-\/D space. \end{DoxyCompactList}\item 
integer function, public \doxymbox{\hyperlink{namespacegrid__ops_a4827e794d37334c0cad9bb2016e64d46}{grid\+\_\+ops::\+print\+\_\+output\+\_\+grid}} (grid, grid\+\_\+name, data\+\_\+name, rich\+\_\+lvl, par\+\_\+div, remove\+\_\+previous\+\_\+arrs)
\begin{DoxyCompactList}\small\item\em Print grid variables to an output file. \end{DoxyCompactList}\end{DoxyCompactItemize}
\doxysubsubsection*{Variables}
\begin{DoxyCompactItemize}
\item 
logical, public \doxymbox{\hyperlink{namespacegrid__ops_ad043ab1b07b2d251bb7596b8c8d2f960}{grid\+\_\+ops::\+debug\+\_\+calc\+\_\+ang\+\_\+grid\+\_\+eq\+\_\+b}} = .false.
\begin{DoxyCompactList}\small\item\em plot debug information for \doxylink{namespacegrid__ops_a06107dbdfd1dd62e372cc29ab0255bad}{calc\+\_\+ang\+\_\+grid\+\_\+eq\+\_\+b()} \end{DoxyCompactList}\end{DoxyCompactItemize}


\label{doc-func-members}
\Hypertarget{grid__ops_8f90_doc-func-members}
\doxysubsection{Function/\+\+Subroutine Documentation}
\Hypertarget{grid__ops_8f90_a868669b6df6c0fa6a8cedd993042f6ea}\index{grid\_ops.f90@{grid\_ops.f90}!calc\_norm\_range\_pb3d\_eq@{calc\_norm\_range\_pb3d\_eq}}
\index{calc\_norm\_range\_pb3d\_eq@{calc\_norm\_range\_pb3d\_eq}!grid\_ops.f90@{grid\_ops.f90}}
\doxysubsubsection{\texorpdfstring{calc\_norm\_range\_pb3d\_eq()}{calc\_norm\_range\_pb3d\_eq()}}
{\footnotesize\ttfamily \label{grid__ops_8f90_a868669b6df6c0fa6a8cedd993042f6ea} 
subroutine calc\+\_\+norm\+\_\+range::\+calc\+\_\+norm\+\_\+range\+\_\+pb3d\+\_\+eq (\begin{DoxyParamCaption}\item[{integer, dimension(2), intent(inout)}]{eq\+\_\+limits}{}\end{DoxyParamCaption})}



PB3D equilibrium version. 

The normal range is calculated by dividing the full equilibrium range passed from the input phase between the processes.

\begin{DoxyNote}{Note}
For X\+\_\+style 2 (solution) or 3 (optimized), at the end of the equilibrium phase, there will be an exchange of data from each process to each process so that they all have the tightest possible fit of data of the corresponding perturbation limits. 
\end{DoxyNote}

\begin{DoxyParams}[1]{Parameters}
\doxymbox{\texttt{in,out}}  & {\em eq\+\_\+limits} & min. and max. index of eq. grid for this process \\
\hline
\end{DoxyParams}


Definition at line \doxymbox{\hyperlink{grid__ops_8f90_source_l00245}{245}} of file \doxymbox{\hyperlink{grid__ops_8f90_source}{grid\+\_\+ops.\+f90}}.

Here is the caller graph for this function:\+\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{grid__ops_8f90_a868669b6df6c0fa6a8cedd993042f6ea_icgraph}
\end{center}
\end{figure}
\Hypertarget{grid__ops_8f90_aebe21d718069318bced62bc3d2d09393}\index{grid\_ops.f90@{grid\_ops.f90}!calc\_norm\_range\_pb3d\_in@{calc\_norm\_range\_pb3d\_in}}
\index{calc\_norm\_range\_pb3d\_in@{calc\_norm\_range\_pb3d\_in}!grid\_ops.f90@{grid\_ops.f90}}
\doxysubsubsection{\texorpdfstring{calc\_norm\_range\_pb3d\_in()}{calc\_norm\_range\_pb3d\_in()}}
{\footnotesize\ttfamily \label{grid__ops_8f90_aebe21d718069318bced62bc3d2d09393} 
integer function calc\+\_\+norm\+\_\+range::\+calc\+\_\+norm\+\_\+range\+\_\+pb3d\+\_\+in (\begin{DoxyParamCaption}\item[{integer, dimension(2), intent(inout)}]{in\+\_\+limits}{}\end{DoxyParamCaption})}



PB3D input version. 

The normal range is calculated by finding the tightest range of the input variables encompassing the entire solution range. Additionally, the global max\+\_\+flux variables are set as well..

\begin{DoxyNote}{Note}
This is the global, undivided range. The division information is calculated in \textquotesingle{}eq\+\_\+limits\textquotesingle{}. Furthermore, the input variables have to be tabulated on the full grid provided by the equilibrium code to be able to be used in PB3D and POST. 
\end{DoxyNote}

\begin{DoxyParams}[1]{Parameters}
\doxymbox{\texttt{in,out}}  & {\em in\+\_\+limits} & total min. and max. index of eq. grid for this process \\
\hline
\end{DoxyParams}


Definition at line \doxymbox{\hyperlink{grid__ops_8f90_source_l00135}{135}} of file \doxymbox{\hyperlink{grid__ops_8f90_source}{grid\+\_\+ops.\+f90}}.

Here is the caller graph for this function:\+\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{grid__ops_8f90_aebe21d718069318bced62bc3d2d09393_icgraph}
\end{center}
\end{figure}
\Hypertarget{grid__ops_8f90_a6b55de41e75e249c934c4ab96cf10ee9}\index{grid\_ops.f90@{grid\_ops.f90}!calc\_norm\_range\_pb3d\_sol@{calc\_norm\_range\_pb3d\_sol}}
\index{calc\_norm\_range\_pb3d\_sol@{calc\_norm\_range\_pb3d\_sol}!grid\_ops.f90@{grid\_ops.f90}}
\doxysubsubsection{\texorpdfstring{calc\_norm\_range\_pb3d\_sol()}{calc\_norm\_range\_pb3d\_sol()}}
{\footnotesize\ttfamily \label{grid__ops_8f90_a6b55de41e75e249c934c4ab96cf10ee9} 
integer function calc\+\_\+norm\+\_\+range::\+calc\+\_\+norm\+\_\+range\+\_\+pb3d\+\_\+sol (\begin{DoxyParamCaption}\item[{integer, dimension(2), intent(inout)}]{sol\+\_\+limits}{, }\item[{real(dp), dimension(:\+), intent(inout)}]{r\+\_\+f\+\_\+sol}{, }\item[{integer, intent(in), optional}]{n\+\_\+procs}{}\end{DoxyParamCaption})}



PB3D solution version. 

The normal range is determined by simply dividing the solution range, a ghost range is required.

By default, this routine uses {\ttfamily sol\+\_\+n\+\_\+procs} processes, but this can be overruled. 
\begin{DoxyParams}[1]{Parameters}
\doxymbox{\texttt{in,out}}  & {\em sol\+\_\+limits} & min. and max. index of sol grid for this process \\
\hline
\doxymbox{\texttt{in,out}}  & {\em r\+\_\+f\+\_\+sol} & solution r\+\_\+F \\
\hline
\doxymbox{\texttt{in}}  & {\em n\+\_\+procs} & how many processes used \\
\hline
\end{DoxyParams}


Definition at line \doxymbox{\hyperlink{grid__ops_8f90_source_l00386}{386}} of file \doxymbox{\hyperlink{grid__ops_8f90_source}{grid\+\_\+ops.\+f90}}.

Here is the caller graph for this function:\+\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{grid__ops_8f90_a6b55de41e75e249c934c4ab96cf10ee9_icgraph}
\end{center}
\end{figure}
\Hypertarget{grid__ops_8f90_af80fd529f789cbf0338024afe3fe76ec}\index{grid\_ops.f90@{grid\_ops.f90}!calc\_norm\_range\_pb3d\_x@{calc\_norm\_range\_pb3d\_x}}
\index{calc\_norm\_range\_pb3d\_x@{calc\_norm\_range\_pb3d\_x}!grid\_ops.f90@{grid\_ops.f90}}
\doxysubsubsection{\texorpdfstring{calc\_norm\_range\_pb3d\_x()}{calc\_norm\_range\_pb3d\_x()}}
{\footnotesize\ttfamily \label{grid__ops_8f90_af80fd529f789cbf0338024afe3fe76ec} 
integer function calc\+\_\+norm\+\_\+range::\+calc\+\_\+norm\+\_\+range\+\_\+pb3d\+\_\+x (\begin{DoxyParamCaption}\item[{integer, dimension(2), intent(in)}]{eq\+\_\+limits}{, }\item[{integer, dimension(2), intent(inout)}]{x\+\_\+limits}{, }\item[{real(dp), dimension(:\+), intent(in)}]{r\+\_\+f\+\_\+eq}{, }\item[{real(dp), dimension(:\+), intent(inout), allocatable}]{r\+\_\+f\+\_\+x}{, }\item[{real(dp), dimension(:\+), intent(in)}]{jq}{}\end{DoxyParamCaption})}



PB3D perturbation version. 

The normal range is determined according to X\+\_\+grid style:\+
\begin{DoxyEnumerate}
\item taken identical to the equilibrium grid, which means that after the perturbation phase the integrated tensorial quantities have to be interpolated in interp\+\_\+v() in \doxylink{namespacedriver__sol}{driver\+\_\+sol()} after having been redistributed at the start of the solution driver.
\item taken identical to the solution grid, which means that the the equilibrium quantities have to be interpolated in calc\+\_\+u(), calc\+\_\+kv() and calc\+\_\+pv() after having been redistributed at the end of the equilibrium driver.
\item by considering an optimal interpolation extension of the equilibrium range, adding intermediairy points between grid points where the safety factor changes too quickly, according to the variable \textquotesingle{}max\+\_\+njq\+\_\+change\textquotesingle{}. This uses {\ttfamily prim\+\_\+X}. 
\begin{DoxyParams}[1]{Parameters}
\doxymbox{\texttt{in}}  & {\em eq\+\_\+limits} & min. and max. index of eq grid for this process \\
\hline
\doxymbox{\texttt{in,out}}  & {\em x\+\_\+limits} & min. and max. index of X grid for this process \\
\hline
\doxymbox{\texttt{in}}  & {\em r\+\_\+f\+\_\+eq} & equilibrium r\+\_\+F \\
\hline
\doxymbox{\texttt{in,out}}  & {\em r\+\_\+f\+\_\+x} & perturbation r\+\_\+F \\
\hline
\doxymbox{\texttt{in}}  & {\em jq} & q\+\_\+saf (pol. flux) or rot\+\_\+t (tor. flux) in total Flux variables \\
\hline
\end{DoxyParams}

\end{DoxyEnumerate}

Definition at line \doxymbox{\hyperlink{grid__ops_8f90_source_l00283}{283}} of file \doxymbox{\hyperlink{grid__ops_8f90_source}{grid\+\_\+ops.\+f90}}.

Here is the call graph for this function:\+\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{grid__ops_8f90_af80fd529f789cbf0338024afe3fe76ec_cgraph}
\end{center}
\end{figure}
Here is the caller graph for this function:\+\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{grid__ops_8f90_af80fd529f789cbf0338024afe3fe76ec_icgraph}
\end{center}
\end{figure}
\Hypertarget{grid__ops_8f90_a504fe64a9f5061c867bef7bee7538450}\index{grid\_ops.f90@{grid\_ops.f90}!calc\_norm\_range\_post@{calc\_norm\_range\_post}}
\index{calc\_norm\_range\_post@{calc\_norm\_range\_post}!grid\_ops.f90@{grid\_ops.f90}}
\doxysubsubsection{\texorpdfstring{calc\_norm\_range\_post()}{calc\_norm\_range\_post()}}
{\footnotesize\ttfamily \label{grid__ops_8f90_a504fe64a9f5061c867bef7bee7538450} 
subroutine calc\+\_\+norm\+\_\+range::\+calc\+\_\+norm\+\_\+range\+\_\+post (\begin{DoxyParamCaption}\item[{integer, dimension(2), intent(inout)}]{eq\+\_\+limits}{, }\item[{integer, dimension(2), intent(inout)}]{x\+\_\+limits}{, }\item[{integer, dimension(2), intent(inout)}]{sol\+\_\+limits}{, }\item[{real(dp), dimension(:\+), intent(in)}]{r\+\_\+f\+\_\+eq}{, }\item[{real(dp), dimension(:\+), intent(in)}]{r\+\_\+f\+\_\+x}{, }\item[{real(dp), dimension(:\+), intent(in)}]{r\+\_\+f\+\_\+sol}{}\end{DoxyParamCaption})}



POST version. 

The normal range is determined by simply dividing a possible subset of the solution range, indicated by {\ttfamily min\+\_\+r\+\_\+plot} and {\ttfamily max\+\_\+r\+\_\+sol}, including a ghost range and getting a bounding equilibrium and perturbation range. 
\begin{DoxyParams}[1]{Parameters}
\doxymbox{\texttt{in,out}}  & {\em eq\+\_\+limits} & min. and max. index of eq grid for this process \\
\hline
\doxymbox{\texttt{in,out}}  & {\em x\+\_\+limits} & min. and max. index of X grid for this process \\
\hline
\doxymbox{\texttt{in,out}}  & {\em sol\+\_\+limits} & min. and max. index of sol grid for this process \\
\hline
\doxymbox{\texttt{in}}  & {\em r\+\_\+f\+\_\+eq} & eq r\+\_\+F \\
\hline
\doxymbox{\texttt{in}}  & {\em r\+\_\+f\+\_\+x} & X r\+\_\+F \\
\hline
\doxymbox{\texttt{in}}  & {\em r\+\_\+f\+\_\+sol} & sol r\+\_\+F \\
\hline
\end{DoxyParams}


Definition at line \doxymbox{\hyperlink{grid__ops_8f90_source_l00451}{451}} of file \doxymbox{\hyperlink{grid__ops_8f90_source}{grid\+\_\+ops.\+f90}}.

Here is the call graph for this function:\+\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{grid__ops_8f90_a504fe64a9f5061c867bef7bee7538450_cgraph}
\end{center}
\end{figure}
Here is the caller graph for this function:\+\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{grid__ops_8f90_a504fe64a9f5061c867bef7bee7538450_icgraph}
\end{center}
\end{figure}
