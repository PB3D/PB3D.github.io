\hypertarget{grid__ops_8f90}{}\section{Modules/grid\+\_\+ops.f90 File Reference}
\label{grid__ops_8f90}\index{Modules/grid\+\_\+ops.\+f90@{Modules/grid\+\_\+ops.\+f90}}
\subsection*{Modules}
\begin{DoxyCompactItemize}
\item 
module \hyperlink{namespacegrid__ops}{grid\+\_\+ops}
\begin{DoxyCompactList}\small\item\em Operations that have to do with the grids and different coordinate systems. \end{DoxyCompactList}\end{DoxyCompactItemize}
\subsection*{Functions/\+Subroutines}
\begin{DoxyCompactItemize}
\item 
integer function, public \hyperlink{namespacegrid__ops_a1c18f90f93f5fce7ebb4dba60b70e0f8}{grid\+\_\+ops\+::calc\+\_\+norm\+\_\+range} (style, in\+\_\+limits, eq\+\_\+limits, X\+\_\+limits, sol\+\_\+limits, r\+\_\+\+F\+\_\+eq, r\+\_\+\+F\+\_\+X, r\+\_\+\+F\+\_\+sol, jq)
\begin{DoxyCompactList}\small\item\em Calculates normal range for the input grid, the equilibrium grid and/or the solution grid. \end{DoxyCompactList}\item 
integer function \hyperlink{grid__ops_8f90_aebe21d718069318bced62bc3d2d09393}{calc\+\_\+norm\+\_\+range\+\_\+pb3d\+\_\+in} (in\+\_\+limits)
\begin{DoxyCompactList}\small\item\em P\+B3D input version. \end{DoxyCompactList}\item 
subroutine \hyperlink{grid__ops_8f90_a868669b6df6c0fa6a8cedd993042f6ea}{calc\+\_\+norm\+\_\+range\+\_\+pb3d\+\_\+eq} (eq\+\_\+limits)
\begin{DoxyCompactList}\small\item\em P\+B3D equilibrium version. \end{DoxyCompactList}\item 
integer function \hyperlink{grid__ops_8f90_a0bd0af6203161233f7687c029d6c4ca0}{calc\+\_\+norm\+\_\+range\+\_\+pb3d\+\_\+x} (eq\+\_\+limits, X\+\_\+limits, r\+\_\+\+F\+\_\+eq, r\+\_\+\+F\+\_\+X, jq)
\begin{DoxyCompactList}\small\item\em P\+B3D perturbation version. \end{DoxyCompactList}\item 
integer function \hyperlink{grid__ops_8f90_a9121423739548f1a1fa4e87055f49010}{calc\+\_\+norm\+\_\+range\+\_\+pb3d\+\_\+sol} (sol\+\_\+limits, r\+\_\+\+F\+\_\+sol, n\+\_\+procs)
\begin{DoxyCompactList}\small\item\em P\+B3D solution version. \end{DoxyCompactList}\item 
subroutine \hyperlink{grid__ops_8f90_aa3b47be0188da6dd19a745f796c1500f}{calc\+\_\+norm\+\_\+range\+\_\+post} (eq\+\_\+limits, X\+\_\+limits, sol\+\_\+limits, r\+\_\+\+F\+\_\+eq, r\+\_\+\+F\+\_\+X, r\+\_\+\+F\+\_\+sol)
\begin{DoxyCompactList}\small\item\em P\+O\+ST version. \end{DoxyCompactList}\item 
integer function, public \hyperlink{namespacegrid__ops_af63366847d1caa64a7d329672292fd34}{grid\+\_\+ops\+::setup\+\_\+grid\+\_\+eq} (grid\+\_\+eq, eq\+\_\+limits)
\begin{DoxyCompactList}\small\item\em Sets up the equilibrium grid. \end{DoxyCompactList}\item 
integer function, public \hyperlink{namespacegrid__ops_ad16495ddd320562451c2325bafecf2d8}{grid\+\_\+ops\+::setup\+\_\+grid\+\_\+eq\+\_\+b} (grid\+\_\+eq, grid\+\_\+eq\+\_\+B, eq, only\+\_\+half\+\_\+grid)
\begin{DoxyCompactList}\small\item\em Sets up the field-\/aligned equilibrium grid. \end{DoxyCompactList}\item 
integer function, public \hyperlink{namespacegrid__ops_a1047889ec84da6e56aae619570a16988}{grid\+\_\+ops\+::setup\+\_\+grid\+\_\+x} (grid\+\_\+eq, grid\+\_\+X, r\+\_\+\+F\+\_\+X, X\+\_\+limits)
\begin{DoxyCompactList}\small\item\em Sets up the general perturbation grid, in which the perturbation variables are calculated. \end{DoxyCompactList}\item 
integer function, public \hyperlink{namespacegrid__ops_aeff1569cb9a043b03ed49250524fbd95}{grid\+\_\+ops\+::setup\+\_\+grid\+\_\+sol} (grid\+\_\+eq, grid\+\_\+X, grid\+\_\+sol, r\+\_\+\+F\+\_\+sol, sol\+\_\+limits)
\begin{DoxyCompactList}\small\item\em Sets up the general solution grid, in which the solution variables are calculated. \end{DoxyCompactList}\item 
integer function, public \hyperlink{namespacegrid__ops_a06107dbdfd1dd62e372cc29ab0255bad}{grid\+\_\+ops\+::calc\+\_\+ang\+\_\+grid\+\_\+eq\+\_\+b} (grid\+\_\+eq, eq, only\+\_\+half\+\_\+grid)
\begin{DoxyCompactList}\small\item\em Calculate equilibrium grid that follows magnetic field lines. \end{DoxyCompactList}\item 
integer function, public \hyperlink{namespacegrid__ops_ab10ef5b486ee3861df2da4e53bc22630}{grid\+\_\+ops\+::redistribute\+\_\+output\+\_\+grid} (grid, grid\+\_\+out, no\+\_\+outer\+\_\+trim)
\begin{DoxyCompactList}\small\item\em Redistribute a grid to match the normal distribution of solution grid. \end{DoxyCompactList}\item 
integer function, public \hyperlink{namespacegrid__ops_addd76b7b3be0b51e0863ae0cdfef41e6}{grid\+\_\+ops\+::magn\+\_\+grid\+\_\+plot} (grid)
\begin{DoxyCompactList}\small\item\em Plots the grid in real 3-\/D space. \end{DoxyCompactList}\item 
integer function, public \hyperlink{namespacegrid__ops_a4827e794d37334c0cad9bb2016e64d46}{grid\+\_\+ops\+::print\+\_\+output\+\_\+grid} (grid, grid\+\_\+name, data\+\_\+name, rich\+\_\+lvl, par\+\_\+div, remove\+\_\+previous\+\_\+arrs)
\begin{DoxyCompactList}\small\item\em Print grid variables to an output file. \end{DoxyCompactList}\end{DoxyCompactItemize}
\subsection*{Variables}
\begin{DoxyCompactItemize}
\item 
logical, public \hyperlink{namespacegrid__ops_ad043ab1b07b2d251bb7596b8c8d2f960}{grid\+\_\+ops\+::debug\+\_\+calc\+\_\+ang\+\_\+grid\+\_\+eq\+\_\+b} = .false.
\begin{DoxyCompactList}\small\item\em plot debug information for \hyperlink{namespacegrid__ops_a06107dbdfd1dd62e372cc29ab0255bad}{calc\+\_\+ang\+\_\+grid\+\_\+eq\+\_\+b()} \end{DoxyCompactList}\end{DoxyCompactItemize}


\subsection{Function/\+Subroutine Documentation}
\mbox{\Hypertarget{grid__ops_8f90_a868669b6df6c0fa6a8cedd993042f6ea}\label{grid__ops_8f90_a868669b6df6c0fa6a8cedd993042f6ea}} 
\index{grid\+\_\+ops.\+f90@{grid\+\_\+ops.\+f90}!calc\+\_\+norm\+\_\+range\+\_\+pb3d\+\_\+eq@{calc\+\_\+norm\+\_\+range\+\_\+pb3d\+\_\+eq}}
\index{calc\+\_\+norm\+\_\+range\+\_\+pb3d\+\_\+eq@{calc\+\_\+norm\+\_\+range\+\_\+pb3d\+\_\+eq}!grid\+\_\+ops.\+f90@{grid\+\_\+ops.\+f90}}
\subsubsection{\texorpdfstring{calc\+\_\+norm\+\_\+range\+\_\+pb3d\+\_\+eq()}{calc\_norm\_range\_pb3d\_eq()}}
{\footnotesize\ttfamily subroutine calc\+\_\+norm\+\_\+range\+::calc\+\_\+norm\+\_\+range\+\_\+pb3d\+\_\+eq (\begin{DoxyParamCaption}\item[{integer, dimension(2), intent(inout)}]{eq\+\_\+limits }\end{DoxyParamCaption})}



P\+B3D equilibrium version. 

The normal range is calculated by dividing the full equilibrium range passed from the input phase between the processes.

\begin{DoxyNote}{Note}
For X\+\_\+style 2 (solution) or 3 (optimized), at the end of the equilibrium phase, there will be an exchange of data from each process to each process so that they all have the tightest possible fit of data of the corresponding perturbation limits.
\end{DoxyNote}

\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in,out}  & {\em eq\+\_\+limits} & min. and max. index of eq. grid for this process \\
\hline
\end{DoxyParams}


Definition at line 246 of file grid\+\_\+ops.\+f90.

Here is the caller graph for this function\+:\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{grid__ops_8f90_a868669b6df6c0fa6a8cedd993042f6ea_icgraph}
\end{center}
\end{figure}
\mbox{\Hypertarget{grid__ops_8f90_aebe21d718069318bced62bc3d2d09393}\label{grid__ops_8f90_aebe21d718069318bced62bc3d2d09393}} 
\index{grid\+\_\+ops.\+f90@{grid\+\_\+ops.\+f90}!calc\+\_\+norm\+\_\+range\+\_\+pb3d\+\_\+in@{calc\+\_\+norm\+\_\+range\+\_\+pb3d\+\_\+in}}
\index{calc\+\_\+norm\+\_\+range\+\_\+pb3d\+\_\+in@{calc\+\_\+norm\+\_\+range\+\_\+pb3d\+\_\+in}!grid\+\_\+ops.\+f90@{grid\+\_\+ops.\+f90}}
\subsubsection{\texorpdfstring{calc\+\_\+norm\+\_\+range\+\_\+pb3d\+\_\+in()}{calc\_norm\_range\_pb3d\_in()}}
{\footnotesize\ttfamily integer function calc\+\_\+norm\+\_\+range\+::calc\+\_\+norm\+\_\+range\+\_\+pb3d\+\_\+in (\begin{DoxyParamCaption}\item[{integer, dimension(2), intent(inout)}]{in\+\_\+limits }\end{DoxyParamCaption})}



P\+B3D input version. 

The normal range is calculated by finding the tightest range of the input variables encompassing the entire solution range. Additionally, the global max\+\_\+flux variables are set as well..

\begin{DoxyNote}{Note}
This is the global, undivided range. The division information is calculated in \textquotesingle{}eq\+\_\+limits\textquotesingle{}. Furthermore, the input variables have to be tabulated on the full grid provided by the equilibrium code to be able to be used in P\+B3D and P\+O\+ST.
\end{DoxyNote}

\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in,out}  & {\em in\+\_\+limits} & total min. and max. index of eq. grid for this process \\
\hline
\end{DoxyParams}


Definition at line 137 of file grid\+\_\+ops.\+f90.

Here is the caller graph for this function\+:\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{grid__ops_8f90_aebe21d718069318bced62bc3d2d09393_icgraph}
\end{center}
\end{figure}
\mbox{\Hypertarget{grid__ops_8f90_a9121423739548f1a1fa4e87055f49010}\label{grid__ops_8f90_a9121423739548f1a1fa4e87055f49010}} 
\index{grid\+\_\+ops.\+f90@{grid\+\_\+ops.\+f90}!calc\+\_\+norm\+\_\+range\+\_\+pb3d\+\_\+sol@{calc\+\_\+norm\+\_\+range\+\_\+pb3d\+\_\+sol}}
\index{calc\+\_\+norm\+\_\+range\+\_\+pb3d\+\_\+sol@{calc\+\_\+norm\+\_\+range\+\_\+pb3d\+\_\+sol}!grid\+\_\+ops.\+f90@{grid\+\_\+ops.\+f90}}
\subsubsection{\texorpdfstring{calc\+\_\+norm\+\_\+range\+\_\+pb3d\+\_\+sol()}{calc\_norm\_range\_pb3d\_sol()}}
{\footnotesize\ttfamily integer function calc\+\_\+norm\+\_\+range\+::calc\+\_\+norm\+\_\+range\+\_\+pb3d\+\_\+sol (\begin{DoxyParamCaption}\item[{integer, dimension(2), intent(inout)}]{sol\+\_\+limits,  }\item[{real(dp), dimension(\+:), intent(inout)}]{r\+\_\+\+F\+\_\+sol,  }\item[{integer, intent(in), optional}]{n\+\_\+procs }\end{DoxyParamCaption})}



P\+B3D solution version. 

The normal range is determined by simply dividing the solution range, a ghost range is required.

By default, this routine uses {\ttfamily sol\+\_\+n\+\_\+procs} processes, but this can be overruled.


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in,out}  & {\em sol\+\_\+limits} & min. and max. index of sol grid for this process\\
\hline
\mbox{\tt in,out}  & {\em r\+\_\+f\+\_\+sol} & solution r\+\_\+F\\
\hline
\mbox{\tt in}  & {\em n\+\_\+procs} & how many processes used \\
\hline
\end{DoxyParams}


Definition at line 387 of file grid\+\_\+ops.\+f90.

Here is the caller graph for this function\+:\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{grid__ops_8f90_a9121423739548f1a1fa4e87055f49010_icgraph}
\end{center}
\end{figure}
\mbox{\Hypertarget{grid__ops_8f90_a0bd0af6203161233f7687c029d6c4ca0}\label{grid__ops_8f90_a0bd0af6203161233f7687c029d6c4ca0}} 
\index{grid\+\_\+ops.\+f90@{grid\+\_\+ops.\+f90}!calc\+\_\+norm\+\_\+range\+\_\+pb3d\+\_\+x@{calc\+\_\+norm\+\_\+range\+\_\+pb3d\+\_\+x}}
\index{calc\+\_\+norm\+\_\+range\+\_\+pb3d\+\_\+x@{calc\+\_\+norm\+\_\+range\+\_\+pb3d\+\_\+x}!grid\+\_\+ops.\+f90@{grid\+\_\+ops.\+f90}}
\subsubsection{\texorpdfstring{calc\+\_\+norm\+\_\+range\+\_\+pb3d\+\_\+x()}{calc\_norm\_range\_pb3d\_x()}}
{\footnotesize\ttfamily integer function calc\+\_\+norm\+\_\+range\+::calc\+\_\+norm\+\_\+range\+\_\+pb3d\+\_\+x (\begin{DoxyParamCaption}\item[{integer, dimension(2), intent(in)}]{eq\+\_\+limits,  }\item[{integer, dimension(2), intent(inout)}]{X\+\_\+limits,  }\item[{real(dp), dimension(\+:), intent(in)}]{r\+\_\+\+F\+\_\+eq,  }\item[{real(dp), dimension(\+:), intent(inout), allocatable}]{r\+\_\+\+F\+\_\+X,  }\item[{real(dp), dimension(\+:), intent(in)}]{jq }\end{DoxyParamCaption})}



P\+B3D perturbation version. 

The normal range is determined according to X\+\_\+grid style\+:
\begin{DoxyEnumerate}
\item taken identical to the equilibrium grid, which means that after the perturbation phase the integrated tensorial quantities have to be interpolated in \hyperlink{namespacedriver__sol_af1c4ea0286ad714d3f91bb1608e4fc27}{interp\+\_\+v()} in driver\+\_\+sol() after having been redistributed at the start of the solution driver.
\item taken identical to the solution grid, which means that the the equilibrium quantities have to be interpolated in \hyperlink{namespacex__ops_a4e39701da15ff952add5133db1897b52}{calc\+\_\+u()}, \hyperlink{namespacex__ops_a045e8903230dfa0fb8b89b458d0c8ee2}{calc\+\_\+kv()} and \hyperlink{namespacex__ops_a51f3bf0b4c8d688ffbcc3a1adbca9762}{calc\+\_\+pv()} after having been redistributed at the end of the equilibrium driver.
\item by considering an optimal interpolation extension of the equilibrium range, adding intermediairy points between grid points where the safety factor changes too quickly, according to the variable \textquotesingle{}max\+\_\+njq\+\_\+change\textquotesingle{}. This uses {\ttfamily prim\+\_\+X}.
\end{DoxyEnumerate}


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em eq\+\_\+limits} & min. and max. index of eq grid for this process\\
\hline
\mbox{\tt in,out}  & {\em x\+\_\+limits} & min. and max. index of X grid for this process\\
\hline
\mbox{\tt in}  & {\em r\+\_\+f\+\_\+eq} & equilibrium r\+\_\+F\\
\hline
\mbox{\tt in,out}  & {\em r\+\_\+f\+\_\+x} & perturbation r\+\_\+F\\
\hline
\mbox{\tt in}  & {\em jq} & q\+\_\+saf (pol. flux) or rot\+\_\+t (tor. flux) in total Flux variables \\
\hline
\end{DoxyParams}


Definition at line 285 of file grid\+\_\+ops.\+f90.

Here is the call graph for this function\+:\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{grid__ops_8f90_a0bd0af6203161233f7687c029d6c4ca0_cgraph}
\end{center}
\end{figure}
Here is the caller graph for this function\+:\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{grid__ops_8f90_a0bd0af6203161233f7687c029d6c4ca0_icgraph}
\end{center}
\end{figure}
\mbox{\Hypertarget{grid__ops_8f90_aa3b47be0188da6dd19a745f796c1500f}\label{grid__ops_8f90_aa3b47be0188da6dd19a745f796c1500f}} 
\index{grid\+\_\+ops.\+f90@{grid\+\_\+ops.\+f90}!calc\+\_\+norm\+\_\+range\+\_\+post@{calc\+\_\+norm\+\_\+range\+\_\+post}}
\index{calc\+\_\+norm\+\_\+range\+\_\+post@{calc\+\_\+norm\+\_\+range\+\_\+post}!grid\+\_\+ops.\+f90@{grid\+\_\+ops.\+f90}}
\subsubsection{\texorpdfstring{calc\+\_\+norm\+\_\+range\+\_\+post()}{calc\_norm\_range\_post()}}
{\footnotesize\ttfamily subroutine calc\+\_\+norm\+\_\+range\+::calc\+\_\+norm\+\_\+range\+\_\+post (\begin{DoxyParamCaption}\item[{integer, dimension(2), intent(inout)}]{eq\+\_\+limits,  }\item[{integer, dimension(2), intent(inout)}]{X\+\_\+limits,  }\item[{integer, dimension(2), intent(inout)}]{sol\+\_\+limits,  }\item[{real(dp), dimension(\+:), intent(in)}]{r\+\_\+\+F\+\_\+eq,  }\item[{real(dp), dimension(\+:), intent(in)}]{r\+\_\+\+F\+\_\+X,  }\item[{real(dp), dimension(\+:), intent(in)}]{r\+\_\+\+F\+\_\+sol }\end{DoxyParamCaption})}



P\+O\+ST version. 

The normal range is determined by simply dividing a possible subset of the solution range, indicated by {\ttfamily min\+\_\+r\+\_\+plot} and {\ttfamily max\+\_\+r\+\_\+sol}, including a ghost range and getting a bounding equilibrium and perturbation range.


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in,out}  & {\em eq\+\_\+limits} & min. and max. index of eq grid for this process\\
\hline
\mbox{\tt in,out}  & {\em x\+\_\+limits} & min. and max. index of X grid for this process\\
\hline
\mbox{\tt in,out}  & {\em sol\+\_\+limits} & min. and max. index of sol grid for this process\\
\hline
\mbox{\tt in}  & {\em r\+\_\+f\+\_\+eq} & eq r\+\_\+F\\
\hline
\mbox{\tt in}  & {\em r\+\_\+f\+\_\+x} & X r\+\_\+F\\
\hline
\mbox{\tt in}  & {\em r\+\_\+f\+\_\+sol} & sol r\+\_\+F \\
\hline
\end{DoxyParams}


Definition at line 452 of file grid\+\_\+ops.\+f90.

Here is the call graph for this function\+:\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{grid__ops_8f90_aa3b47be0188da6dd19a745f796c1500f_cgraph}
\end{center}
\end{figure}
Here is the caller graph for this function\+:\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{grid__ops_8f90_aa3b47be0188da6dd19a745f796c1500f_icgraph}
\end{center}
\end{figure}
