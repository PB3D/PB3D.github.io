\hypertarget{namespacevac__ops}{}\section{vac\+\_\+ops Module Reference}
\label{namespacevac__ops}\index{vac\+\_\+ops@{vac\+\_\+ops}}


Operations and variables pertaining to the vacuum response.  


\subsection*{Functions/\+Subroutines}
\begin{DoxyCompactItemize}
\item 
integer function, public \hyperlink{namespacevac__ops_a37220702fbf378626a0f2c12f446e0aa}{store\+\_\+vac} (grid, eq\+\_\+1, eq\+\_\+2, vac)
\begin{DoxyCompactList}\small\item\em Stores calculation of the vacuum response by storing the necessary variables. \end{DoxyCompactList}\item 
integer function \hyperlink{namespacevac__ops_a7e3f92fbe9fa6cf3de6ac301676b96d1}{calc\+\_\+gh} (vac, n\+\_\+r\+\_\+in, lims\+\_\+r\+\_\+in, x\+\_\+vec\+\_\+in, G\+\_\+in, H\+\_\+in)
\begin{DoxyCompactList}\small\item\em Calculate the matrices {\ttfamily G} and {\ttfamily H}. \end{DoxyCompactList}\item 
integer function \hyperlink{namespacevac__ops_a267742c3c9a1b395aee76527d1e8352c}{calc\+\_\+gh\+\_\+1} (vac, n\+\_\+r\+\_\+in, lims\+\_\+r\+\_\+in, x\+\_\+vec\+\_\+in, G\+\_\+in, H\+\_\+in, ext\+\_\+in)
\begin{DoxyCompactList}\small\item\em Calculates matrices {\ttfamily G} and {\ttfamily H} in 3-\/D configuration. \end{DoxyCompactList}\item 
integer function \hyperlink{namespacevac__ops_ae4987d1f48f1f83b1f0d38ea85b4998b}{calc\+\_\+gh\+\_\+2} (vac, n\+\_\+r\+\_\+in, lims\+\_\+r\+\_\+in, x\+\_\+vec\+\_\+in, G\+\_\+in, H\+\_\+in, ext\+\_\+in)
\begin{DoxyCompactList}\small\item\em Calculates matrices {\ttfamily G} and {\ttfamily H} in axisymmetric configurations. \end{DoxyCompactList}\item 
integer function, public \hyperlink{namespacevac__ops_a5e5a8322b3aa2e3704b1050426f06d9d}{calc\+\_\+vac\+\_\+res} (mds, vac)
\begin{DoxyCompactList}\small\item\em Calculates the vacuum response. \end{DoxyCompactList}\item 
integer function, public \hyperlink{namespacevac__ops_a3a2a3aed45951aecef42197b82a5a6da}{vac\+\_\+pot\+\_\+plot} (grid\+\_\+sol, vac, sol, X\+\_\+id)
\begin{DoxyCompactList}\small\item\em Calculate vacuum potential at some positions that are not resonant. \end{DoxyCompactList}\item 
integer function \hyperlink{namespacevac__ops_ace79efa50ae5a120e515164c99ce9582}{solve\+\_\+phi\+\_\+bem} (vac, R, Phi, n\+\_\+\+R\+Phi, n\+\_\+loc\+\_\+\+R\+Phi, lims\+\_\+c\+\_\+\+R\+Phi, desc\+\_\+\+R\+Phi)
\begin{DoxyCompactList}\small\item\em Calculates potential {\ttfamily Phi} on boundary of B\+EM in terms of some right-\/hand side . \end{DoxyCompactList}\item 
integer function, public \hyperlink{namespacevac__ops_a78969bf43f80f0df3acf23c47edf7aff}{print\+\_\+output\+\_\+vac} (vac, data\+\_\+name, rich\+\_\+lvl)
\begin{DoxyCompactList}\small\item\em Print vacuum quantities of a certain order to an output file. \end{DoxyCompactList}\end{DoxyCompactItemize}
\subsection*{Variables}
\begin{DoxyCompactItemize}
\item 
logical, public \hyperlink{namespacevac__ops_a9c1d2227ea0118cb9158f7e08f41affc}{debug\+\_\+calc\+\_\+gh} = .true.
\begin{DoxyCompactList}\small\item\em plot debug information for calc\+\_\+\+G\+H() \end{DoxyCompactList}\item 
logical, public \hyperlink{namespacevac__ops_a6b99f921f077f63f641d5a9c86d88eaf}{debug\+\_\+calc\+\_\+vac\+\_\+res} = .true.
\begin{DoxyCompactList}\small\item\em plot debug information for \hyperlink{namespacevac__ops_a5e5a8322b3aa2e3704b1050426f06d9d}{calc\+\_\+vac\+\_\+res()} \end{DoxyCompactList}\item 
logical, public \hyperlink{namespacevac__ops_a1afb20e30f5f99547fc8df4ace204ee9}{debug\+\_\+vac\+\_\+pot\+\_\+plot} = .true.
\begin{DoxyCompactList}\small\item\em plot debug information for \hyperlink{namespacevac__ops_a3a2a3aed45951aecef42197b82a5a6da}{vac\+\_\+pot\+\_\+plot()} \end{DoxyCompactList}\end{DoxyCompactItemize}


\subsection{Detailed Description}
Operations and variables pertaining to the vacuum response. 

The vacuum response is calculated using the Boundary Element Method. There are two possibilities, indicated by the variable {\ttfamily style} in {\ttfamily \hyperlink{namespacevac__vars}{vac\+\_\+vars}}.
\begin{DoxyEnumerate}
\item 3-\/D field aligned\+:
\begin{DoxyItemize}
\item Makes use of the collocation method for the grid points along the magnetic field lines.
\item The 3-\/D integrals are therefore integrated using Weyl\textquotesingle{}s theorem \cite{Helander2014}, p. 5.
\end{DoxyItemize}
\item axisymmetric\+:
\begin{DoxyItemize}
\item Makes use of an analytical expression for the toroidal integration of the Green\textquotesingle{}s functions, as shown in \cite{Cohl1999}.
\item The integration in the poloidal angle is done using the collocation method.
\end{DoxyItemize}
\end{DoxyEnumerate}

The final matrix equation is solved through Strumpack \cite{Meiser2016}.

\begin{DoxySeeAlso}{See also}
See \cite{Weyens3D}.
\end{DoxySeeAlso}
\begin{DoxyRefDesc}{Todo}
\item[\hyperlink{todo__todo000001}{Todo}]The vacuum part of P\+B3D is still under construction and not usable yet. \end{DoxyRefDesc}


\subsection{Function/\+Subroutine Documentation}
\mbox{\Hypertarget{namespacevac__ops_a7e3f92fbe9fa6cf3de6ac301676b96d1}\label{namespacevac__ops_a7e3f92fbe9fa6cf3de6ac301676b96d1}} 
\index{vac\+\_\+ops@{vac\+\_\+ops}!calc\+\_\+gh@{calc\+\_\+gh}}
\index{calc\+\_\+gh@{calc\+\_\+gh}!vac\+\_\+ops@{vac\+\_\+ops}}
\subsubsection{\texorpdfstring{calc\+\_\+gh()}{calc\_gh()}}
{\footnotesize\ttfamily integer function vac\+\_\+ops\+::calc\+\_\+gh (\begin{DoxyParamCaption}\item[{type(\hyperlink{structvac__vars_1_1vac__type}{vac\+\_\+type}), intent(inout), target}]{vac,  }\item[{integer, intent(in), optional}]{n\+\_\+r\+\_\+in,  }\item[{integer, dimension(\+:,\+:), intent(in), optional, target}]{lims\+\_\+r\+\_\+in,  }\item[{real(dp), dimension(\+:,\+:), intent(in), optional, target}]{x\+\_\+vec\+\_\+in,  }\item[{real(dp), dimension(\+:,\+:), intent(in), optional, target}]{G\+\_\+in,  }\item[{real(dp), dimension(\+:,\+:), intent(in), optional, target}]{H\+\_\+in }\end{DoxyParamCaption})}



Calculate the matrices {\ttfamily G} and {\ttfamily H}. 

This is done by iterating over the subintervals, calculating the contributions to the potential values on the left and right boundary of the interval, and adding these to the appropriate values in G and H.

As each process in the blacs grid only has access to its own values, an extra interval is is calculated to the left and right of the internal process grid edges.

Optionally, this procedure can be used to calculate the coefficients G and H with respect to other points, outside of the boundary. This is useful when the potential is to be calculated at external points.

In this case, however, no (near-\/) singular points are calculated, and if they appear any way, perhaps by accident, they will not be accurate.

Multiple field lines are stored sequentially, which implies that the integral between the last point on a field line and the first point on the next field lines needs to be left out.

\begin{DoxyRefDesc}{Todo}
\item[\hyperlink{todo__todo000002}{Todo}]For 3-\/D vacuums, step sizes are constant. Subsequent Richardson levels should therefore make use of the fact that the contribution to the points inherited from the previous levels can be just scaled by 1/2 and do not need to be recalculated. Currently, the copy is done correctly in \hyperlink{namespacevac__utilities_a8e7889688701f6ac2fd2c60cdee2b96a}{interlaced\+\_\+vac\+\_\+copy()}, but they are afterwards overwritten.\end{DoxyRefDesc}


\begin{DoxyReturn}{Returns}
ierr
\end{DoxyReturn}

\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in,out}  & {\em vac} & vacuum variables\\
\hline
\mbox{\tt in}  & {\em n\+\_\+r\+\_\+in} & total number of rows of external poins of influence\\
\hline
\mbox{\tt in}  & {\em lims\+\_\+r\+\_\+in} & row limits of external points of influence\\
\hline
\mbox{\tt in}  & {\em x\+\_\+vec\+\_\+in} & external position of influence\\
\hline
\mbox{\tt in}  & {\em g\+\_\+in} & external G\\
\hline
\mbox{\tt in}  & {\em h\+\_\+in} & external H \\
\hline
\end{DoxyParams}


Definition at line 501 of file vac\+\_\+ops.\+f90.

Here is the call graph for this function\+:\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{namespacevac__ops_a7e3f92fbe9fa6cf3de6ac301676b96d1_cgraph}
\end{center}
\end{figure}
Here is the caller graph for this function\+:\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{namespacevac__ops_a7e3f92fbe9fa6cf3de6ac301676b96d1_icgraph}
\end{center}
\end{figure}
\mbox{\Hypertarget{namespacevac__ops_a267742c3c9a1b395aee76527d1e8352c}\label{namespacevac__ops_a267742c3c9a1b395aee76527d1e8352c}} 
\index{vac\+\_\+ops@{vac\+\_\+ops}!calc\+\_\+gh\+\_\+1@{calc\+\_\+gh\+\_\+1}}
\index{calc\+\_\+gh\+\_\+1@{calc\+\_\+gh\+\_\+1}!vac\+\_\+ops@{vac\+\_\+ops}}
\subsubsection{\texorpdfstring{calc\+\_\+gh\+\_\+1()}{calc\_gh\_1()}}
{\footnotesize\ttfamily integer function vac\+\_\+ops\+::calc\+\_\+gh\+\_\+1 (\begin{DoxyParamCaption}\item[{type(\hyperlink{structvac__vars_1_1vac__type}{vac\+\_\+type}), intent(inout)}]{vac,  }\item[{integer, intent(in)}]{n\+\_\+r\+\_\+in,  }\item[{integer, dimension(\+:,\+:), intent(in)}]{lims\+\_\+r\+\_\+in,  }\item[{real(dp), dimension(\+:,\+:), intent(in)}]{x\+\_\+vec\+\_\+in,  }\item[{real(dp), dimension(\+:,\+:), intent(in), pointer}]{G\+\_\+in,  }\item[{real(dp), dimension(\+:,\+:), intent(in), pointer}]{H\+\_\+in,  }\item[{logical, intent(in)}]{ext\+\_\+in }\end{DoxyParamCaption})}



Calculates matrices {\ttfamily G} and {\ttfamily H} in 3-\/D configuration. 

\begin{DoxySeeAlso}{See also}
\hyperlink{namespacevac__ops_a7e3f92fbe9fa6cf3de6ac301676b96d1}{calc\+\_\+gh}.
\end{DoxySeeAlso}

\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in,out}  & {\em vac} & vacuum variables\\
\hline
\mbox{\tt in}  & {\em n\+\_\+r\+\_\+in} & total number of rows of external poins of influence\\
\hline
\mbox{\tt in}  & {\em lims\+\_\+r\+\_\+in} & row limits of external points of influence\\
\hline
\mbox{\tt in}  & {\em x\+\_\+vec\+\_\+in} & position of influence\\
\hline
\mbox{\tt in}  & {\em g\+\_\+in} & G at position of influence\\
\hline
\mbox{\tt in}  & {\em h\+\_\+in} & H at position of influence\\
\hline
\mbox{\tt in}  & {\em ext\+\_\+in} & position of influence is external \\
\hline
\end{DoxyParams}


Definition at line 779 of file vac\+\_\+ops.\+f90.

Here is the call graph for this function\+:\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{namespacevac__ops_a267742c3c9a1b395aee76527d1e8352c_cgraph}
\end{center}
\end{figure}
Here is the caller graph for this function\+:\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{namespacevac__ops_a267742c3c9a1b395aee76527d1e8352c_icgraph}
\end{center}
\end{figure}
\mbox{\Hypertarget{namespacevac__ops_ae4987d1f48f1f83b1f0d38ea85b4998b}\label{namespacevac__ops_ae4987d1f48f1f83b1f0d38ea85b4998b}} 
\index{vac\+\_\+ops@{vac\+\_\+ops}!calc\+\_\+gh\+\_\+2@{calc\+\_\+gh\+\_\+2}}
\index{calc\+\_\+gh\+\_\+2@{calc\+\_\+gh\+\_\+2}!vac\+\_\+ops@{vac\+\_\+ops}}
\subsubsection{\texorpdfstring{calc\+\_\+gh\+\_\+2()}{calc\_gh\_2()}}
{\footnotesize\ttfamily integer function vac\+\_\+ops\+::calc\+\_\+gh\+\_\+2 (\begin{DoxyParamCaption}\item[{type(\hyperlink{structvac__vars_1_1vac__type}{vac\+\_\+type}), intent(inout)}]{vac,  }\item[{integer, intent(in)}]{n\+\_\+r\+\_\+in,  }\item[{integer, dimension(\+:,\+:), intent(in)}]{lims\+\_\+r\+\_\+in,  }\item[{real(dp), dimension(\+:,\+:), intent(in)}]{x\+\_\+vec\+\_\+in,  }\item[{real(dp), dimension(\+:,\+:), intent(in), pointer}]{G\+\_\+in,  }\item[{real(dp), dimension(\+:,\+:), intent(in), pointer}]{H\+\_\+in,  }\item[{logical, intent(in)}]{ext\+\_\+in }\end{DoxyParamCaption})}



Calculates matrices {\ttfamily G} and {\ttfamily H} in axisymmetric configurations. 

It makes use of toroidal functions.

\begin{DoxySeeAlso}{See also}
\hyperlink{namespacevac__ops_a7e3f92fbe9fa6cf3de6ac301676b96d1}{calc\+\_\+gh}.
\end{DoxySeeAlso}

\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in,out}  & {\em vac} & vacuum variables\\
\hline
\mbox{\tt in}  & {\em n\+\_\+r\+\_\+in} & total number of rows of external poins of influence\\
\hline
\mbox{\tt in}  & {\em lims\+\_\+r\+\_\+in} & row limits of external points of influence\\
\hline
\mbox{\tt in}  & {\em x\+\_\+vec\+\_\+in} & position of influence\\
\hline
\mbox{\tt in}  & {\em g\+\_\+in} & G at position of influence\\
\hline
\mbox{\tt in}  & {\em h\+\_\+in} & H at position of influence\\
\hline
\mbox{\tt in}  & {\em ext\+\_\+in} & position of influence is external \\
\hline
\end{DoxyParams}


Definition at line 983 of file vac\+\_\+ops.\+f90.

Here is the call graph for this function\+:\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{namespacevac__ops_ae4987d1f48f1f83b1f0d38ea85b4998b_cgraph}
\end{center}
\end{figure}
Here is the caller graph for this function\+:\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{namespacevac__ops_ae4987d1f48f1f83b1f0d38ea85b4998b_icgraph}
\end{center}
\end{figure}
\mbox{\Hypertarget{namespacevac__ops_a5e5a8322b3aa2e3704b1050426f06d9d}\label{namespacevac__ops_a5e5a8322b3aa2e3704b1050426f06d9d}} 
\index{vac\+\_\+ops@{vac\+\_\+ops}!calc\+\_\+vac\+\_\+res@{calc\+\_\+vac\+\_\+res}}
\index{calc\+\_\+vac\+\_\+res@{calc\+\_\+vac\+\_\+res}!vac\+\_\+ops@{vac\+\_\+ops}}
\subsubsection{\texorpdfstring{calc\+\_\+vac\+\_\+res()}{calc\_vac\_res()}}
{\footnotesize\ttfamily integer function, public vac\+\_\+ops\+::calc\+\_\+vac\+\_\+res (\begin{DoxyParamCaption}\item[{type(modes\+\_\+type), intent(in)}]{mds,  }\item[{type(\hyperlink{structvac__vars_1_1vac__type}{vac\+\_\+type}), intent(inout)}]{vac }\end{DoxyParamCaption})}



Calculates the vacuum response. 

First {\ttfamily G} and {\ttfamily H} are completed if this is not the first Richardson level.

Then the vacuum contribution is calculated using the two-\/fold strategy of first solving $\overline{\text{H}}\overline{\Phi} = \overline{\text{G}}\overline{\text{E}} \overline{\text{P}}$, followed by left-\/multiplication of $\overline{\Phi}$ by $\overline{\text{P}}\overline{\text{E}}^\dagger$.

The non-\/square matrix $\overline{\text{E}}$ contains the exponents for different mode numbers and different poloidal grid points, whereas $\overline{\text{P}}$ are diagonal matrices that contain the factors $(nq-m)$.

In practice, the complex matrix $\overline{\text{E}}$ is split in the two components of a real matrix twice the width.

For vacuum style 1, the poloidal grid points correspond to the paralell grid points and have to be provied by a {\ttfamily grid} variable.

If {\ttfamily jump\+\_\+to\+\_\+sol} is used for the current Richardson level, the vacuum quantities are not calculated, but just restored.

Currently, this procedure only works for vacuum style 2 (axisymmetric).

\begin{DoxyReturn}{Returns}
ierr
\end{DoxyReturn}

\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em mds} & general modes variables\\
\hline
\mbox{\tt in,out}  & {\em vac} & vacuum variables \\
\hline
\end{DoxyParams}


Definition at line 1417 of file vac\+\_\+ops.\+f90.

Here is the call graph for this function\+:\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{namespacevac__ops_a5e5a8322b3aa2e3704b1050426f06d9d_cgraph}
\end{center}
\end{figure}
Here is the caller graph for this function\+:\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{namespacevac__ops_a5e5a8322b3aa2e3704b1050426f06d9d_icgraph}
\end{center}
\end{figure}
\mbox{\Hypertarget{namespacevac__ops_a78969bf43f80f0df3acf23c47edf7aff}\label{namespacevac__ops_a78969bf43f80f0df3acf23c47edf7aff}} 
\index{vac\+\_\+ops@{vac\+\_\+ops}!print\+\_\+output\+\_\+vac@{print\+\_\+output\+\_\+vac}}
\index{print\+\_\+output\+\_\+vac@{print\+\_\+output\+\_\+vac}!vac\+\_\+ops@{vac\+\_\+ops}}
\subsubsection{\texorpdfstring{print\+\_\+output\+\_\+vac()}{print\_output\_vac()}}
{\footnotesize\ttfamily integer function, public vac\+\_\+ops\+::print\+\_\+output\+\_\+vac (\begin{DoxyParamCaption}\item[{type(\hyperlink{structvac__vars_1_1vac__type}{vac\+\_\+type}), intent(in)}]{vac,  }\item[{character(len=$\ast$), intent(in)}]{data\+\_\+name,  }\item[{integer, intent(in), optional}]{rich\+\_\+lvl }\end{DoxyParamCaption})}



Print vacuum quantities of a certain order to an output file. 


\begin{DoxyItemize}
\item vac\+:
\begin{DoxyItemize}
\item {\ttfamily misc\+\_\+vac} 
\item {\ttfamily norm} 
\item {\ttfamily x\+\_\+vec} 
\item {\ttfamily vac\+\_\+res} 
\end{DoxyItemize}
\end{DoxyItemize}

If {\ttfamily rich\+\_\+lvl} is provided, {\ttfamily \char`\"{}\+\_\+\+R\+\_\+\mbox{[}rich\+\_\+lvl\mbox{]}\char`\"{}} is appended to the data name if it is {\ttfamily $>$0}.

\begin{DoxyNote}{Note}

\begin{DoxyEnumerate}
\item This routine should be called by a single process, in contrast to the other output routines such as \hyperlink{interfaceeq__ops_1_1print__output__eq}{eq\+\_\+ops.\+print\+\_\+output\+\_\+eq()}, \hyperlink{namespacesol__ops_a06eb95d55da45ff2a1f830a380e0cf80}{print\+\_\+output\+\_\+sol()}, ...
\item This process should be the last one, as it will set the boundary contribution.
\item This routine does not save the {\ttfamily H} and {\ttfamily G} matrices because they are large and foreseen to be saved directly as Hierarchical matrices in the future. They therefore need to be regenerated if Richardson restart is done, or when after a jump to solution, another Richardson level is attempted. In calc\+\_\+vac, it is checked when copying the vacuum variables from previous to current Richardson level, whether the {\ttfamily G} and {\ttfamily H} matrices are allocated and if not, they are calculated.
\end{DoxyEnumerate}
\end{DoxyNote}
\begin{DoxyReturn}{Returns}
ierr
\end{DoxyReturn}

\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em vac} & vacuum variables\\
\hline
\mbox{\tt in}  & {\em data\+\_\+name} & name under which to store\\
\hline
\mbox{\tt in}  & {\em rich\+\_\+lvl} & Richardson level to print \\
\hline
\end{DoxyParams}


Definition at line 2337 of file vac\+\_\+ops.\+f90.

Here is the call graph for this function\+:\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{namespacevac__ops_a78969bf43f80f0df3acf23c47edf7aff_cgraph}
\end{center}
\end{figure}
Here is the caller graph for this function\+:\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{namespacevac__ops_a78969bf43f80f0df3acf23c47edf7aff_icgraph}
\end{center}
\end{figure}
\mbox{\Hypertarget{namespacevac__ops_ace79efa50ae5a120e515164c99ce9582}\label{namespacevac__ops_ace79efa50ae5a120e515164c99ce9582}} 
\index{vac\+\_\+ops@{vac\+\_\+ops}!solve\+\_\+phi\+\_\+bem@{solve\+\_\+phi\+\_\+bem}}
\index{solve\+\_\+phi\+\_\+bem@{solve\+\_\+phi\+\_\+bem}!vac\+\_\+ops@{vac\+\_\+ops}}
\subsubsection{\texorpdfstring{solve\+\_\+phi\+\_\+bem()}{solve\_phi\_bem()}}
{\footnotesize\ttfamily integer function vac\+\_\+ops\+::solve\+\_\+phi\+\_\+bem (\begin{DoxyParamCaption}\item[{type(\hyperlink{structvac__vars_1_1vac__type}{vac\+\_\+type}), intent(in), target}]{vac,  }\item[{real(dp), dimension(\+:,\+:), intent(in)}]{R,  }\item[{real(dp), dimension(\+:,\+:), intent(inout), target}]{Phi,  }\item[{integer, dimension(2), intent(in)}]{n\+\_\+\+R\+Phi,  }\item[{integer, dimension(2), intent(in)}]{n\+\_\+loc\+\_\+\+R\+Phi,  }\item[{integer, dimension(\+:,\+:), intent(in)}]{lims\+\_\+c\+\_\+\+R\+Phi,  }\item[{integer, dimension(blacsctxtsize), intent(in), target}]{desc\+\_\+\+R\+Phi }\end{DoxyParamCaption})}



Calculates potential {\ttfamily Phi} on boundary of B\+EM in terms of some right-\/hand side . 

This is done by solving with S\+T\+R\+U\+M\+Pack the system of equations $\overline{\text{H}}\overline{\Phi} = \overline{\text{G}}\overline{\text{R}}$, where $\overline{\text{R}}$ is the right-\/hand side, for example equal to $\overline{\text{E}}\overline{\text{P}}$ to solve in function of the individual Fourier modes.


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em vac} & vacuum variables\\
\hline
\mbox{\tt in,out}  & {\em phi} & $\overline{\Phi}$\\
\hline
\mbox{\tt in}  & {\em r} & $\overline{\text{R}}$\\
\hline
\mbox{\tt in}  & {\em n\+\_\+rphi} & {\ttfamily n} for $\overline{\text{R}}$ and $\overline{\Phi}$\\
\hline
\mbox{\tt in}  & {\em n\+\_\+loc\+\_\+rphi} & local {\ttfamily n} for $\overline{\text{R}}$ and $\overline{\Phi}$\\
\hline
\mbox{\tt in}  & {\em lims\+\_\+c\+\_\+rphi} & local limits for row and columns of $\overline{\text{R}}$ and $\overline{\Phi}$\\
\hline
\mbox{\tt in}  & {\em desc\+\_\+rphi} & descriptor for $\overline{\text{R}}$ and $\overline{\Phi}$ \\
\hline
\end{DoxyParams}


Definition at line 2153 of file vac\+\_\+ops.\+f90.

Here is the call graph for this function\+:\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{namespacevac__ops_ace79efa50ae5a120e515164c99ce9582_cgraph}
\end{center}
\end{figure}
Here is the caller graph for this function\+:\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{namespacevac__ops_ace79efa50ae5a120e515164c99ce9582_icgraph}
\end{center}
\end{figure}
\mbox{\Hypertarget{namespacevac__ops_a37220702fbf378626a0f2c12f446e0aa}\label{namespacevac__ops_a37220702fbf378626a0f2c12f446e0aa}} 
\index{vac\+\_\+ops@{vac\+\_\+ops}!store\+\_\+vac@{store\+\_\+vac}}
\index{store\+\_\+vac@{store\+\_\+vac}!vac\+\_\+ops@{vac\+\_\+ops}}
\subsubsection{\texorpdfstring{store\+\_\+vac()}{store\_vac()}}
{\footnotesize\ttfamily integer function, public vac\+\_\+ops\+::store\+\_\+vac (\begin{DoxyParamCaption}\item[{type(\hyperlink{structgrid__vars_1_1grid__type}{grid\+\_\+type}), intent(in)}]{grid,  }\item[{type(\hyperlink{structeq__vars_1_1eq__1__type}{eq\+\_\+1\+\_\+type}), intent(in)}]{eq\+\_\+1,  }\item[{type(\hyperlink{structeq__vars_1_1eq__2__type}{eq\+\_\+2\+\_\+type}), intent(in)}]{eq\+\_\+2,  }\item[{type(\hyperlink{structvac__vars_1_1vac__type}{vac\+\_\+type}), intent(inout)}]{vac }\end{DoxyParamCaption})}



Stores calculation of the vacuum response by storing the necessary variables. 

This is done by the last process, which is the one that contains the variables at the plasma edge, and then this is broadcasted to the other processes.

The workings of this routine are summarized in the following diagram for V\+M\+EC\+: 
\begin{DoxyImageNoCaption}
  \mbox{\includegraphics[width=\textwidth,height=\textheight/2,keepaspectratio=true]{dot_inline_dotgraph_1}}
\end{DoxyImageNoCaption}


Before storing the new variables, the procedure checks the following things\+:
\begin{DoxyItemize}
\item For the first equilibrium job, this routine copies the results from the previous Richardson level into the appropriate subranges of the new vacuum variables if no restart of Richardson levels was done.
\item If a restart was done and the level is greater than one, there is a reconstruction of the previous level\textquotesingle{}s variables. But this will happen in \hyperlink{namespacevac__ops_a5e5a8322b3aa2e3704b1050426f06d9d}{calc\+\_\+vac\+\_\+res()}, not in this procedure.
\end{DoxyItemize}

If there is a jump straight to the solution, however, the procedure returns after reconstructing the current level\textquotesingle{}s variables.

If the previous {\ttfamily G} and {\ttfamily H} variables are empty, they are regenerated later, in \hyperlink{namespacevac__ops_a7e3f92fbe9fa6cf3de6ac301676b96d1}{calc\+\_\+gh()}. This indicates that a reconstruction happened, either because a Richardson restart was performed, or because a new Richardson level was started after a previous level in which it was jumped straight to the solution.

For H\+E\+L\+E\+NA, there is only 1 equilibrium job at the first Richardson level, and the vacuum has to be calculated only once then. If there is a jump to solution or if there is Richardson restart, it only needs to be reconstructed.

\begin{DoxyReturn}{Returns}
ierr
\end{DoxyReturn}

\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em grid} & equilibrium grid\\
\hline
\mbox{\tt in}  & {\em eq\+\_\+1} & flux equilibrium variables\\
\hline
\mbox{\tt in}  & {\em eq\+\_\+2} & metric equilibrium variables\\
\hline
\mbox{\tt in,out}  & {\em vac} & vacuum variables \\
\hline
\end{DoxyParams}


Definition at line 113 of file vac\+\_\+ops.\+f90.

Here is the call graph for this function\+:\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{namespacevac__ops_a37220702fbf378626a0f2c12f446e0aa_cgraph}
\end{center}
\end{figure}
Here is the caller graph for this function\+:\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{namespacevac__ops_a37220702fbf378626a0f2c12f446e0aa_icgraph}
\end{center}
\end{figure}
\mbox{\Hypertarget{namespacevac__ops_a3a2a3aed45951aecef42197b82a5a6da}\label{namespacevac__ops_a3a2a3aed45951aecef42197b82a5a6da}} 
\index{vac\+\_\+ops@{vac\+\_\+ops}!vac\+\_\+pot\+\_\+plot@{vac\+\_\+pot\+\_\+plot}}
\index{vac\+\_\+pot\+\_\+plot@{vac\+\_\+pot\+\_\+plot}!vac\+\_\+ops@{vac\+\_\+ops}}
\subsubsection{\texorpdfstring{vac\+\_\+pot\+\_\+plot()}{vac\_pot\_plot()}}
{\footnotesize\ttfamily integer function, public vac\+\_\+ops\+::vac\+\_\+pot\+\_\+plot (\begin{DoxyParamCaption}\item[{type(\hyperlink{structgrid__vars_1_1grid__type}{grid\+\_\+type}), intent(in)}]{grid\+\_\+sol,  }\item[{type(\hyperlink{structvac__vars_1_1vac__type}{vac\+\_\+type}), intent(inout)}]{vac,  }\item[{type(\hyperlink{structsol__vars_1_1sol__type}{sol\+\_\+type}), intent(in)}]{sol,  }\item[{integer, intent(in)}]{X\+\_\+id }\end{DoxyParamCaption})}



Calculate vacuum potential at some positions that are not resonant. 

This is done by using the relation between H and G on the plasma boundary, $\overline{\text{H}}_\text{s} \overline{\Phi}_\text{s} = \overline{\text{G}}_\text{s} \overline{\text{D}\phi}_\text{s}$, where $\overline{\text{D}\phi}_\text{s}$ is the normal derivative of the potential on the plasma edge. The matrices $\overline{\text{H}}$ and $\overline{\text{G}}$ have to be calculated in advance.

This relation is then used at different positions to calculate the potential at a different position through $4 \pi \phi = \left[ - \overline{\text{H}} \overline{\text{I}} \overline{\text{H}}_\text{s}^{-1} \overline{\text{G}}_\text{s} + \overline{\text{G}} \overline{\text{I}} \right] \overline{\text{D}\phi}_\text{s}$, where $\overline{\text{I}}$ is an integration rule.

This system of equations contains one row per point at which the potential is to be calculated.

Currently, this routine creates a 3-\/D regular grid that is equidistant in cylindrical coordinates, with {\ttfamily n\+\_\+vac\+\_\+plot} values in R and Z, and {\ttfamily n\+\_\+zeta\+\_\+plot} values in the cylindrical angle. The limits in these variables, furthermore, are given by {\ttfamily min\+\_\+\+Rvac\+\_\+plot}, {\ttfamily max\+\_\+\+Rvac\+\_\+plot}, {\ttfamily min\+\_\+\+Zvac\+\_\+plot}, {\ttfamily max\+\_\+\+Zvac\+\_\+plot}, {\ttfamily min\+\_\+zeta\+\_\+plot} and {\ttfamily max\+\_\+zeta\+\_\+plot}.


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em grid\+\_\+sol} & solution grid\\
\hline
\mbox{\tt in,out}  & {\em vac} & vacuum variables\\
\hline
\mbox{\tt in}  & {\em sol} & solution variables\\
\hline
\mbox{\tt in}  & {\em x\+\_\+id} & nr. of Eigenvalue \\
\hline
\end{DoxyParams}


Definition at line 1847 of file vac\+\_\+ops.\+f90.

Here is the call graph for this function\+:\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{namespacevac__ops_a3a2a3aed45951aecef42197b82a5a6da_cgraph}
\end{center}
\end{figure}
Here is the caller graph for this function\+:\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{namespacevac__ops_a3a2a3aed45951aecef42197b82a5a6da_icgraph}
\end{center}
\end{figure}


\subsection{Variable Documentation}
\mbox{\Hypertarget{namespacevac__ops_a9c1d2227ea0118cb9158f7e08f41affc}\label{namespacevac__ops_a9c1d2227ea0118cb9158f7e08f41affc}} 
\index{vac\+\_\+ops@{vac\+\_\+ops}!debug\+\_\+calc\+\_\+gh@{debug\+\_\+calc\+\_\+gh}}
\index{debug\+\_\+calc\+\_\+gh@{debug\+\_\+calc\+\_\+gh}!vac\+\_\+ops@{vac\+\_\+ops}}
\subsubsection{\texorpdfstring{debug\+\_\+calc\+\_\+gh}{debug\_calc\_gh}}
{\footnotesize\ttfamily logical, public vac\+\_\+ops\+::debug\+\_\+calc\+\_\+gh = .true.}



plot debug information for calc\+\_\+\+G\+H() 

\begin{DoxyNote}{Note}
Debug version only 
\end{DoxyNote}


Definition at line 46 of file vac\+\_\+ops.\+f90.

\mbox{\Hypertarget{namespacevac__ops_a6b99f921f077f63f641d5a9c86d88eaf}\label{namespacevac__ops_a6b99f921f077f63f641d5a9c86d88eaf}} 
\index{vac\+\_\+ops@{vac\+\_\+ops}!debug\+\_\+calc\+\_\+vac\+\_\+res@{debug\+\_\+calc\+\_\+vac\+\_\+res}}
\index{debug\+\_\+calc\+\_\+vac\+\_\+res@{debug\+\_\+calc\+\_\+vac\+\_\+res}!vac\+\_\+ops@{vac\+\_\+ops}}
\subsubsection{\texorpdfstring{debug\+\_\+calc\+\_\+vac\+\_\+res}{debug\_calc\_vac\_res}}
{\footnotesize\ttfamily logical, public vac\+\_\+ops\+::debug\+\_\+calc\+\_\+vac\+\_\+res = .true.}



plot debug information for \hyperlink{namespacevac__ops_a5e5a8322b3aa2e3704b1050426f06d9d}{calc\+\_\+vac\+\_\+res()} 

\begin{DoxyNote}{Note}
Debug version only 
\end{DoxyNote}


Definition at line 47 of file vac\+\_\+ops.\+f90.

\mbox{\Hypertarget{namespacevac__ops_a1afb20e30f5f99547fc8df4ace204ee9}\label{namespacevac__ops_a1afb20e30f5f99547fc8df4ace204ee9}} 
\index{vac\+\_\+ops@{vac\+\_\+ops}!debug\+\_\+vac\+\_\+pot\+\_\+plot@{debug\+\_\+vac\+\_\+pot\+\_\+plot}}
\index{debug\+\_\+vac\+\_\+pot\+\_\+plot@{debug\+\_\+vac\+\_\+pot\+\_\+plot}!vac\+\_\+ops@{vac\+\_\+ops}}
\subsubsection{\texorpdfstring{debug\+\_\+vac\+\_\+pot\+\_\+plot}{debug\_vac\_pot\_plot}}
{\footnotesize\ttfamily logical, public vac\+\_\+ops\+::debug\+\_\+vac\+\_\+pot\+\_\+plot = .true.}



plot debug information for \hyperlink{namespacevac__ops_a3a2a3aed45951aecef42197b82a5a6da}{vac\+\_\+pot\+\_\+plot()} 

\begin{DoxyNote}{Note}
Debug version only 
\end{DoxyNote}


Definition at line 48 of file vac\+\_\+ops.\+f90.

