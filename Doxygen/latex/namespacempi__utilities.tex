\doxysection{mpi\+\_\+utilities Module Reference}
\hypertarget{namespacempi__utilities}{}\label{namespacempi__utilities}\index{mpi\_utilities@{mpi\_utilities}}


Numerical utilities related to MPI.  


\doxysubsubsection*{Interfaces and Types}
\begin{DoxyCompactItemize}
\item 
interface \doxymbox{\hyperlink{interfacempi__utilities_1_1get__ser__var}{get\+\_\+ser\+\_\+var}}
\begin{DoxyCompactList}\small\item\em Gather parallel variable in serial version on group master. \end{DoxyCompactList}\item 
interface \doxymbox{\hyperlink{interfacempi__utilities_1_1get__ghost__arr}{get\+\_\+ghost\+\_\+arr}}
\begin{DoxyCompactList}\small\item\em Fill the ghost regions in an array. \end{DoxyCompactList}\item 
interface \doxymbox{\hyperlink{interfacempi__utilities_1_1broadcast__var}{broadcast\+\_\+var}}
\begin{DoxyCompactList}\small\item\em Wrapper function to broadcast a single variable using MPI. \end{DoxyCompactList}\end{DoxyCompactItemize}
\doxysubsubsection*{Functions/\+\+Subroutines}
\begin{DoxyCompactItemize}
\item 
integer function, public \doxymbox{\hyperlink{namespacempi__utilities_a128702990bd5fddc582e8fabcffc82b2}{redistribute\+\_\+var}} (var, dis\+\_\+var, lims, lims\+\_\+dis)
\begin{DoxyCompactList}\small\item\em Redistribute variables according to new limits. \end{DoxyCompactList}\item 
integer function, public \doxymbox{\hyperlink{namespacempi__utilities_a790ea24d32dd0e249541c1e57cd85536}{wait\+\_\+mpi}} ()
\begin{DoxyCompactList}\small\item\em Wait for all processes, wrapper to MPI barrier. \end{DoxyCompactList}\item 
integer function, public \doxymbox{\hyperlink{namespacempi__utilities_a5a789d05be41d6109c01f46cc98620c8}{lock\+\_\+req\+\_\+acc}} (lock, blocking)
\begin{DoxyCompactList}\small\item\em Request access to lock of a BL (blocking) or optionally a NB (non-\/blocking) type. \end{DoxyCompactList}\item 
integer function, public \doxymbox{\hyperlink{namespacempi__utilities_a86f9982a0f92b51a916f832d9a3d8ba9}{lock\+\_\+return\+\_\+acc}} (lock)
\begin{DoxyCompactList}\small\item\em Returns access to a lock. \end{DoxyCompactList}\item 
integer function, public \doxymbox{\hyperlink{namespacempi__utilities_a3b0349e5ec825e14083e3126c3e7ba65}{lock\+\_\+wl\+\_\+change}} (wl\+\_\+action, blocking, lock\+\_\+loc, wl, ranks)
\begin{DoxyCompactList}\small\item\em Adds, removes or sets to active a rank from the waiting list for a lock and returns the lock waiting list:\+ \end{DoxyCompactList}\item 
character(len=max\+\_\+str\+\_\+ln) function, public \doxymbox{\hyperlink{namespacempi__utilities_abe5bf3ae3b6a06eda18c2f4d62ac09c5}{lock\+\_\+header}} (lock\+\_\+loc)
\begin{DoxyCompactList}\small\item\em Returns the header for lock debug messages. \end{DoxyCompactList}\end{DoxyCompactItemize}
\doxysubsubsection*{Variables}
\begin{DoxyCompactItemize}
\item 
logical, public \doxymbox{\hyperlink{namespacempi__utilities_a98291c400747762ea4e3f0d751c5d5f5}{debug\+\_\+lock}} = .false.
\begin{DoxyCompactList}\small\item\em print debug information about lock operations \end{DoxyCompactList}\item 
integer, public \doxymbox{\hyperlink{namespacempi__utilities_a38a87fa6a7efbd985592bbef4750f02b}{n\+\_\+waits}} = 0
\begin{DoxyCompactList}\small\item\em number of waits \end{DoxyCompactList}\end{DoxyCompactItemize}


\doxysubsection{Detailed Description}
Numerical utilities related to MPI. 

This includes a lock system, which can be both BL (blocking) or NB (non-\/blocking). It is based on the implementation of an MPI-\/\+IO atomic mode without file support, described in \DoxyCite{rossatomicio}{number}{1}.

\begin{DoxySeeAlso}{See also}
See \doxylink{namespacempi__vars}{mpi\+\_\+vars}.
\end{DoxySeeAlso}
The reason for this was the fact that using a simple lock file can lead to crashes.

\begin{DoxyNote}{Note}
A downside of this method is that in some rare cases a deadlock may occur as the master process, which contains the shared variable with a window that other processes may use, is idle and waiting, whereas the others are still performing lock options. As the master is idle and waiting, its MPI asynchronous communication is not performed. To remedy this, just call wait\+\_\+\+MPI() after procedures where lock operations are performed. 
\end{DoxyNote}


\label{doc-func-members}
\Hypertarget{namespacempi__utilities_doc-func-members}
\doxysubsection{Function/\+\+Subroutine Documentation}
\Hypertarget{namespacempi__utilities_abe5bf3ae3b6a06eda18c2f4d62ac09c5}\index{mpi\_utilities@{mpi\_utilities}!lock\_header@{lock\_header}}
\index{lock\_header@{lock\_header}!mpi\_utilities@{mpi\_utilities}}
\doxysubsubsection{\texorpdfstring{lock\_header()}{lock\_header()}}
{\footnotesize\ttfamily \label{namespacempi__utilities_abe5bf3ae3b6a06eda18c2f4d62ac09c5} 
character(len=max\+\_\+str\+\_\+ln) function, public mpi\+\_\+utilities::\+lock\+\_\+header (\begin{DoxyParamCaption}\item[{type(\doxymbox{\hyperlink{structmpi__vars_1_1lock__type}{lock\+\_\+type}}), intent(in)}]{lock\+\_\+loc}{}\end{DoxyParamCaption})}



Returns the header for lock debug messages. 

\begin{DoxyNote}{Note}
Debug version only 
\end{DoxyNote}

\begin{DoxyParams}[1]{Parameters}
\doxymbox{\texttt{in}}  & {\em lock\+\_\+loc} & lock \\
\hline
\end{DoxyParams}


Definition at line \doxymbox{\hyperlink{MPI__utilities_8f90_source_l01216}{1216}} of file \doxymbox{\hyperlink{MPI__utilities_8f90_source}{MPI\+\_\+utilities.\+f90}}.

Here is the call graph for this function:\+\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{namespacempi__utilities_abe5bf3ae3b6a06eda18c2f4d62ac09c5_cgraph}
\end{center}
\end{figure}
Here is the caller graph for this function:\+\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{namespacempi__utilities_abe5bf3ae3b6a06eda18c2f4d62ac09c5_icgraph}
\end{center}
\end{figure}
\Hypertarget{namespacempi__utilities_a5a789d05be41d6109c01f46cc98620c8}\index{mpi\_utilities@{mpi\_utilities}!lock\_req\_acc@{lock\_req\_acc}}
\index{lock\_req\_acc@{lock\_req\_acc}!mpi\_utilities@{mpi\_utilities}}
\doxysubsubsection{\texorpdfstring{lock\_req\_acc()}{lock\_req\_acc()}}
{\footnotesize\ttfamily \label{namespacempi__utilities_a5a789d05be41d6109c01f46cc98620c8} 
integer function, public mpi\+\_\+utilities::\+lock\+\_\+req\+\_\+acc (\begin{DoxyParamCaption}\item[{type(\doxymbox{\hyperlink{structmpi__vars_1_1lock__type}{lock\+\_\+type}}), intent(inout)}]{lock}{, }\item[{logical, intent(in), optional}]{blocking}{}\end{DoxyParamCaption})}



Request access to lock of a BL (blocking) or optionally a NB (non-\/blocking) type. 

\begin{DoxyNote}{Note}
Based on \DoxyCite{rossatomicio}{number}{1}.
\end{DoxyNote}
\begin{DoxyReturn}{Returns}
ierr 
\end{DoxyReturn}


Definition at line \doxymbox{\hyperlink{MPI__utilities_8f90_source_l00764}{764}} of file \doxymbox{\hyperlink{MPI__utilities_8f90_source}{MPI\+\_\+utilities.\+f90}}.

Here is the call graph for this function:\+\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{namespacempi__utilities_a5a789d05be41d6109c01f46cc98620c8_cgraph}
\end{center}
\end{figure}
Here is the caller graph for this function:\+\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{namespacempi__utilities_a5a789d05be41d6109c01f46cc98620c8_icgraph}
\end{center}
\end{figure}
\Hypertarget{namespacempi__utilities_a86f9982a0f92b51a916f832d9a3d8ba9}\index{mpi\_utilities@{mpi\_utilities}!lock\_return\_acc@{lock\_return\_acc}}
\index{lock\_return\_acc@{lock\_return\_acc}!mpi\_utilities@{mpi\_utilities}}
\doxysubsubsection{\texorpdfstring{lock\_return\_acc()}{lock\_return\_acc()}}
{\footnotesize\ttfamily \label{namespacempi__utilities_a86f9982a0f92b51a916f832d9a3d8ba9} 
integer function, public mpi\+\_\+utilities::\+lock\+\_\+return\+\_\+acc (\begin{DoxyParamCaption}\item[{type(\doxymbox{\hyperlink{structmpi__vars_1_1lock__type}{lock\+\_\+type}}), intent(inout)}]{lock}{}\end{DoxyParamCaption})}



Returns access to a lock. 

The blocking property has been set when requesting the lock.

\begin{DoxyNote}{Note}
Based on \DoxyCite{rossatomicio}{number}{1}.
\end{DoxyNote}
\begin{DoxyReturn}{Returns}
ierr 
\end{DoxyReturn}


Definition at line \doxymbox{\hyperlink{MPI__utilities_8f90_source_l00871}{871}} of file \doxymbox{\hyperlink{MPI__utilities_8f90_source}{MPI\+\_\+utilities.\+f90}}.

Here is the call graph for this function:\+\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{namespacempi__utilities_a86f9982a0f92b51a916f832d9a3d8ba9_cgraph}
\end{center}
\end{figure}
Here is the caller graph for this function:\+\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{namespacempi__utilities_a86f9982a0f92b51a916f832d9a3d8ba9_icgraph}
\end{center}
\end{figure}
\Hypertarget{namespacempi__utilities_a3b0349e5ec825e14083e3126c3e7ba65}\index{mpi\_utilities@{mpi\_utilities}!lock\_wl\_change@{lock\_wl\_change}}
\index{lock\_wl\_change@{lock\_wl\_change}!mpi\_utilities@{mpi\_utilities}}
\doxysubsubsection{\texorpdfstring{lock\_wl\_change()}{lock\_wl\_change()}}
{\footnotesize\ttfamily \label{namespacempi__utilities_a3b0349e5ec825e14083e3126c3e7ba65} 
integer function, public mpi\+\_\+utilities::\+lock\+\_\+wl\+\_\+change (\begin{DoxyParamCaption}\item[{integer, intent(in)}]{wl\+\_\+action}{, }\item[{logical, intent(in)}]{blocking}{, }\item[{type(\doxymbox{\hyperlink{structmpi__vars_1_1lock__type}{lock\+\_\+type}}), intent(inout)}]{lock\+\_\+loc}{, }\item[{integer, dimension(:\+), intent(inout), allocatable}]{wl}{, }\item[{integer, dimension(:\+), intent(in), optional}]{ranks}{}\end{DoxyParamCaption})}



Adds, removes or sets to active a rank from the waiting list for a lock and returns the lock waiting list:\+ 

Actions:\+
\begin{DoxyItemize}
\item {\ttfamily wl\+\_\+action} = 0:\+ remove
\item {\ttfamily wl\+\_\+action} = 1:\+ add
\item {\ttfamily wl\+\_\+action} = 2:\+ active
\end{DoxyItemize}

Or negative equivalents for non-\/blocking (NB) procs.

Optionally, the rank(s) of the process for which to perform this action can be passed. This is useful for doing the same action on multiple processes.

\begin{DoxyNote}{Note}
Based on \DoxyCite{rossatomicio}{number}{1}.

Debug version only
\end{DoxyNote}
\begin{DoxyReturn}{Returns}
ierr 
\end{DoxyReturn}

\begin{DoxyParams}[1]{Parameters}
\doxymbox{\texttt{in}}  & {\em wl\+\_\+action} & action to perform \\
\hline
\doxymbox{\texttt{in}}  & {\em blocking} & the ranks to be changed are blocking \\
\hline
\doxymbox{\texttt{in,out}}  & {\em lock\+\_\+loc} & lock \\
\hline
\doxymbox{\texttt{in,out}}  & {\em wl} & waiting list \\
\hline
\doxymbox{\texttt{in}}  & {\em ranks} & rank(s) for which to perform option \\
\hline
\end{DoxyParams}


Definition at line \doxymbox{\hyperlink{MPI__utilities_8f90_source_l01109}{1109}} of file \doxymbox{\hyperlink{MPI__utilities_8f90_source}{MPI\+\_\+utilities.\+f90}}.

Here is the call graph for this function:\+\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{namespacempi__utilities_a3b0349e5ec825e14083e3126c3e7ba65_cgraph}
\end{center}
\end{figure}
Here is the caller graph for this function:\+\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{namespacempi__utilities_a3b0349e5ec825e14083e3126c3e7ba65_icgraph}
\end{center}
\end{figure}
\Hypertarget{namespacempi__utilities_a128702990bd5fddc582e8fabcffc82b2}\index{mpi\_utilities@{mpi\_utilities}!redistribute\_var@{redistribute\_var}}
\index{redistribute\_var@{redistribute\_var}!mpi\_utilities@{mpi\_utilities}}
\doxysubsubsection{\texorpdfstring{redistribute\_var()}{redistribute\_var()}}
{\footnotesize\ttfamily \label{namespacempi__utilities_a128702990bd5fddc582e8fabcffc82b2} 
integer function, public mpi\+\_\+utilities::\+redistribute\+\_\+var (\begin{DoxyParamCaption}\item[{real(dp), dimension(:\+), intent(in)}]{var}{, }\item[{real(dp), dimension(:\+), intent(inout)}]{dis\+\_\+var}{, }\item[{integer, dimension(2), intent(in)}]{lims}{, }\item[{integer, dimension(2), intent(in)}]{lims\+\_\+dis}{}\end{DoxyParamCaption})}



Redistribute variables according to new limits. 


\begin{DoxyParams}[1]{Parameters}
\doxymbox{\texttt{in}}  & {\em var} & parallel vector \\
\hline
\doxymbox{\texttt{in,out}}  & {\em dis\+\_\+var} & redistributed vector \\
\hline
\doxymbox{\texttt{in}}  & {\em lims} & indices of parallel vector \\
\hline
\doxymbox{\texttt{in}}  & {\em lims\+\_\+dis} & indices of redistributed parallel vector \\
\hline
\end{DoxyParams}


Definition at line \doxymbox{\hyperlink{MPI__utilities_8f90_source_l00329}{329}} of file \doxymbox{\hyperlink{MPI__utilities_8f90_source}{MPI\+\_\+utilities.\+f90}}.

Here is the caller graph for this function:\+\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{namespacempi__utilities_a128702990bd5fddc582e8fabcffc82b2_icgraph}
\end{center}
\end{figure}
\Hypertarget{namespacempi__utilities_a790ea24d32dd0e249541c1e57cd85536}\index{mpi\_utilities@{mpi\_utilities}!wait\_mpi@{wait\_mpi}}
\index{wait\_mpi@{wait\_mpi}!mpi\_utilities@{mpi\_utilities}}
\doxysubsubsection{\texorpdfstring{wait\_mpi()}{wait\_mpi()}}
{\footnotesize\ttfamily \label{namespacempi__utilities_a790ea24d32dd0e249541c1e57cd85536} 
integer function, public mpi\+\_\+utilities::\+wait\+\_\+mpi}



Wait for all processes, wrapper to MPI barrier. 

\begin{DoxyReturn}{Returns}
ierr 
\end{DoxyReturn}


Definition at line \doxymbox{\hyperlink{MPI__utilities_8f90_source_l00743}{743}} of file \doxymbox{\hyperlink{MPI__utilities_8f90_source}{MPI\+\_\+utilities.\+f90}}.

Here is the caller graph for this function:\+\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{namespacempi__utilities_a790ea24d32dd0e249541c1e57cd85536_icgraph}
\end{center}
\end{figure}


\label{doc-var-members}
\Hypertarget{namespacempi__utilities_doc-var-members}
\doxysubsection{Variable Documentation}
\Hypertarget{namespacempi__utilities_a98291c400747762ea4e3f0d751c5d5f5}\index{mpi\_utilities@{mpi\_utilities}!debug\_lock@{debug\_lock}}
\index{debug\_lock@{debug\_lock}!mpi\_utilities@{mpi\_utilities}}
\doxysubsubsection{\texorpdfstring{debug\_lock}{debug\_lock}}
{\footnotesize\ttfamily \label{namespacempi__utilities_a98291c400747762ea4e3f0d751c5d5f5} 
logical, public mpi\+\_\+utilities::\+debug\+\_\+lock = .false.}



print debug information about lock operations 

\begin{DoxyNote}{Note}
Debug version only 
\end{DoxyNote}


Definition at line \doxymbox{\hyperlink{MPI__utilities_8f90_source_l00040}{40}} of file \doxymbox{\hyperlink{MPI__utilities_8f90_source}{MPI\+\_\+utilities.\+f90}}.

\Hypertarget{namespacempi__utilities_a38a87fa6a7efbd985592bbef4750f02b}\index{mpi\_utilities@{mpi\_utilities}!n\_waits@{n\_waits}}
\index{n\_waits@{n\_waits}!mpi\_utilities@{mpi\_utilities}}
\doxysubsubsection{\texorpdfstring{n\_waits}{n\_waits}}
{\footnotesize\ttfamily \label{namespacempi__utilities_a38a87fa6a7efbd985592bbef4750f02b} 
integer, public mpi\+\_\+utilities::\+n\+\_\+waits = 0}



number of waits 

\begin{DoxyNote}{Note}
Debug version only 
\end{DoxyNote}


Definition at line \doxymbox{\hyperlink{MPI__utilities_8f90_source_l00041}{41}} of file \doxymbox{\hyperlink{MPI__utilities_8f90_source}{MPI\+\_\+utilities.\+f90}}.

