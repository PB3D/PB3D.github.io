\doxysection{helena\+\_\+ops Module Reference}
\hypertarget{namespacehelena__ops}{}\label{namespacehelena__ops}\index{helena\_ops@{helena\_ops}}


Operations on HELENA variables.  


\doxysubsubsection*{Functions/\+\+Subroutines}
\begin{DoxyCompactItemize}
\item 
integer function, public \doxymbox{\hyperlink{namespacehelena__ops_ad227f370bcd063642a98b57e7a4a5abc}{read\+\_\+hel}} (n\+\_\+r\+\_\+in, use\+\_\+pol\+\_\+flux\+\_\+h)
\begin{DoxyCompactList}\small\item\em Reads the HELENA equilibrium data. \end{DoxyCompactList}\item 
integer function, public \doxymbox{\hyperlink{namespacehelena__ops_a11defc7f58c96da44f6ac492cb8e4a31}{interp\+\_\+hel\+\_\+on\+\_\+grid}} (grid\+\_\+in, grid\+\_\+out, eq\+\_\+2, x\+\_\+1, x\+\_\+2, eq\+\_\+2\+\_\+out, x\+\_\+1\+\_\+out, x\+\_\+2\+\_\+out, eq\+\_\+1, grid\+\_\+name)
\begin{DoxyCompactList}\small\item\em Interpolate variables resulting from HELENA equilibria to another grid (angularly). \end{DoxyCompactList}\item 
integer function, public \doxymbox{\hyperlink{namespacehelena__ops_a0f156b3653264fb016d6d311eb59114c}{test\+\_\+metrics\+\_\+h}} ()
\begin{DoxyCompactList}\small\item\em Checks whether the metric elements provided by HELENA are consistent with a direct calculation using the coordinate transformations \DoxyCite{weyens3d}{number}{1}. \end{DoxyCompactList}\item 
integer function, public \doxymbox{\hyperlink{namespacehelena__ops_a83f2ad5dc967c7bae287b60fddb8eb0a}{test\+\_\+harm\+\_\+cont\+\_\+h}} ()
\begin{DoxyCompactList}\small\item\em Investaige harmonic content of the HELENA variables. \end{DoxyCompactList}\end{DoxyCompactItemize}


\doxysubsection{Detailed Description}
Operations on HELENA variables. 

\label{doc-func-members}
\Hypertarget{namespacehelena__ops_doc-func-members}
\doxysubsection{Function/\+\+Subroutine Documentation}
\Hypertarget{namespacehelena__ops_a11defc7f58c96da44f6ac492cb8e4a31}\index{helena\_ops@{helena\_ops}!interp\_hel\_on\_grid@{interp\_hel\_on\_grid}}
\index{interp\_hel\_on\_grid@{interp\_hel\_on\_grid}!helena\_ops@{helena\_ops}}
\doxysubsubsection{\texorpdfstring{interp\_hel\_on\_grid()}{interp\_hel\_on\_grid()}}
{\footnotesize\ttfamily \label{namespacehelena__ops_a11defc7f58c96da44f6ac492cb8e4a31} 
integer function, public helena\+\_\+ops::\+interp\+\_\+hel\+\_\+on\+\_\+grid (\begin{DoxyParamCaption}\item[{type(\doxymbox{\hyperlink{structgrid__vars_1_1grid__type}{grid\+\_\+type}}), intent(in)}]{grid\+\_\+in}{, }\item[{type(\doxymbox{\hyperlink{structgrid__vars_1_1grid__type}{grid\+\_\+type}}), intent(in)}]{grid\+\_\+out}{, }\item[{type(\doxymbox{\hyperlink{structeq__vars_1_1eq__2__type}{eq\+\_\+2\+\_\+type}}), intent(inout), optional}]{eq\+\_\+2}{, }\item[{type(\doxymbox{\hyperlink{structx__vars_1_1x__1__type}{x\+\_\+1\+\_\+type}}), intent(inout), optional}]{x\+\_\+1}{, }\item[{type(\doxymbox{\hyperlink{structx__vars_1_1x__2__type}{x\+\_\+2\+\_\+type}}), intent(inout), optional}]{x\+\_\+2}{, }\item[{type(\doxymbox{\hyperlink{structeq__vars_1_1eq__2__type}{eq\+\_\+2\+\_\+type}}), intent(inout), optional}]{eq\+\_\+2\+\_\+out}{, }\item[{type(\doxymbox{\hyperlink{structx__vars_1_1x__1__type}{x\+\_\+1\+\_\+type}}), intent(inout), optional}]{x\+\_\+1\+\_\+out}{, }\item[{type(\doxymbox{\hyperlink{structx__vars_1_1x__2__type}{x\+\_\+2\+\_\+type}}), intent(inout), optional}]{x\+\_\+2\+\_\+out}{, }\item[{type(\doxymbox{\hyperlink{structeq__vars_1_1eq__1__type}{eq\+\_\+1\+\_\+type}}), intent(in), optional}]{eq\+\_\+1}{, }\item[{character(len=\texorpdfstring{$\ast$}{*}), intent(in), optional}]{grid\+\_\+name}{}\end{DoxyParamCaption})}



Interpolate variables resulting from HELENA equilibria to another grid (angularly). 

The input and output grid to be provided depend on the quantities to be interpolated:\+
\begin{DoxyItemize}
\item equilibrium variables:\+ flux variables (no need to convert) and derived quantities (need equilibrium grid)
\item metric variables:\+ jac\+\_\+\+FD (need equilibrium grid)
\item vectorial perturbation variables:\+ U\+\_\+i, DU\+\_\+i (need perturbation grid)
\item tensorial perturbation variables:\+ PV\+\_\+i, KV\+\_\+i (need perturbation grid)
\end{DoxyItemize}

Also, a message can be printed if a grid name is passed.

\begin{DoxyNote}{Note}

\begin{DoxyEnumerate}
\item The metric coefficients are interpolated and then compensated for the straight-\/field-\/line coordinates as in \DoxyCite{weyens3d}{number}{1} .
\item By default the interpolated quantities overwrite the original ones, but alternative output variables can be provided.
\item as the equilibrium and perturbation grid are not generally identical, this routine has to be called separately for the variables tabulated in either grid.
\end{DoxyEnumerate}
\end{DoxyNote}
\begin{DoxyReturn}{Returns}
ierr 
\end{DoxyReturn}

\begin{DoxyParams}[1]{Parameters}
\doxymbox{\texttt{in}}  & {\em grid\+\_\+in} & input grid \\
\hline
\doxymbox{\texttt{in}}  & {\em grid\+\_\+out} & output grid \\
\hline
\doxymbox{\texttt{in,out}}  & {\em eq\+\_\+2} & general metric equilibrium variables \\
\hline
\doxymbox{\texttt{in,out}}  & {\em x\+\_\+1} & general vectorial perturbation variables \\
\hline
\doxymbox{\texttt{in,out}}  & {\em x\+\_\+2} & general tensorial perturbation variables \\
\hline
\doxymbox{\texttt{in,out}}  & {\em eq\+\_\+2\+\_\+out} & field-\/aligned metric equilibrium variables \\
\hline
\doxymbox{\texttt{in,out}}  & {\em x\+\_\+1\+\_\+out} & field-\/aligned vectorial perturbation variables \\
\hline
\doxymbox{\texttt{in,out}}  & {\em x\+\_\+2\+\_\+out} & field-\/aligned tensorial perturbation variables \\
\hline
\doxymbox{\texttt{in}}  & {\em eq\+\_\+1} & general flux equilibrium variables for metric interpolation \\
\hline
\doxymbox{\texttt{in}}  & {\em grid\+\_\+name} & name of grid to which to adapt quantities \\
\hline
\end{DoxyParams}


Definition at line \doxymbox{\hyperlink{HELENA__ops_8f90_source_l00548}{548}} of file \doxymbox{\hyperlink{HELENA__ops_8f90_source}{HELENA\+\_\+ops.\+f90}}.

Here is the call graph for this function:\+\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{namespacehelena__ops_a11defc7f58c96da44f6ac492cb8e4a31_cgraph}
\end{center}
\end{figure}
Here is the caller graph for this function:\+\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{namespacehelena__ops_a11defc7f58c96da44f6ac492cb8e4a31_icgraph}
\end{center}
\end{figure}
\Hypertarget{namespacehelena__ops_ad227f370bcd063642a98b57e7a4a5abc}\index{helena\_ops@{helena\_ops}!read\_hel@{read\_hel}}
\index{read\_hel@{read\_hel}!helena\_ops@{helena\_ops}}
\doxysubsubsection{\texorpdfstring{read\_hel()}{read\_hel()}}
{\footnotesize\ttfamily \label{namespacehelena__ops_ad227f370bcd063642a98b57e7a4a5abc} 
integer function, public helena\+\_\+ops::\+read\+\_\+hel (\begin{DoxyParamCaption}\item[{integer, intent(inout)}]{n\+\_\+r\+\_\+in}{, }\item[{logical, intent(inout)}]{use\+\_\+pol\+\_\+flux\+\_\+h}{}\end{DoxyParamCaption})}



Reads the HELENA equilibrium data. 

Adapted from HELENA routine {\ttfamily IODSK}.

The variales in the HELENA mapping file are globalized in two ways:\+
\begin{DoxyItemize}
\item X and Y are normalized w.\+r.\+t. vacuum geometric axis {\ttfamily R\+\_\+vac} and toroidal field at the geometric axis {\ttfamily B\+\_\+vac}.
\item {\ttfamily  R\+[m]\+ = R\+\_\+vac\+[m]\+ (1 + eps X\+[]\+) },
\item {\ttfamily  Z\+[m]\+ = R\+\_\+vac\+[m]\+ eps Y\+[]\+ }.
\end{DoxyItemize}

The covariant toroidal field {\ttfamily F\+\_\+H}, {\ttfamily pres\+\_\+H} and poloidal flux are normalized w.\+r.\+t magnetic axis {\ttfamily R\+\_\+m} and total toroidal field at magnetic axis {\ttfamily B\+\_\+m:\+} 
\begin{DoxyItemize}
\item {\ttfamily  RBphi\+[Tm]\+ = F\+\_\+H\+[]\+ R\+\_\+m\+[m]\+ B\+\_\+m\+[T]\+ },
\item {\ttfamily  pres\+[N/\+m\texorpdfstring{$^\wedge$}{\string^}2]\+ = pres\+\_\+H\+[]\+ (B\+\_\+m\+[T]\+)\texorpdfstring{$^\wedge$}{\string^}2/\+mu\+\_\+0\+[N/\+\+A\texorpdfstring{$^\wedge$}{\string^}2]\+ },
\item {\ttfamily  flux\+\_\+p\+[Tm\texorpdfstring{$^\wedge$}{\string^}2]\+ = 2pi (s\+[]\+)\texorpdfstring{$^\wedge$}{\string^}2 cpsurf\+[]\+ B\+\_\+m\+[T]\+ (R\+\_\+m\+[m]\+)\texorpdfstring{$^\wedge$}{\string^}2 }.
\end{DoxyItemize}

The first normalization type is the HELENA normalization, whereas the second is the MISHKA normalization.

Everything is translated to MISHKA normalization to make comparison with MISHKA simple. This is done using the factors:\+
\begin{DoxyItemize}
\item {\ttfamily  radius\+[]\+ = a\+[m]\+ /\+ R\+\_\+m\+[m]\+ },
\item {\ttfamily  eps\+[]\+ = a\+[m]\+ /\+ R\+\_\+vac\+[m]\+ }, so that the expressions become:\+
\item {\ttfamily  R\+[m]\+ = radius\+[]\+ (1/\+eps\+[]\+ + X\+[]\+) R\+\_\+m\+[m]\+},
\item {\ttfamily  Z\+[m]\+ = radius\+[]\+ Y\+[]\+ R\+\_\+m\+[m]\+},
\item {\ttfamily  RBphi\+[Tm]\+ = F\+\_\+H\+[]\+ B\+\_\+m\+[T]\+ R\+\_\+m\+[m]\+},
\item {\ttfamily  pres\+[N/\+m\texorpdfstring{$^\wedge$}{\string^}2]\+ = pres\+\_\+H\+[]\+ B\+\_\+m\+[T]\+\texorpdfstring{$^\wedge$}{\string^}2 mu\+\_\+0\+[N/\+\+A\texorpdfstring{$^\wedge$}{\string^}2]\+\texorpdfstring{$^\wedge$}{\string^}-\/1},
\item {\ttfamily  flux\+\_\+p\+[Tm\texorpdfstring{$^\wedge$}{\string^}2]\+ = 2pi (s\+[]\+)\texorpdfstring{$^\wedge$}{\string^}2 cpsurf\+[]\+ B\+\_\+m\+[T]\+ R\+\_\+m\+[T]\+\texorpdfstring{$^\wedge$}{\string^}2}.
\end{DoxyItemize}

Finally, in HELENA, the total current {\ttfamily I}, the poloidal beta and the density at the geometric axis can be prescribed through:\+
\begin{DoxyItemize}
\item {\ttfamily  XIAB = mu\+\_\+0 I /\+ (a\+\_\+vac B\+\_\+vac) },
\item {\ttfamily  BETAP = 8 pi S \texorpdfstring{$<$}{<}p\texorpdfstring{$>$}{>} /\+ (I\texorpdfstring{$^\wedge$}{\string^}2 mu\+\_\+0) },
\item {\ttfamily  ZN },
\end{DoxyItemize}

where {\ttfamily  a\+\_\+vac = eps R\+\_\+vac } and {\ttfamily B\+\_\+vac} are vacuum quantities, {\ttfamily S} is the 2-\/D cross-\/sectional area and \texorpdfstring{$<$}{<}p\texorpdfstring{$>$}{>} is the 2-\/D averaged pressure.

\begin{DoxyNote}{Note}
To translate this to the MISHKA normalization factors as
\begin{DoxyItemize}
\item {\ttfamily  R\+\_\+m = (eps/\+radius) R\+\_\+vac },
\item {\ttfamily  B\+\_\+m = B\+\_\+vac /\+ B0 },
\end{DoxyItemize}

where
\begin{DoxyItemize}
\item {\ttfamily radius} is in the mapping file (12), as well as in the HELENA output (20).
\item {\ttfamily eps} is in the mapping file (12), as well as in the HELENA input (10) and output (20).
\item {\ttfamily B0} is in the mapping file (12), as well as in the HELENA output (20). 
\end{DoxyItemize}

Furthermore, the density on axis can be specified as {\ttfamily ZN0} from HELENA input (10). ~\newline
 The other variables should probably not be touched for consistency. 

Finally, the variables IAS and B0 are in the mapping file (12) only in patched versions. See \doxysectlink{page_tutorial_tutorial_eq}{Getting the Equilibrium}{1}.
\end{DoxyNote}
\begin{DoxyReturn}{Returns}
ierr 
\end{DoxyReturn}

\begin{DoxyParams}[1]{Parameters}
\doxymbox{\texttt{in,out}}  & {\em n\+\_\+r\+\_\+in} & nr. of normal points in input grid \\
\hline
\doxymbox{\texttt{in,out}}  & {\em use\+\_\+pol\+\_\+flux\+\_\+h} & .true. if HELENA equilibrium is based on pol. flux \\
\hline
\end{DoxyParams}


Definition at line \doxymbox{\hyperlink{HELENA__ops_8f90_source_l00083}{83}} of file \doxymbox{\hyperlink{HELENA__ops_8f90_source}{HELENA\+\_\+ops.\+f90}}.

Here is the call graph for this function:\+\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{namespacehelena__ops_ad227f370bcd063642a98b57e7a4a5abc_cgraph}
\end{center}
\end{figure}
Here is the caller graph for this function:\+\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{namespacehelena__ops_ad227f370bcd063642a98b57e7a4a5abc_icgraph}
\end{center}
\end{figure}
\Hypertarget{namespacehelena__ops_a83f2ad5dc967c7bae287b60fddb8eb0a}\index{helena\_ops@{helena\_ops}!test\_harm\_cont\_h@{test\_harm\_cont\_h}}
\index{test\_harm\_cont\_h@{test\_harm\_cont\_h}!helena\_ops@{helena\_ops}}
\doxysubsubsection{\texorpdfstring{test\_harm\_cont\_h()}{test\_harm\_cont\_h()}}
{\footnotesize\ttfamily \label{namespacehelena__ops_a83f2ad5dc967c7bae287b60fddb8eb0a} 
integer function, public helena\+\_\+ops::\+test\+\_\+harm\+\_\+cont\+\_\+h}



Investaige harmonic content of the HELENA variables. 

\begin{DoxyNote}{Note}
Run with one process. 
\end{DoxyNote}


Definition at line \doxymbox{\hyperlink{HELENA__ops_8f90_source_l01484}{1484}} of file \doxymbox{\hyperlink{HELENA__ops_8f90_source}{HELENA\+\_\+ops.\+f90}}.

Here is the call graph for this function:\+\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{namespacehelena__ops_a83f2ad5dc967c7bae287b60fddb8eb0a_cgraph}
\end{center}
\end{figure}
Here is the caller graph for this function:\+\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{namespacehelena__ops_a83f2ad5dc967c7bae287b60fddb8eb0a_icgraph}
\end{center}
\end{figure}
\Hypertarget{namespacehelena__ops_a0f156b3653264fb016d6d311eb59114c}\index{helena\_ops@{helena\_ops}!test\_metrics\_h@{test\_metrics\_h}}
\index{test\_metrics\_h@{test\_metrics\_h}!helena\_ops@{helena\_ops}}
\doxysubsubsection{\texorpdfstring{test\_metrics\_h()}{test\_metrics\_h()}}
{\footnotesize\ttfamily \label{namespacehelena__ops_a0f156b3653264fb016d6d311eb59114c} 
integer function, public helena\+\_\+ops::\+test\+\_\+metrics\+\_\+h}



Checks whether the metric elements provided by HELENA are consistent with a direct calculation using the coordinate transformations \DoxyCite{weyens3d}{number}{1}. 

Direct calculations used:\+              \[\begin{aligned}
          \left|\nabla \psi\right|^2             &= \frac{1}{\mathcal{J}^2}
             \left(\left(\frac{\partial Z}{\partial \chi}\right)^2 +
             \left(\frac{\partial R}{\partial \chi}\right)^2\right) \\
          \left|\nabla \psi \cdot \nabla \chi\right|   &= \frac{1}{\mathcal{J}^2}
             \left(
             \frac{\partial Z}{\partial \chi} \frac{\partial Z}{\partial \psi} - 
             \frac{\partial R}{\partial \chi} \frac{\partial R}{\partial \psi}
             \right) \\
          \left|\nabla \chi\right|^2             &= \frac{1}{\mathcal{J}^2}
             \left(\left(\frac{\partial Z}{\partial \psi}\right)^2 +
             \left(\frac{\partial R}{\partial \psi}\right)^2\right) \\
          \left|\nabla \phi\right|^2             &= \frac{1}{R^2}
        \end{aligned}\] with   \[\mathcal{J} = 
             \frac{\partial Z}{\partial \psi} \frac{\partial R}{\partial \chi} - 
             \frac{\partial R}{\partial \psi} \frac{\partial Z}{\partial \chi}\]

Also, test whether the pressure balance $\nabla p = \vec{J}\times\vec{B} $ is satisfied.

\begin{DoxyNote}{Note}
Debug version only
\end{DoxyNote}
\begin{DoxyReturn}{Returns}
ierr 
\end{DoxyReturn}


Definition at line \doxymbox{\hyperlink{HELENA__ops_8f90_source_l01288}{1288}} of file \doxymbox{\hyperlink{HELENA__ops_8f90_source}{HELENA\+\_\+ops.\+f90}}.

Here is the call graph for this function:\+\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{namespacehelena__ops_a0f156b3653264fb016d6d311eb59114c_cgraph}
\end{center}
\end{figure}
Here is the caller graph for this function:\+\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{namespacehelena__ops_a0f156b3653264fb016d6d311eb59114c_icgraph}
\end{center}
\end{figure}
