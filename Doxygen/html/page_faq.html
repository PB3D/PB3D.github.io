<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.13"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>PB3D: Frequently Asked Questions</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    extensions: ["tex2jax.js", "TeX/AMSmath.js", "TeX/AMSsymbols.js"],
    jax: ["input/TeX","output/HTML-CSS"],
});
</script><script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.2/MathJax.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="customdoxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">PB3D
   &#160;<span id="projectnumber">[2.42]</span>
   </div>
   <div id="projectbrief">Ideal linear high-n MHD stability in 3-D</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">Frequently Asked Questions </div>  </div>
</div><!--header-->
<div class="contents">
<div class="toc"><h3>Table of Contents</h3>
<ul><li class="level1"><a href="#faq_errors">runtime errors</a></li>
<li class="level1"><a href="#faq_problems">common problems</a></li>
</ul>
</div>
<div class="textblock"><h1><a class="anchor" id="faq_errors"></a>
runtime errors</h1>
<a class="anchor" id="faq_errors_tab"></a>
<table class="doxtable">
<caption>Table 1. frequently encountered errors</caption>
<tr>
<th>error </th><th>solution   </th></tr>
<tr>
<td>"need at least N points in grid"  </td><td>grid_utilities.setup_deriv_data() needs a minimum number of points in a grid to setup data with which the derivatives can be calculated later in grid_utilities.apply_disc(). If the grid does not have enough points, and the order of the derivative is too high, the procedure gives this error message. The solution is to either increase the number of points, or to lower the order. It might be that the number of points in the grid is lower than you expect because the grid is divided. In this case, you need more memory (see <code>max_tot_mem</code> in <a class="el" href="page_inputs.html">Input variables</a>).   </td></tr>
<tr>
<td>"Zero pivot in LU factorization"  </td><td>There exist cases in which the eigenvalue solver fails when <code>n_mod_X = 1</code>, for unkown reasons. Increase <code>n_mod_X</code> or play with other parameters, such as the <code>norm_disc_prec_sol</code>.   </td></tr>
<tr>
<td><code>jump_to_sol</code> does not work </td><td>Jumping over the equilibrium and perturbation drivers straight to the solution only works if solution parameters such as the boundary conditions are changed, <em>not</em> if the number of points in the solution, <code>n_r_sol</code>, is changed, as in this case the equilibrium and solution drivers need to be recalculated properly.  </td></tr>
<tr>
<td>The solution suffers from numerical oscillations </td><td>This is a work in progress. Change the limits of the solution grid <code>min_r_sol</code> (and possibly <code>max_r_sol</code>). Better even is to use asymmetric finite differences <code>norm_disc_style_sol = 2</code>  </td></tr>
</table>
<h1><a class="anchor" id="faq_problems"></a>
common problems</h1>
<a class="anchor" id="faq_problems_tab"></a>
<table class="doxtable">
<caption>Table 2. common problems</caption>
<tr>
<th>problem </th><th>solution   </th></tr>
<tr>
<td>code compilation stuck </td><td>Especially on intel systems, it has been found that sometimes the compiler seems to be stuck, especially for <code><a class="el" href="namespaceeq__ops.html" title="Operations on the equilibrium variables. ">eq_ops</a></code>. A solution is to use less optimization for the problematic files through <code>-O2</code>.   </td></tr>
<tr>
<td>unphysical eigenvector </td><td>For coarse equilbrium grids and/or strongly varying safety factors, and when using the fast version (i.e. with <code>n_mod_X</code>), it is possible that the resonating mode number range varies too quickly, leading to inaccurate interpolation of tensorial perturbation quantities in the solution grid. Try using <code>X_grid_style</code> 3, where enrichment of the equilibrium grid is used to set up the perturbation grid. If this does not help, additionally lower <code>max_njq_change</code> from its default value.   </td></tr>
<tr>
<td>low accuracy for energy reconstruction </td><td>Energy reconstruction tries to see whether by calculating the total volume integral of the perturbed potential energy and dividing it by the total volume integral of the kinetic energy of the perturbation, the eigenvalue can be recovered. This gives a lot of insight in the processes that drive the instabilities, by looking at the individual terms of these integrals, and is a good check on the internal consistency of the PB3D code. Note that for axisymmetric equilibria, the volume integral reduces to a surface integral in a poloidal cross-section. It is actually very hard to perform a good energy reconstruction because the techniques used differ from the ones in the PB3D code, where the normal derivatives of the eigenvector are performed using finite differences, while in the energy reconstruction direct volume integrals are used. To get the best possible results, therefore, it is important to achieve full Richardson convergence in the number of parallel points (by increasing <code>max_it_rich</code> and/or <code>min_n_par_X</code>), as well as convergence in the number of secondary mode harmonics (by increasing <code>n_mod_X</code>). Doing this, for axisymmetric cases, the code should retun quite accurate results, from version 2.26 upwards. These can furthermore be improved by choosing a finer post-processing grid (see <code>n_theta_plot</code> and <code>n_zeta_plot</code>). It is, however, possible that a small fraction, possibly of the order of a percent remains in the relative difference. This is probably due to the fact that in PB3D for <code>X_style</code> 2 (fast), the stencil is cut when the normal index falls out of its mode range (see <a class="el" href="namespaceslepc__utilities.html#aa34aa361f0bfff9621ecba179f9ed0c6" title="Insert a block pertaining to 1 normal point into a matrix. ">insert_block_mat()</a>).   </td></tr>
<tr>
<td>Changing input does not work for Richardson extrapolation </td><td>You cannot change the inputs as Richardson extrapolation depends on having these constant (with the exception of the number of poins in the parallel integrals, but this is done internally in PB3D). The important exception to this fact, however, is that you can change some of the solution grid parameters, such as <code>n_r_sol</code> (see <a class="el" href="page_inputs.html">Input variables</a>).   </td></tr>
<tr>
<td>The code has not been tested satisfactorily for decreasing normal coordinate. </td><td>When the normal coordinate is decreasing (but still monotonous), the code should be able to handle this. However, a quick test gave some problems, which have to be debuged. An easy workaround is to just run the equilibrium solver again with inverted fields and currents.   </td></tr>
<tr>
<td>The code has to be adapted for reversed-shear regions still. </td><td>When there are reversed-shear regions, the routines that calculate the resonant flux surfaces, such as <code><a class="el" href="namespacex__ops.html#a1a90026bbbeddc25e82cfdd304df251f" title="Calculates resonating flux surfaces for the perturbation modes. ">calc_res_surf()</a></code> need to be extended. If this is not done, there will be problems, mostly for <code>X_style</code> 2 (fast), and especially for <code>X_grid_style</code> 3 (enriched).   </td></tr>
</table>
</div></div><!-- contents -->
<!-- HTML footer for doxygen 1.8.13-->
<!-- start footer part -->
<address class="footer"><small>
<center>this documentation was created with <a href="http://www.doxygen.org/index.html">Doxygen 1.8.13</a> by <a href="mailto:weyenst@gmail.com">Toon Weyens</a></center>
</small></address>
</body>
</html>
