<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.16.1"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>PB3D: eq_ops Module Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="clipboard.js"></script>
<script type="text/javascript" src="cookie.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  extensions: ["tex2jax.js", "TeX/AMSmath.js", "TeX/AMSsymbols.js"],
  jax: ["input/TeX","output/HTML-CSS"],
});
</script>
<script type="text/javascript" async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.2/MathJax.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="customdoxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">PB3D<span id="projectnumber">&#160;[2.47]</span>
   </div>
   <div id="projectbrief">Ideal linear high-n MHD stability in 3-D</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.16.1 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search/",'.html');
</script>
<script type="text/javascript">
$(function() { codefold.init(); });
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search',false);
  $(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

</div><!-- top -->
<div id="doc-content">
<div class="header">
  <div class="summary">
<a href="#nested-classes">Interfaces and Types</a> &#124;
<a href="#func-members">Functions/Subroutines</a> &#124;
<a href="#var-members">Variables</a>  </div>
  <div class="headertitle"><div class="title">eq_ops Module Reference</div></div>
</div><!--header-->
<div class="contents">

<p>Operations on the equilibrium variables.  
<a href="#details">More...</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 id="header-nested-classes" class="groupheader"><a id="nested-classes" name="nested-classes"></a>
Interfaces and Types</h2></td></tr>
<tr class="memitem:calc_5Feq" id="r_calc_5Feq"><td class="memItemLeft">interface &#160;</td><td class="memItemRight"><a class="el" href="interfaceeq__ops_1_1calc__eq.html">calc_eq</a></td></tr>
<tr class="memdesc:"><td class="mdescLeft">&#160;</td><td class="mdescRight">Calculate the equilibrium quantities on a grid determined by straight field lines.  <a href="interfaceeq__ops_1_1calc__eq.html#details">More...</a><br /></td></tr>
<tr class="memitem:print_5Foutput_5Feq" id="r_print_5Foutput_5Feq"><td class="memItemLeft">interface &#160;</td><td class="memItemRight"><a class="el" href="interfaceeq__ops_1_1print__output__eq.html">print_output_eq</a></td></tr>
<tr class="memdesc:"><td class="mdescLeft">&#160;</td><td class="mdescRight">Print equilibrium quantities to an output file:  <a href="interfaceeq__ops_1_1print__output__eq.html#details">More...</a><br /></td></tr>
<tr class="memitem:redistribute_5Foutput_5Feq" id="r_redistribute_5Foutput_5Feq"><td class="memItemLeft">interface &#160;</td><td class="memItemRight"><a class="el" href="interfaceeq__ops_1_1redistribute__output__eq.html">redistribute_output_eq</a></td></tr>
<tr class="memdesc:"><td class="mdescLeft">&#160;</td><td class="mdescRight">Redistribute the equilibrium variables, but only the Flux variables are saved.  <a href="interfaceeq__ops_1_1redistribute__output__eq.html#details">More...</a><br /></td></tr>
<tr class="memitem:calc_5Frzl" id="r_calc_5Frzl"><td class="memItemLeft">interface &#160;</td><td class="memItemRight"><a class="el" href="interfaceeq__ops_1_1calc__rzl.html">calc_rzl</a></td></tr>
<tr class="memdesc:"><td class="mdescLeft">&#160;</td><td class="mdescRight">Calculate \(R\), \(Z\) &amp; \(\lambda\) and derivatives in VMEC coordinates.  <a href="interfaceeq__ops_1_1calc__rzl.html#details">More...</a><br /></td></tr>
<tr class="memitem:calc_5Fg_5Fc" id="r_calc_5Fg_5Fc"><td class="memItemLeft">interface &#160;</td><td class="memItemRight"><a class="el" href="interfaceeq__ops_1_1calc__g__c.html">calc_g_c</a></td></tr>
<tr class="memdesc:"><td class="mdescLeft">&#160;</td><td class="mdescRight">Calculate the lower metric elements in the C(ylindrical) coordinate system.  <a href="interfaceeq__ops_1_1calc__g__c.html#details">More...</a><br /></td></tr>
<tr class="memitem:calc_5Fg_5Fv" id="r_calc_5Fg_5Fv"><td class="memItemLeft">interface &#160;</td><td class="memItemRight"><a class="el" href="interfaceeq__ops_1_1calc__g__v.html">calc_g_v</a></td></tr>
<tr class="memdesc:"><td class="mdescLeft">&#160;</td><td class="mdescRight">Calculate the lower metric coefficients in the equilibrium V(MEC) coordinate system.  <a href="interfaceeq__ops_1_1calc__g__v.html#details">More...</a><br /></td></tr>
<tr class="memitem:calc_5Fg_5Fh" id="r_calc_5Fg_5Fh"><td class="memItemLeft">interface &#160;</td><td class="memItemRight"><a class="el" href="interfaceeq__ops_1_1calc__g__h.html">calc_g_h</a></td></tr>
<tr class="memdesc:"><td class="mdescLeft">&#160;</td><td class="mdescRight">Calculate the lower metric coefficients in the equilibrium H(ELENA) coordinate system.  <a href="interfaceeq__ops_1_1calc__g__h.html#details">More...</a><br /></td></tr>
<tr class="memitem:calc_5Fg_5Ff" id="r_calc_5Fg_5Ff"><td class="memItemLeft">interface &#160;</td><td class="memItemRight"><a class="el" href="interfaceeq__ops_1_1calc__g__f.html">calc_g_f</a></td></tr>
<tr class="memdesc:"><td class="mdescLeft">&#160;</td><td class="mdescRight">Calculate the metric coefficients in the F(lux) coordinate system.  <a href="interfaceeq__ops_1_1calc__g__f.html#details">More...</a><br /></td></tr>
<tr class="memitem:calc_5Fjac_5Fv" id="r_calc_5Fjac_5Fv"><td class="memItemLeft">interface &#160;</td><td class="memItemRight"><a class="el" href="interfaceeq__ops_1_1calc__jac__v.html">calc_jac_v</a></td></tr>
<tr class="memdesc:"><td class="mdescLeft">&#160;</td><td class="mdescRight">Calculate \(\mathcal{J}_\text{V}\), the jacobian in V(MEC) coordinates.  <a href="interfaceeq__ops_1_1calc__jac__v.html#details">More...</a><br /></td></tr>
<tr class="memitem:calc_5Fjac_5Fh" id="r_calc_5Fjac_5Fh"><td class="memItemLeft">interface &#160;</td><td class="memItemRight"><a class="el" href="interfaceeq__ops_1_1calc__jac__h.html">calc_jac_h</a></td></tr>
<tr class="memdesc:"><td class="mdescLeft">&#160;</td><td class="mdescRight">Calculate \(\mathcal{J}_\text{H}\), the jacobian in HELENA coordinates.  <a href="interfaceeq__ops_1_1calc__jac__h.html#details">More...</a><br /></td></tr>
<tr class="memitem:calc_5Fjac_5Ff" id="r_calc_5Fjac_5Ff"><td class="memItemLeft">interface &#160;</td><td class="memItemRight"><a class="el" href="interfaceeq__ops_1_1calc__jac__f.html">calc_jac_f</a></td></tr>
<tr class="memdesc:"><td class="mdescLeft">&#160;</td><td class="mdescRight">Calculate \(\mathcal{J}_\text{F}\), the jacobian in Flux coordinates.  <a href="interfaceeq__ops_1_1calc__jac__f.html#details">More...</a><br /></td></tr>
<tr class="memitem:calc_5Ft_5Fvc" id="r_calc_5Ft_5Fvc"><td class="memItemLeft">interface &#160;</td><td class="memItemRight"><a class="el" href="interfaceeq__ops_1_1calc__t__vc.html">calc_t_vc</a></td></tr>
<tr class="memdesc:"><td class="mdescLeft">&#160;</td><td class="mdescRight">Calculate \(\overline{\text{T}}_\text{C}^\text{V}\), the transformation matrix between C(ylindrical) and V(mec) coordinate system.  <a href="interfaceeq__ops_1_1calc__t__vc.html#details">More...</a><br /></td></tr>
<tr class="memitem:calc_5Ft_5Fvf" id="r_calc_5Ft_5Fvf"><td class="memItemLeft">interface &#160;</td><td class="memItemRight"><a class="el" href="interfaceeq__ops_1_1calc__t__vf.html">calc_t_vf</a></td></tr>
<tr class="memdesc:"><td class="mdescLeft">&#160;</td><td class="mdescRight">Calculate \(\overline{\text{T}}_\text{V}^\text{F}\), the transformation matrix between V(MEC) and F(lux) coordinate systems.  <a href="interfaceeq__ops_1_1calc__t__vf.html#details">More...</a><br /></td></tr>
<tr class="memitem:calc_5Ft_5Fhf" id="r_calc_5Ft_5Fhf"><td class="memItemLeft">interface &#160;</td><td class="memItemRight"><a class="el" href="interfaceeq__ops_1_1calc__t__hf.html">calc_t_hf</a></td></tr>
<tr class="memdesc:"><td class="mdescLeft">&#160;</td><td class="mdescRight">Calculate \(\overline{\text{T}}_\text{H}^\text{F}\), the transformation matrix between H(ELENA) and F(lux) coordinate systems.  <a href="interfaceeq__ops_1_1calc__t__hf.html#details">More...</a><br /></td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 id="header-func-members" class="groupheader"><a id="func-members" name="func-members"></a>
Functions/Subroutines</h2></td></tr>
<tr class="memitem:af0effe20188d46a44680c2648e4572e9" id="r_af0effe20188d46a44680c2648e4572e9"><td class="memItemLeft">integer function, public&#160;</td><td class="memItemRight"><a class="el" href="#af0effe20188d46a44680c2648e4572e9">flux_q_plot</a> (grid_eq, eq)</td></tr>
<tr class="memdesc:af0effe20188d46a44680c2648e4572e9"><td class="mdescLeft">&#160;</td><td class="mdescRight">Plots the flux quantities in the solution grid.  <br /></td></tr>
<tr class="memitem:a087e08ce6d8ad381b5bac8fc51148d50" id="r_a087e08ce6d8ad381b5bac8fc51148d50"><td class="memItemLeft">integer function, public&#160;</td><td class="memItemRight"><a class="el" href="#a087e08ce6d8ad381b5bac8fc51148d50">calc_derived_q</a> (grid_eq, eq_1, eq_2)</td></tr>
<tr class="memdesc:a087e08ce6d8ad381b5bac8fc51148d50"><td class="mdescLeft">&#160;</td><td class="mdescRight">Calculates derived equilibrium quantities system.  <br /></td></tr>
<tr class="memitem:a7cd38586e386e1bc684a327ebcc4c1de" id="r_a7cd38586e386e1bc684a327ebcc4c1de"><td class="memItemLeft">integer function, public&#160;</td><td class="memItemRight"><a class="el" href="#a7cd38586e386e1bc684a327ebcc4c1de">calc_normalization_const</a> ()</td></tr>
<tr class="memdesc:a7cd38586e386e1bc684a327ebcc4c1de"><td class="mdescLeft">&#160;</td><td class="mdescRight">Sets up normalization constants.  <br /></td></tr>
<tr class="memitem:a1b4c764da73624722d7e76498a2b80a9" id="r_a1b4c764da73624722d7e76498a2b80a9"><td class="memItemLeft">subroutine, public&#160;</td><td class="memItemRight"><a class="el" href="#a1b4c764da73624722d7e76498a2b80a9">normalize_input</a> ()</td></tr>
<tr class="memdesc:a1b4c764da73624722d7e76498a2b80a9"><td class="mdescLeft">&#160;</td><td class="mdescRight">Normalize input quantities.  <br /></td></tr>
<tr class="memitem:aaa2bcf52f2e9595ec31a996063fff0b0" id="r_aaa2bcf52f2e9595ec31a996063fff0b0"><td class="memItemLeft">integer function, public&#160;</td><td class="memItemRight"><a class="el" href="#aaa2bcf52f2e9595ec31a996063fff0b0">b_plot</a> (grid_eq, eq_1, eq_2, rich_lvl, plot_fluxes, xyz)</td></tr>
<tr class="memdesc:aaa2bcf52f2e9595ec31a996063fff0b0"><td class="mdescLeft">&#160;</td><td class="mdescRight">Plots the magnetic fields.  <br /></td></tr>
<tr class="memitem:aa16cc7b5d17f3e3b65b045f12b40540d" id="r_aa16cc7b5d17f3e3b65b045f12b40540d"><td class="memItemLeft">integer function, public&#160;</td><td class="memItemRight"><a class="el" href="#aa16cc7b5d17f3e3b65b045f12b40540d">j_plot</a> (grid_eq, eq_1, eq_2, rich_lvl, plot_fluxes, xyz)</td></tr>
<tr class="memdesc:aa16cc7b5d17f3e3b65b045f12b40540d"><td class="mdescLeft">&#160;</td><td class="mdescRight">Plots the current.  <br /></td></tr>
<tr class="memitem:a55917387e2d5511f49396a2b7f9f2b5a" id="r_a55917387e2d5511f49396a2b7f9f2b5a"><td class="memItemLeft">integer function, public&#160;</td><td class="memItemRight"><a class="el" href="#a55917387e2d5511f49396a2b7f9f2b5a">kappa_plot</a> (grid_eq, eq_1, eq_2, rich_lvl, xyz)</td></tr>
<tr class="memdesc:a55917387e2d5511f49396a2b7f9f2b5a"><td class="mdescLeft">&#160;</td><td class="mdescRight">Plots the curvature.  <br /></td></tr>
<tr class="memitem:a45303921478f07c074b598f65a26b2ec" id="r_a45303921478f07c074b598f65a26b2ec"><td class="memItemLeft">integer function, public&#160;</td><td class="memItemRight"><a class="el" href="#a45303921478f07c074b598f65a26b2ec">delta_r_plot</a> (grid_eq, eq_1, eq_2, xyz, rich_lvl)</td></tr>
<tr class="memdesc:a45303921478f07c074b598f65a26b2ec"><td class="mdescLeft">&#160;</td><td class="mdescRight">Plots <b>HALF</b> of the change in the position vectors for 2 different toroidal positions, which can correspond to a ripple.  <br /></td></tr>
<tr class="memitem:a6811942aeb421cf1495a65e639199975" id="r_a6811942aeb421cf1495a65e639199975"><td class="memItemLeft">integer function, public&#160;</td><td class="memItemRight"><a class="el" href="#a6811942aeb421cf1495a65e639199975">divide_eq_jobs</a> (n_par_x, arr_size, n_div, n_div_max, n_par_x_base, range_name)</td></tr>
<tr class="memdesc:a6811942aeb421cf1495a65e639199975"><td class="mdescLeft">&#160;</td><td class="mdescRight">Divides the equilibrium jobs.  <br /></td></tr>
<tr class="memitem:a6f509d7becf29b4f201a871bf4441d49" id="r_a6f509d7becf29b4f201a871bf4441d49"><td class="memItemLeft">integer function, public&#160;</td><td class="memItemRight"><a class="el" href="#a6f509d7becf29b4f201a871bf4441d49">calc_eq_jobs_lims</a> (n_par_x, n_div)</td></tr>
<tr class="memdesc:a6f509d7becf29b4f201a871bf4441d49"><td class="mdescLeft">&#160;</td><td class="mdescRight">Calculate <code>eq_jobs_lims</code>.  <br /></td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 id="header-var-members" class="groupheader"><a id="var-members" name="var-members"></a>
Variables</h2></td></tr>
<tr class="memitem:a1b6609a8d8b427d9133bf323e732f209" id="r_a1b6609a8d8b427d9133bf323e732f209"><td class="memItemLeft">logical, public&#160;</td><td class="memItemRight"><a class="el" href="#a1b6609a8d8b427d9133bf323e732f209">debug_calc_derived_q</a> = .false.</td></tr>
<tr class="memdesc:a1b6609a8d8b427d9133bf323e732f209"><td class="mdescLeft">&#160;</td><td class="mdescRight">plot debug information for <a class="el" href="#a087e08ce6d8ad381b5bac8fc51148d50" title="Calculates derived equilibrium quantities system.">calc_derived_q()</a>  <br /></td></tr>
<tr class="memitem:a45ba7f46fd439bbd73edfd1fd548b58e" id="r_a45ba7f46fd439bbd73edfd1fd548b58e"><td class="memItemLeft">logical, public&#160;</td><td class="memItemRight"><a class="el" href="#a45ba7f46fd439bbd73edfd1fd548b58e">debug_j_plot</a> = .false.</td></tr>
<tr class="memdesc:a45ba7f46fd439bbd73edfd1fd548b58e"><td class="mdescLeft">&#160;</td><td class="mdescRight">plot debug information for <a class="el" href="#aa16cc7b5d17f3e3b65b045f12b40540d" title="Plots the current.">j_plot()</a>  <br /></td></tr>
<tr class="memitem:a07ca60790a262e20bc8632be1530970a" id="r_a07ca60790a262e20bc8632be1530970a"><td class="memItemLeft">logical, public&#160;</td><td class="memItemRight"><a class="el" href="#a07ca60790a262e20bc8632be1530970a">debug_create_vmec_input</a> = .false.</td></tr>
<tr class="memdesc:a07ca60790a262e20bc8632be1530970a"><td class="mdescLeft">&#160;</td><td class="mdescRight">plot debug information for create_vmec_input()  <br /></td></tr>
</table>
<a name="details" id="details"></a><h2 id="header-details" class="groupheader">Detailed Description</h2>
<div class="textblock"><p>Operations on the equilibrium variables. </p>
</div><a name="doc-func-members" id="doc-func-members"></a><h2 id="header-doc-func-members" class="groupheader">Function/Subroutine Documentation</h2>
<a id="aaa2bcf52f2e9595ec31a996063fff0b0" name="aaa2bcf52f2e9595ec31a996063fff0b0"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aaa2bcf52f2e9595ec31a996063fff0b0">&#9670;&#160;</a></span>b_plot()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">integer function, public eq_ops::b_plot </td>
          <td>(</td>
          <td class="paramtype">type(<a class="el" href="structgrid__vars_1_1grid__type.html">grid_type</a>), intent(inout)</td>          <td class="paramname"><span class="paramname"><em>grid_eq</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">type(<a class="el" href="structeq__vars_1_1eq__1__type.html">eq_1_type</a>), intent(in)</td>          <td class="paramname"><span class="paramname"><em>eq_1</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">type(<a class="el" href="structeq__vars_1_1eq__2__type.html">eq_2_type</a>), intent(in)</td>          <td class="paramname"><span class="paramname"><em>eq_2</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">integer, intent(in), optional</td>          <td class="paramname"><span class="paramname"><em>rich_lvl</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">logical, intent(in), optional</td>          <td class="paramname"><span class="paramname"><em>plot_fluxes</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real(dp), dimension(:,:,:,:), intent(in), optional</td>          <td class="paramname"><span class="paramname"><em>xyz</em></span>&#160;)</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Plots the magnetic fields. </p>
<p>If multiple equilibrium parallel jobs, every job does its piece, and the results are joined automatically by plot_HDF5.</p>
<p>The outputs are given in contra- and covariant components and magnitude in multiple coordinate systems, as indicated in calc_vec_comp().</p>
<p>The starting point is the fact that the magnetic field is given by </p><p class="formulaDsp">
\[\vec{B} = \frac{\vec{e}_{\theta}}{\mathcal{J}}, \]
</p>
<p> in F coordinates. The F covariant components are therefore given by  </p><p class="formulaDsp">
\[B_i = \frac{g_{i3}}{\mathcal{J}} =
             \frac{\vec{e}_i \cdot \vec{e}_3}{\mathcal{J}}, \]
</p>
<p> and the only non-vanishing contravariant component is </p><p class="formulaDsp">
\[B^3 = \frac{1}{\mathcal{J}}. \]
</p>
<p>These are then all be transformed to the other coordinate systems.</p>
<dl class="section note"><dt>Note</dt><dd><ol type="1">
<li>Vector plots for different Richardson levels can be combined to show the total grid by just plotting them all individually.</li>
<li>The metric factors and transformation matrices have to be allocated.</li>
</ol>
</dd></dl>
<dl class="section return"><dt>Returns</dt><dd>ierr </dd></dl>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in,out]</td><td class="paramname">grid_eq</td><td>equilibrium grid </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">eq_1</td><td>flux equilibrium variables </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">eq_2</td><td>metric equilibrium variables </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">rich_lvl</td><td>Richardson level </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">plot_fluxes</td><td>plot the fluxes </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">xyz</td><td>X, Y and Z of grid </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="eq__ops_8f90_source.html#l05698">5698</a> of file <a class="el" href="eq__ops_8f90_source.html">eq_ops.f90</a>.</p>
<div id="dynsection-0" onclick="return dynsection.toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;"><span class="dynarrow"><span class="arrowhead closed"></span></span>Here is the call graph for this function:</div>
<div id="dynsection-0-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-0-content" class="dyncontent" style="display:none;">
<div class="center"><iframe scrolling="no" loading="lazy" frameborder="0" src="namespaceeq__ops_aaa2bcf52f2e9595ec31a996063fff0b0_cgraph.svg" width="1355" height="567"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
<div id="dynsection-1" onclick="return dynsection.toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;"><span class="dynarrow"><span class="arrowhead closed"></span></span>Here is the caller graph for this function:</div>
<div id="dynsection-1-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-1-content" class="dyncontent" style="display:none;">
<div class="center"><iframe scrolling="no" loading="lazy" frameborder="0" src="namespaceeq__ops_aaa2bcf52f2e9595ec31a996063fff0b0_icgraph.svg" width="603" height="91"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>

</div>
</div>
<a id="a087e08ce6d8ad381b5bac8fc51148d50" name="a087e08ce6d8ad381b5bac8fc51148d50"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a087e08ce6d8ad381b5bac8fc51148d50">&#9670;&#160;</a></span>calc_derived_q()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">integer function, public eq_ops::calc_derived_q </td>
          <td>(</td>
          <td class="paramtype">type(<a class="el" href="structgrid__vars_1_1grid__type.html">grid_type</a>), intent(in)</td>          <td class="paramname"><span class="paramname"><em>grid_eq</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">type(<a class="el" href="structeq__vars_1_1eq__1__type.html">eq_1_type</a>), intent(in)</td>          <td class="paramname"><span class="paramname"><em>eq_1</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">type(<a class="el" href="structeq__vars_1_1eq__2__type.html">eq_2_type</a>), intent(inout), target</td>          <td class="paramname"><span class="paramname"><em>eq_2</em></span>&#160;)</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Calculates derived equilibrium quantities system. </p>
<ul>
<li>magnetic shear <code>S</code> </li>
<li>normal curvature <code>kappa_n</code> </li>
<li>geodesic curvature <code>kappa_g</code> </li>
<li>parallel current <code>sigma</code> </li>
</ul>
<p>Naive implementations of these quantities, with the exception of <code>S</code>, give numerically very unfavorable results, so special care must be taken in this procedure.</p>
<p>This is an important issue as these derived equilbrium quantities are important building blocks of the perturbed potential energy, including the drivers of instabilities.</p>
<p>The general formulas are derived under the first section, VMEC. For axisymmetric HELENA, however, simplified equations are possible and these are presented afterwards.</p>
<h1 class="doxsection"><a class="anchor" id="autotoc_md0"></a>
VMEC</h1>
<h2 class="doxsection"><a class="anchor" id="autotoc_md1"></a>
The shear</h2>
<p>The local shear \(S\) is calculated using equation 3.22 from <a class="el" href="citelist.html#CITEREF_weyens3d">[17]</a> :</p>
<p>\(S = - \frac{1}{\mathcal{J}} \frac{\partial}{\partial \theta}
         \left(\frac{ h^{\psi\alpha}}{ h^{\psi \psi}}\right)\)</p>
<p>which doesn't pose any particular problems as there are only angular derivatives.</p>
<h2 class="doxsection"><a class="anchor" id="autotoc_md2"></a>
The curvature</h2>
<p>This is calculated using the parallel derivative of the parallel unit vector (i.e. theta if using poloidal flux and zeta if using toroidal flux).</p>
<p>By taking instead the derivative of the covariant basis vector and realizing that the difference with the real curvature lies solely in a component along the parallel direction, which cancels out when taking the normal or geodesic components, the situation becomes easier.</p>
<p>Asuming the poloidal flux is used as normal coordinate, the taks is therefore how to calculate \(\frac{1}{\left|\vec{e}_\theta\right|^2} \frac{\partial}{\partial \theta} \vec{e}_\theta\).</p>
<p>By transforming both the derivative as well as the basis vector to Equilibrium coordinates, this can be written as</p>
<p>\(\sum_{i=2,3} \sum_{j=2,3} \mathcal{T}_\text{F}^\text{E} \left(3,i\right))
             \frac{\partial}{\partial u^i_\text{E}} \left(
             \mathcal{T}_\text{F}^\text{E} \left(3,j\right) \vec{e}_{j,\text{E}}\right)\)</p>
<p>where the summations only run over the angular coordinates because \(\vec{e}_\theta\) never has any component along \(\vec{e}_{\psi,\text{E}}\).</p>
<p>This double summation formula can then be written as a matrix equation</p>
<p>\(\begin{pmatrix}\mathcal{T}_\text{F}^\text{E}\left(3,2\right) &amp;
             \mathcal{T}_\text{F}^\text{E}\left(3,3\right)\end{pmatrix}
             \left[
             \begin{pmatrix} \frac{\partial}{\partial u^2} \vec{e}_{2} &amp;
                 \frac{\partial}{\partial u^2} \vec{e}_{3} \\
                 \frac{\partial}{\partial u^3} \vec{e}_{2} &amp;
                 \frac{\partial}{\partial u^3} \vec{e}_{3}\end{pmatrix}_\text{E}
             \begin{pmatrix}\mathcal{T}_\text{F}^\text{E}\left(3,2\right) \\
             \mathcal{T}_\text{F}^\text{E}\left(3,3\right)\end{pmatrix}
             +
             \begin{pmatrix}
                 \frac{\partial}{\partial u^2} \mathcal{T}_\text{F}^\text{E}\left(3,2\right) &amp;
                 \frac{\partial}{\partial u^2} \mathcal{T}_\text{F}^\text{E}\left(3,3\right) \\
                 \frac{\partial}{\partial u^3} \mathcal{T}_\text{F}^\text{E}\left(3,2\right) &amp;
                 \frac{\partial}{\partial u^3} \mathcal{T}_\text{F}^\text{E}\left(3,3\right)
             \end{pmatrix}
             \begin{pmatrix}\vec{e}_2 \\ \vec{e}_3\end{pmatrix}
             \right]\)</p>
<p>which can be represented shorthand as   \(\mathcal{T}_\text{F}^\text{E}\left(3,2:3\right) \left[
             \mathcal{D}\vec{e}_\text{E} \mathcal{T}_\text{F}^\text{E}\left(3,2:3\right)^T
             +\mathcal{D} \mathcal{T} \vec{e}_\text{E}^T \right]\)</p>
<p>It is relatively easy to set up the matrix \(\mathcal{D}\vec{e}_\text{E}\) as a function of covariant basis vectors in the Cylindrical coordinate system. The derivatives of the transformation matrix itself can likewise be found.</p>
<p>The steps used in this routine are therefore</p><ol type="1">
<li>Set up \(\mathcal{D}\vec{e}_\text{E}\), i.e. as a function of the three cylindrical covariant basis vectors.</li>
<li>Set up correctcion by the derivatives of the transformation matrix, with a single summation.</li>
<li>Decompose the normal \(\frac{\nabla \psi}{\left|\nabla\psi\right|^2}\) and geodesic vectors \(\frac{\nabla \psi \times  \vec{B}}{B^2}\) as a function of the cylindrical contravariant basis vectors.</li>
<li>Double summation to reduce term ~ \(\mathcal{D}\vec{e}_\text{E}\) and correction by single summation to reduce term ~ \(\mathcal{D}\mathcal{T}\).</li>
<li>Dot these for each of the four (actually three because of symmetry) elements of \(\mathcal{D}\vec{e}_\text{E}\).</li>
<li>Divide by \(\left|\vec{e}_\theta\right|^2\).</li>
<li>Possibly correct for toroidal flux.</li>
</ol>
<p>An advantage of using this formulation is that no normal derivatives are needed, so that nothing has to implicitely cancel out.</p>
<h2 class="doxsection"><a class="anchor" id="autotoc_md3"></a>
The parallel current</h2>
<p>The parallel current is calculated from the shear with the help of equation 3.29 of <a class="el" href="citelist.html#CITEREF_weyens3d">[17]</a> :</p>
<p>\(\mu_0 \sigma = -\frac{1}{B_\theta} \left[
         2 \frac{\nabla \psi \times \vec{B}}{\left|\nabla \psi\right|^2} \cdot 
         \frac{\partial \left(\nabla \psi\right)}{\partial \theta} +
         \mathcal{J} \left|\nabla \psi\right|^2 S \right]\) .</p>
<p>where a similar technique can be used as above, for the calculation of the curvature: As</p>
<p>\(\frac{\nabla \psi \times \vec{B}}{\left|\nabla \psi\right|^2}
         = \frac{B_\theta \vec{e}_\alpha - B_\alpha \vec{e}_\theta}
         {\mathcal{J} \left|\nabla\psi\right|^2}\) ,</p>
<p>The parallel derivative of \(\nabla \psi\) can be rewritten in terms of contravariant components of derivatives of covariant basis vectors:</p>
<p>\(\left\{ \begin{aligned}
         \vec{e}_\alpha  \cdot \frac{\partial \left(\nabla \psi\right)}{\partial\theta}
         = - \nabla \psi \cdot \frac{\partial \vec{e}_\theta}{\partial \alpha} \\
         \vec{e}_\theta  \cdot \frac{\partial \left(\nabla \psi\right)}{\partial\theta}
         = - \nabla \psi \cdot \frac{\partial \vec{e}_\theta}{\partial \theta} \\
        \end{aligned}\right. \) ,</p>
<p>so that the result is:</p>
<p>\(\frac{\nabla \psi \times \vec{B}}{\left|\nabla \psi\right|^2} \cdot 
         \frac{\partial \left(\nabla \psi\right)}{\partial \theta}
         = \frac{1}{\mathcal{J}^2} \frac{\nabla \psi}{\left|\nabla\psi\right|^2} \cdot
         \left[ g_{\alpha\theta} \frac{\partial \vec{e}_\theta}{\partial \theta}
             - g_{\theta\theta} \frac{\partial \vec{e}_\theta}{\partial \alpha} \right]
\) ,</p>
<p>which is given by a formula similar to the one used above for the geodesical curvature.</p>
<p>In debug mode, it can be checked whether the current is indeed divergence-free, with the help of equation 3.33 of <a class="el" href="citelist.html#CITEREF_weyens3d">[17]</a>.</p>
<p>\( -2 p&#39; \int_{\theta_0}^\theta \mathcal{J} \kappa_g \text{d}{\theta} = 
             \sigma\left(\theta\right) - \sigma_0\)</p>
<p>and whether a direct, naive implementation of the parallel current from equation 3.26 of <a class="el" href="citelist.html#CITEREF_weyens3d">[17]</a> agrees with the more accurate results used here:</p>
<p>\(\mu_0 \sigma = \frac{\partial B_\psi}{\partial \alpha} - 
             \frac{\partial B_\alpha}{\partial \psi} -
             \mu_0 p&#39; \mathcal{J} \frac{B_\alpha}{B_\theta}\) .</p>
<p>The reason why they are generally different is that this implementation relies on the cancellation of large terms.</p>
<h1 class="doxsection"><a class="anchor" id="autotoc_md4"></a>
HELENA</h1>
<h2 class="doxsection"><a class="anchor" id="autotoc_md5"></a>
The parallel current</h2>
<p>As \(B_\alpha = F\left(\psi\right)\) and \(\vec{e}_{\alpha,\text{F}}  =   \vec{e}_{\phi,\text{H}}\), the naive expression for the shear becomes simply</p>
<p>\(\sigma = -F&#39; - \mu_0 p&#39; \frac{F}{B^2}\) ,</p>
<p>which can be used like that.</p>
<h2 class="doxsection"><a class="anchor" id="autotoc_md6"></a>
The shear</h2>
<p>The calculate the local shear \(S\) is looks like it is best to use equation 3.22 from <a class="el" href="citelist.html#CITEREF_weyens3d">[17]</a> , just as in the VMEC case:</p>
<p>As a test, however, equation 3.29 of <a class="el" href="citelist.html#CITEREF_weyens3d">[17]</a> can be used in stead:</p>
<p>\(\mathcal{J}\left|\nabla \psi\right|^2 S + \mu_0 \mathcal{J}B^2 \sigma
        = - 2 \frac{F}{R} \left( \frac{Z_\theta}{R} +
        \frac{Z_\theta R_{\theta\theta} - R_\theta Z_{\theta\theta}}{R_\theta^2 + Z_\theta^2} \right)\).</p>
<p>from which \(\sigma\) can be obtained.</p>
<h2 class="doxsection"><a class="anchor" id="autotoc_md7"></a>
The curvature</h2>
<p>Also the curvature expressions can be simplified for axisymmetric situations. The result is given by</p>
<p>\(\kappa_n = \frac{q R}{F}
         \frac{Z_\theta \left( R_{\theta\theta} - q^2 R\right) - R_\theta Z_{\theta\theta}}
         {\left(R_\theta^2 + Z_\theta^2 + \left(q R\right)^2\right) \left( R_\theta^2 + Z_\theta^2 \right)} \)</p>
<p>\(\kappa_g = q R
         \frac{R_\theta \left( 2 \left(R_\theta^2 + Z_\theta^2\right) + \left(qR\right)^2 \right)
         - R \left(R_\theta R_{\theta\theta} + Z_\theta Z_{\theta\theta}\right)}
         {\left(R_\theta^2 + Z_\theta^2 + \left(q R\right)^2\right)^2} \)</p>
<dl class="section note"><dt>Note</dt><dd><ol type="1">
<li>If the toroidal flux is used instead, the actual curvature obviously is unchanged, which implies that the normal component has to be multiplied by the safety factor and the geodesic component has to be divided by it.</li>
<li>The formulas for the normal and geodesic basis vectors for VMEC are<ul>
<li>\(\frac{\nabla \psi}{\left|\nabla\psi\right|^2} = 
                 -\frac{\mathcal{J} \left(1 + \lambda_\theta\right)}
                 {Z_\theta^2 + R_\theta^2 + \left(R_\zeta Z_\theta - R_\theta Z_\zeta \right)/R^2} \frac{1}{R}
                 \left( -Z_\theta , R_\zeta Z_\theta - R_\theta Z_\zeta, R_\theta\right)_\text{C}\)</li>
<li>\(\frac{\nabla \psi \times  \vec{B}}{B^2} = 
                 \frac{1}{g_{\theta\theta}}
                 \left(P R_\theta - Q R_\zeta, -Q R^2, P Z_\theta - Q Z_\zeta\right)_\text{C}\)</li>
<li>\(Q = g_{\theta\theta} - q g_{\theta\alpha}\) (using right-handed flux \(q_\text{F}\), which is the inverse of the left-handed VMEC \(q_\text{V}\))</li>
<li>\(P = \frac{Q \lambda_\zeta - g_{\alpha\theta}}{1+\lambda_\theta}\) (where the derivatives of \(R\), \(Z\) and \(\lambda\) are in VMEC coordinates).</li>
</ul>
</li>
<li>The formulas for the normal and geodesic basis vectors for HELENA are<ul>
<li>\(\frac{\nabla \psi}{\left|\nabla\psi\right|^2} = 
                 -\frac{1}{Z_\theta^2 + R_\theta^2} \frac{q R}{F}
                 \left( -Z_\theta , 0, R_\theta\right)_\text{C}\)</li>
<li>\(\frac{\nabla \psi \times  \vec{B}}{B^2} = 
                 \frac{q R^2}{R_\theta^2 + Z_\theta^2 + q^2 R^2}
                 \left(-R_\theta, -\frac{R_\theta^2 + Z_\theta^2}{q}, -Z_\theta\right)_\text{C}\) </li>
</ul>
</li>
</ol>
</dd></dl>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">grid_eq</td><td>equilibrium grid </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">eq_1</td><td>flux equilibrium variables </td></tr>
    <tr><td class="paramdir">[in,out]</td><td class="paramname">eq_2</td><td>metric equilibrium variables </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="eq__ops_8f90_source.html#l04286">4286</a> of file <a class="el" href="eq__ops_8f90_source.html">eq_ops.f90</a>.</p>
<div id="dynsection-2" onclick="return dynsection.toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;"><span class="dynarrow"><span class="arrowhead closed"></span></span>Here is the call graph for this function:</div>
<div id="dynsection-2-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-2-content" class="dyncontent" style="display:none;">
<div class="center"><iframe scrolling="no" loading="lazy" frameborder="0" src="namespaceeq__ops_a087e08ce6d8ad381b5bac8fc51148d50_cgraph.svg" width="920" height="335"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
<div id="dynsection-3" onclick="return dynsection.toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;"><span class="dynarrow"><span class="arrowhead closed"></span></span>Here is the caller graph for this function:</div>
<div id="dynsection-3-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-3-content" class="dyncontent" style="display:none;">
<div class="center"><iframe scrolling="no" loading="lazy" frameborder="0" src="namespaceeq__ops_a087e08ce6d8ad381b5bac8fc51148d50_icgraph.svg" width="486" height="39"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>

</div>
</div>
<a id="a6f509d7becf29b4f201a871bf4441d49" name="a6f509d7becf29b4f201a871bf4441d49"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a6f509d7becf29b4f201a871bf4441d49">&#9670;&#160;</a></span>calc_eq_jobs_lims()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">integer function, public eq_ops::calc_eq_jobs_lims </td>
          <td>(</td>
          <td class="paramtype">integer, intent(in)</td>          <td class="paramname"><span class="paramname"><em>n_par_x</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">integer, intent(in)</td>          <td class="paramname"><span class="paramname"><em>n_div</em></span>&#160;)</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Calculate <code>eq_jobs_lims</code>. </p>
<p>Take into account that every job has to start and end at the start and end of a fundamental integration interval, as discussed in <a class="el" href="#a6811942aeb421cf1495a65e639199975" title="Divides the equilibrium jobs.">divide_eq_jobs()</a>:</p><ul>
<li>for <code>magn_int_style=1</code> (trapezoidal), this is 1 point,</li>
<li>for <code>magn_int_style=2</code> (Simpson 3/8), this is 3 points.</li>
</ul>
<p>for POST, there are no Richardson levels, and there has to be overlap of one always, in order to have correct composite integrals of the different regions.</p>
<dl class="section note"><dt>Note</dt><dd>The <code>n_par_X</code> passed into this procedure refers to the quantity that is already possibly halved if the Richardson level is higher than 1. This information is then reflected in the eq_jobs_lims, which refer to the local limits, i.e. only the parallel points currently under consideration.</dd></dl>
<dl class="section return"><dt>Returns</dt><dd>ierr </dd></dl>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">n_par_x</td><td>number of parallel points in this Richardson level </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">n_div</td><td>nr. of divisions of parallel ranges </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="eq__ops_8f90_source.html#l06700">6700</a> of file <a class="el" href="eq__ops_8f90_source.html">eq_ops.f90</a>.</p>
<div id="dynsection-4" onclick="return dynsection.toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;"><span class="dynarrow"><span class="arrowhead closed"></span></span>Here is the call graph for this function:</div>
<div id="dynsection-4-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-4-content" class="dyncontent" style="display:none;">
<div class="center"><iframe scrolling="no" loading="lazy" frameborder="0" src="namespaceeq__ops_a6f509d7becf29b4f201a871bf4441d49_cgraph.svg" width="1190" height="323"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
<div id="dynsection-5" onclick="return dynsection.toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;"><span class="dynarrow"><span class="arrowhead closed"></span></span>Here is the caller graph for this function:</div>
<div id="dynsection-5-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-5-content" class="dyncontent" style="display:none;">
<div class="center"><iframe scrolling="no" loading="lazy" frameborder="0" src="namespaceeq__ops_a6f509d7becf29b4f201a871bf4441d49_icgraph.svg" width="659" height="91"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>

</div>
</div>
<a id="a7cd38586e386e1bc684a327ebcc4c1de" name="a7cd38586e386e1bc684a327ebcc4c1de"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a7cd38586e386e1bc684a327ebcc4c1de">&#9670;&#160;</a></span>calc_normalization_const()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">integer function, public eq_ops::calc_normalization_const</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Sets up normalization constants. </p>
<ul>
<li>VMEC version (<code>eq_style=1</code>):<br  />
 Normalization depends on <code>norm_style:</code> <ol type="1">
<li>MISHKA<ul>
<li>R_0: major radius (= average magnetic axis)</li>
<li>B_0: B on magnetic axis (theta = zeta = 0)</li>
<li>pres_0: reference pressure (= B_0^2/mu_0)</li>
<li>psi_0: reference flux (= R_0^2 B_0)</li>
<li>rho_0: reference mass density</li>
</ul>
</li>
<li>COBRA<ul>
<li>R_0: major radius (= average geometric axis)</li>
<li>pres_0: pressure on magnetic axis</li>
<li>B_0: reference magnetic field (= sqrt(2pres_0mu_0 / beta))</li>
<li>psi_0: reference flux (= R_0^2 B_0 / aspr^2)</li>
<li>rho_0: reference mass density where aspr (aspect ratio) and beta are given by VMEC.</li>
</ul>
</li>
</ol>
</li>
<li>HELENA version (<code>eq_style=2</code>):<br  />
 MISHKA Normalization is used by default and does not depend on <code>norm_style</code> </li>
</ul>
<dl class="section see"><dt>See also</dt><dd>read_hel()</dd></dl>
<dl class="section note"><dt>Note</dt><dd><code>rho_0</code> is not given through by the equilibrium codes and should be user-supplied</dd></dl>
<dl class="section return"><dt>Returns</dt><dd>ierr </dd></dl>

<p class="definition">Definition at line <a class="el" href="eq__ops_8f90_source.html#l05404">5404</a> of file <a class="el" href="eq__ops_8f90_source.html">eq_ops.f90</a>.</p>
<div id="dynsection-6" onclick="return dynsection.toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;"><span class="dynarrow"><span class="arrowhead closed"></span></span>Here is the call graph for this function:</div>
<div id="dynsection-6-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-6-content" class="dyncontent" style="display:none;">
<div class="center"><iframe scrolling="no" loading="lazy" frameborder="0" src="namespaceeq__ops_a7cd38586e386e1bc684a327ebcc4c1de_cgraph.svg" width="912" height="239"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
<div id="dynsection-7" onclick="return dynsection.toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;"><span class="dynarrow"><span class="arrowhead closed"></span></span>Here is the caller graph for this function:</div>
<div id="dynsection-7-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-7-content" class="dyncontent" style="display:none;">
<div class="center"><iframe scrolling="no" loading="lazy" frameborder="0" src="namespaceeq__ops_a7cd38586e386e1bc684a327ebcc4c1de_icgraph.svg" width="406" height="56"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>

</div>
</div>
<a id="a45303921478f07c074b598f65a26b2ec" name="a45303921478f07c074b598f65a26b2ec"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a45303921478f07c074b598f65a26b2ec">&#9670;&#160;</a></span>delta_r_plot()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">integer function, public eq_ops::delta_r_plot </td>
          <td>(</td>
          <td class="paramtype">type(<a class="el" href="structgrid__vars_1_1grid__type.html">grid_type</a>), intent(inout)</td>          <td class="paramname"><span class="paramname"><em>grid_eq</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">type(<a class="el" href="structeq__vars_1_1eq__1__type.html">eq_1_type</a>), intent(in)</td>          <td class="paramname"><span class="paramname"><em>eq_1</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">type(<a class="el" href="structeq__vars_1_1eq__2__type.html">eq_2_type</a>), intent(in)</td>          <td class="paramname"><span class="paramname"><em>eq_2</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real(dp), dimension(:,:,:,:), intent(in)</td>          <td class="paramname"><span class="paramname"><em>xyz</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">integer, intent(in), optional</td>          <td class="paramname"><span class="paramname"><em>rich_lvl</em></span>&#160;)</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Plots <b>HALF</b> of the change in the position vectors for 2 different toroidal positions, which can correspond to a ripple. </p>
<p>Also calculates <b>HALF</b> of the relative magnetic perturbation, which also corresponds to a ripple.</p>
<p>Finally, if the output grid contains a fundamental interval \(2\pi\), the proportionality between both is written to a file.</p>
<dl class="section note"><dt>Note</dt><dd>The metric factors and transformation matrices have to be allocated.</dd></dl>
<dl class="section return"><dt>Returns</dt><dd>ierr </dd></dl>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in,out]</td><td class="paramname">grid_eq</td><td>equilibrium grid </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">eq_1</td><td>flux equilibrium variables </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">eq_2</td><td>metric equilibrium variables </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">xyz</td><td>X, Y and Z of grid </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">rich_lvl</td><td>Richardson level </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="eq__ops_8f90_source.html#l06171">6171</a> of file <a class="el" href="eq__ops_8f90_source.html">eq_ops.f90</a>.</p>
<div id="dynsection-8" onclick="return dynsection.toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;"><span class="dynarrow"><span class="arrowhead closed"></span></span>Here is the call graph for this function:</div>
<div id="dynsection-8-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-8-content" class="dyncontent" style="display:none;">
<div class="center"><iframe scrolling="no" loading="lazy" frameborder="0" src="namespaceeq__ops_a45303921478f07c074b598f65a26b2ec_cgraph.svg" width="1411" height="667"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
<div id="dynsection-9" onclick="return dynsection.toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;"><span class="dynarrow"><span class="arrowhead closed"></span></span>Here is the caller graph for this function:</div>
<div id="dynsection-9-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-9-content" class="dyncontent" style="display:none;">
<div class="center"><iframe scrolling="no" loading="lazy" frameborder="0" src="namespaceeq__ops_a45303921478f07c074b598f65a26b2ec_icgraph.svg" width="651" height="39"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>

</div>
</div>
<a id="a6811942aeb421cf1495a65e639199975" name="a6811942aeb421cf1495a65e639199975"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a6811942aeb421cf1495a65e639199975">&#9670;&#160;</a></span>divide_eq_jobs()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">integer function, public eq_ops::divide_eq_jobs </td>
          <td>(</td>
          <td class="paramtype">integer, intent(in)</td>          <td class="paramname"><span class="paramname"><em>n_par_x</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">integer, dimension(2), intent(in)</td>          <td class="paramname"><span class="paramname"><em>arr_size</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">integer, intent(inout)</td>          <td class="paramname"><span class="paramname"><em>n_div</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">integer, intent(in), optional</td>          <td class="paramname"><span class="paramname"><em>n_div_max</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">integer, intent(in), optional</td>          <td class="paramname"><span class="paramname"><em>n_par_x_base</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">character(len=*), intent(in), optional</td>          <td class="paramname"><span class="paramname"><em>range_name</em></span>&#160;)</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Divides the equilibrium jobs. </p>
<p>For PB3D, the entire parallel range has to be calculated, but due to memory limits this has to be split up in pieces. Every piece has to be able to contain the equilibrium variables (see note below), as well as the vectorial perturbation variables. These are later combined into tensorial variables and integrated.</p>
<p>The equilibrium variables have to be operated on to calculate them, which translates to a scale factor <code>mem_scale_fac</code>. However, in the perturbation phase, when they are just used, this scale factor is not needed.</p>
<p>In its most extreme form, the division in equilibrium jobs would be the individual calculation on a fundamental integration integral of the parallel points:</p><ul>
<li>for <code>magn_int_style=1</code> (trapezoidal), this is 1 point,</li>
<li>for <code>magn_int_style=2</code> (Simpson 3/8), this is 3 points.</li>
</ul>
<p>For HELENA, the parallel derivatives are calculated discretely, the equilibrium and vectorial perturbation variables are tabulated first in this HELENA grid. This happens in the first Richardson level. In all Richardson levels, afterwards, these variables are interpolated in the angular directions. In this case, therefore, there can be no division of this HELENA output interval for the first Richardson level.</p>
<p>This procedure does the job of dividing the grids setting the global variables <code>eq_jobs_lims</code>.</p>
<p>The integration of the tensorial perturbation variables is adjusted:</p><ul>
<li>If the first job of the parallel jobs and not the first Richardson level: add half of the integrated tensorial perturbation quantities of the previous level.</li>
<li>If not the first job of the parallel jobs, add the integrated tensorial perturbation quantities to those of the previous parallel job, same Richardson level.</li>
</ul>
<p>In fact, the equilibrium jobs have much in common with the Richardson levels, as is attested by the existence of the routines do_eq() and eq_info(), which are equivalent to do_rich() and rich_info().</p>
<p>In POST, finally, the situation is slightly different for HELENA, as all the requested variables have to fit, including the interpolated variables, as they are stored whereas in PB3D they are not. The parallel range to be taken is then the one of the output grid, including a base range for the variables tabulated on the HELENA grid. Also, for extended output grids, the size of the grid in the secondary angle has to be included in <code>n_par_X</code> (i.e. toroidal when poloidal flux is used and vice versa). Furthermore, multiple equilibrium jobs are allowed.</p>
<p>To this end, optionally, a base number can be provided for <code>n_par_X</code>, that is always added to the number of points in the divided <code>n_par_X</code>.</p>
<dl class="section note"><dt>Note</dt><dd>For PB3D, only the variables <code>g_FD</code>, <code>h_FD</code> and <code>jac_FD</code> are counted, as the equilibrium variables and the transformation matrices are deleted after use. Also, <code>S</code>, <code>sigma</code>, <code>kappa_n</code> and <code>kappa_g</code> can be neglected as they do not contain derivatives and are therefore much smaller. in both routines calc_memory_eq() and calc_memory_x(), however, a 50% safety factor is used to account for this somewhat.</dd></dl>
<dl class="section return"><dt>Returns</dt><dd>ierr </dd></dl>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">n_par_x</td><td>number of parallel points to be divided </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">arr_size</td><td>array size (using loc_n_r) for eq_2 and X_1 variables </td></tr>
    <tr><td class="paramdir">[in,out]</td><td class="paramname">n_div</td><td>final number of divisions </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">n_div_max</td><td>maximum n_div </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">n_par_x_base</td><td>base n_par_X, undivisible </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">range_name</td><td>name of range </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="eq__ops_8f90_source.html#l06564">6564</a> of file <a class="el" href="eq__ops_8f90_source.html">eq_ops.f90</a>.</p>
<div id="dynsection-10" onclick="return dynsection.toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;"><span class="dynarrow"><span class="arrowhead closed"></span></span>Here is the call graph for this function:</div>
<div id="dynsection-10-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-10-content" class="dyncontent" style="display:none;">
<div class="center"><iframe scrolling="no" loading="lazy" frameborder="0" src="namespaceeq__ops_a6811942aeb421cf1495a65e639199975_cgraph.svg" width="1126" height="334"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
<div id="dynsection-11" onclick="return dynsection.toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;"><span class="dynarrow"><span class="arrowhead closed"></span></span>Here is the caller graph for this function:</div>
<div id="dynsection-11-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-11-content" class="dyncontent" style="display:none;">
<div class="center"><iframe scrolling="no" loading="lazy" frameborder="0" src="namespaceeq__ops_a6811942aeb421cf1495a65e639199975_icgraph.svg" width="635" height="91"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>

</div>
</div>
<a id="af0effe20188d46a44680c2648e4572e9" name="af0effe20188d46a44680c2648e4572e9"></a>
<h2 class="memtitle"><span class="permalink"><a href="#af0effe20188d46a44680c2648e4572e9">&#9670;&#160;</a></span>flux_q_plot()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">integer function, public eq_ops::flux_q_plot </td>
          <td>(</td>
          <td class="paramtype">type(<a class="el" href="structgrid__vars_1_1grid__type.html">grid_type</a>), intent(in)</td>          <td class="paramname"><span class="paramname"><em>grid_eq</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">type(<a class="el" href="structeq__vars_1_1eq__1__type.html">eq_1_type</a>), intent(in)</td>          <td class="paramname"><span class="paramname"><em>eq</em></span>&#160;)</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Plots the flux quantities in the solution grid. </p>
<ul>
<li>safety factor <code>q_saf</code> </li>
<li>rotational transform <code>rot_t</code> </li>
<li>pressure <code>pres</code> </li>
<li>poloidal flux <code>flux_p</code> </li>
<li>toroidal flux <code>flux_t</code> </li>
</ul>
<dl class="section return"><dt>Returns</dt><dd>ierr </dd></dl>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">grid_eq</td><td>normal grid </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">eq</td><td>flux equilibrium variables </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="eq__ops_8f90_source.html#l03809">3809</a> of file <a class="el" href="eq__ops_8f90_source.html">eq_ops.f90</a>.</p>
<div id="dynsection-12" onclick="return dynsection.toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;"><span class="dynarrow"><span class="arrowhead closed"></span></span>Here is the call graph for this function:</div>
<div id="dynsection-12-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-12-content" class="dyncontent" style="display:none;">
<div class="center"><iframe scrolling="no" loading="lazy" frameborder="0" src="namespaceeq__ops_af0effe20188d46a44680c2648e4572e9_cgraph.svg" width="1142" height="356"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
<div id="dynsection-13" onclick="return dynsection.toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;"><span class="dynarrow"><span class="arrowhead closed"></span></span>Here is the caller graph for this function:</div>
<div id="dynsection-13-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-13-content" class="dyncontent" style="display:none;">
<div class="center"><iframe scrolling="no" loading="lazy" frameborder="0" src="namespaceeq__ops_af0effe20188d46a44680c2648e4572e9_icgraph.svg" width="611" height="91"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>

</div>
</div>
<a id="aa16cc7b5d17f3e3b65b045f12b40540d" name="aa16cc7b5d17f3e3b65b045f12b40540d"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aa16cc7b5d17f3e3b65b045f12b40540d">&#9670;&#160;</a></span>j_plot()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">integer function, public eq_ops::j_plot </td>
          <td>(</td>
          <td class="paramtype">type(<a class="el" href="structgrid__vars_1_1grid__type.html">grid_type</a>), intent(inout)</td>          <td class="paramname"><span class="paramname"><em>grid_eq</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">type(<a class="el" href="structeq__vars_1_1eq__1__type.html">eq_1_type</a>), intent(in)</td>          <td class="paramname"><span class="paramname"><em>eq_1</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">type(<a class="el" href="structeq__vars_1_1eq__2__type.html">eq_2_type</a>), intent(in)</td>          <td class="paramname"><span class="paramname"><em>eq_2</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">integer, intent(in), optional</td>          <td class="paramname"><span class="paramname"><em>rich_lvl</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">logical, intent(in), optional</td>          <td class="paramname"><span class="paramname"><em>plot_fluxes</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real(dp), dimension(:,:,:,:), intent(in), optional</td>          <td class="paramname"><span class="paramname"><em>xyz</em></span>&#160;)</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Plots the current. </p>
<p>If multiple equilibrium parallel jobs, every job does its piece, and the results are joined automatically by plot_HDF5.</p>
<p>The outputs are given in contra- and covariant components and magnitude in multiple coordinate systems, as indicated in calc_vec_comp().</p>
<p>The starting point is the pressure balance </p><p class="formulaDsp">
\[ \nabla p = \vec{J} \times \vec{B}, \]
</p>
<p> which, using \(\vec{B} = \frac{\vec{e}_{\theta}}{\mathcal{J}}\), reduces to </p><p class="formulaDsp">
\[J^\alpha = -p&#39;. \]
</p>
<p> Furthermore, the current has to lie in the magnetic flux surfaces: </p><p class="formulaDsp">
\[J^\psi = 0. \]
</p>
<p> Finally, the parallel current \(\sigma\) gives an expression for the last contravariant component:  </p><p class="formulaDsp">
\[J^\theta =
             \frac{\sigma}{\mathcal{J}} + p&#39; \frac{B_\alpha}{B_\theta}. \]
</p>
<p> From these, the contravariant components can be calculated as </p><p class="formulaDsp">
\[J_i = J^\alpha g_{\alpha,i} + J^\theta g_{\theta,i}. \]
</p>
<p>These are then all be transformed to the other coordinate systems. </p><dl class="section note"><dt>Note</dt><dd><ol type="1">
<li>Vector plots for different Richardson levels can be combined to show the total grid by just plotting them all individually.</li>
<li>The metric factors and transformation matrices have to be allocated.</li>
</ol>
</dd></dl>
<dl class="section return"><dt>Returns</dt><dd>ierr </dd></dl>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in,out]</td><td class="paramname">grid_eq</td><td>equilibrium grid </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">eq_1</td><td>flux equilibrium variables </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">eq_2</td><td>metric equilibrium variables </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">rich_lvl</td><td>Richardson level </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">plot_fluxes</td><td>plot the fluxes </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">xyz</td><td>X, Y and Z of grid </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="eq__ops_8f90_source.html#l05801">5801</a> of file <a class="el" href="eq__ops_8f90_source.html">eq_ops.f90</a>.</p>
<div id="dynsection-14" onclick="return dynsection.toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;"><span class="dynarrow"><span class="arrowhead closed"></span></span>Here is the call graph for this function:</div>
<div id="dynsection-14-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-14-content" class="dyncontent" style="display:none;">
<div class="center"><iframe scrolling="no" loading="lazy" frameborder="0" src="namespaceeq__ops_aa16cc7b5d17f3e3b65b045f12b40540d_cgraph.svg" width="1355" height="567"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
<div id="dynsection-15" onclick="return dynsection.toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;"><span class="dynarrow"><span class="arrowhead closed"></span></span>Here is the caller graph for this function:</div>
<div id="dynsection-15-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-15-content" class="dyncontent" style="display:none;">
<div class="center"><iframe scrolling="no" loading="lazy" frameborder="0" src="namespaceeq__ops_aa16cc7b5d17f3e3b65b045f12b40540d_icgraph.svg" width="603" height="91"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>

</div>
</div>
<a id="a55917387e2d5511f49396a2b7f9f2b5a" name="a55917387e2d5511f49396a2b7f9f2b5a"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a55917387e2d5511f49396a2b7f9f2b5a">&#9670;&#160;</a></span>kappa_plot()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">integer function, public eq_ops::kappa_plot </td>
          <td>(</td>
          <td class="paramtype">type(<a class="el" href="structgrid__vars_1_1grid__type.html">grid_type</a>), intent(inout)</td>          <td class="paramname"><span class="paramname"><em>grid_eq</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">type(<a class="el" href="structeq__vars_1_1eq__1__type.html">eq_1_type</a>), intent(in)</td>          <td class="paramname"><span class="paramname"><em>eq_1</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">type(<a class="el" href="structeq__vars_1_1eq__2__type.html">eq_2_type</a>), intent(in)</td>          <td class="paramname"><span class="paramname"><em>eq_2</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">integer, intent(in), optional</td>          <td class="paramname"><span class="paramname"><em>rich_lvl</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real(dp), dimension(:,:,:,:), intent(in), optional</td>          <td class="paramname"><span class="paramname"><em>xyz</em></span>&#160;)</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Plots the curvature. </p>
<p>If multiple equilibrium parallel jobs, every job does its piece, and the results are joined automatically by plot_HDF5.</p>
<p>The outputs are given in contra- and covariant components and magnitude in multiple coordinate systems, as indicated in calc_vec_comp().</p>
<p>The starting point is the curvature, given by   </p><p class="formulaDsp">
\[\vec{\kappa} =
             \kappa_n \frac{\nabla \psi}{ \left|\nabla \psi\right|^2 } +
             \kappa_g \frac{\nabla \psi \times \vec{B}}{B^2} , \]
</p>
<p> which can be used to find the covariant and contravariant components in Flux coordinates.</p>
<p>These are then transformed to Cartesian coordinates and plotted.</p>
<dl class="section note"><dt>Note</dt><dd><ol type="1">
<li>Vector plots for different Richardson levels can be combined to show the total grid by just plotting them all individually.</li>
<li>The metric factors and transformation matrices have to be allocated.</li>
</ol>
</dd></dl>
<dl class="section return"><dt>Returns</dt><dd>ierr </dd></dl>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in,out]</td><td class="paramname">grid_eq</td><td>equilibrium grid </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">eq_1</td><td>metric equilibrium variables </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">eq_2</td><td>metric equilibrium variables </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">rich_lvl</td><td>Richardson level </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">xyz</td><td>X, Y and Z of grid </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="eq__ops_8f90_source.html#l05969">5969</a> of file <a class="el" href="eq__ops_8f90_source.html">eq_ops.f90</a>.</p>
<div id="dynsection-16" onclick="return dynsection.toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;"><span class="dynarrow"><span class="arrowhead closed"></span></span>Here is the call graph for this function:</div>
<div id="dynsection-16-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-16-content" class="dyncontent" style="display:none;">
<div class="center"><iframe scrolling="no" loading="lazy" frameborder="0" src="namespaceeq__ops_a55917387e2d5511f49396a2b7f9f2b5a_cgraph.svg" width="1387" height="723"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
<div id="dynsection-17" onclick="return dynsection.toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;"><span class="dynarrow"><span class="arrowhead closed"></span></span>Here is the caller graph for this function:</div>
<div id="dynsection-17-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-17-content" class="dyncontent" style="display:none;">
<div class="center"><iframe scrolling="no" loading="lazy" frameborder="0" src="namespaceeq__ops_a55917387e2d5511f49396a2b7f9f2b5a_icgraph.svg" width="635" height="91"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>

</div>
</div>
<a id="a1b4c764da73624722d7e76498a2b80a9" name="a1b4c764da73624722d7e76498a2b80a9"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a1b4c764da73624722d7e76498a2b80a9">&#9670;&#160;</a></span>normalize_input()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">subroutine, public eq_ops::normalize_input</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Normalize input quantities. </p>
<dl class="section see"><dt>See also</dt><dd><a class="el" href="#a7cd38586e386e1bc684a327ebcc4c1de" title="Sets up normalization constants.">calc_normalization_const()</a> </dd></dl>

<p class="definition">Definition at line <a class="el" href="eq__ops_8f90_source.html#l05642">5642</a> of file <a class="el" href="eq__ops_8f90_source.html">eq_ops.f90</a>.</p>
<div id="dynsection-18" onclick="return dynsection.toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;"><span class="dynarrow"><span class="arrowhead closed"></span></span>Here is the call graph for this function:</div>
<div id="dynsection-18-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-18-content" class="dyncontent" style="display:none;">
<div class="center"><iframe scrolling="no" loading="lazy" frameborder="0" src="namespaceeq__ops_a1b4c764da73624722d7e76498a2b80a9_cgraph.svg" width="920" height="154"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
<div id="dynsection-19" onclick="return dynsection.toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;"><span class="dynarrow"><span class="arrowhead closed"></span></span>Here is the caller graph for this function:</div>
<div id="dynsection-19-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-19-content" class="dyncontent" style="display:none;">
<div class="center"><iframe scrolling="no" loading="lazy" frameborder="0" src="namespaceeq__ops_a1b4c764da73624722d7e76498a2b80a9_icgraph.svg" width="382" height="39"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>

</div>
</div>
<a name="doc-var-members" id="doc-var-members"></a><h2 id="header-doc-var-members" class="groupheader">Variable Documentation</h2>
<a id="a1b6609a8d8b427d9133bf323e732f209" name="a1b6609a8d8b427d9133bf323e732f209"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a1b6609a8d8b427d9133bf323e732f209">&#9670;&#160;</a></span>debug_calc_derived_q</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">logical, public eq_ops::debug_calc_derived_q = .false.</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>plot debug information for <a class="el" href="#a087e08ce6d8ad381b5bac8fc51148d50" title="Calculates derived equilibrium quantities system.">calc_derived_q()</a> </p>
<dl class="section note"><dt>Note</dt><dd>Debug version only </dd></dl>

<p class="definition">Definition at line <a class="el" href="eq__ops_8f90_source.html#l00030">30</a> of file <a class="el" href="eq__ops_8f90_source.html">eq_ops.f90</a>.</p>

</div>
</div>
<a id="a07ca60790a262e20bc8632be1530970a" name="a07ca60790a262e20bc8632be1530970a"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a07ca60790a262e20bc8632be1530970a">&#9670;&#160;</a></span>debug_create_vmec_input</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">logical, public eq_ops::debug_create_vmec_input = .false.</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>plot debug information for create_vmec_input() </p>
<dl class="section note"><dt>Note</dt><dd>Debug version only </dd></dl>

<p class="definition">Definition at line <a class="el" href="eq__ops_8f90_source.html#l00034">34</a> of file <a class="el" href="eq__ops_8f90_source.html">eq_ops.f90</a>.</p>

</div>
</div>
<a id="a45ba7f46fd439bbd73edfd1fd548b58e" name="a45ba7f46fd439bbd73edfd1fd548b58e"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a45ba7f46fd439bbd73edfd1fd548b58e">&#9670;&#160;</a></span>debug_j_plot</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">logical, public eq_ops::debug_j_plot = .false.</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>plot debug information for <a class="el" href="#aa16cc7b5d17f3e3b65b045f12b40540d" title="Plots the current.">j_plot()</a> </p>
<dl class="section note"><dt>Note</dt><dd>Debug version only </dd></dl>

<p class="definition">Definition at line <a class="el" href="eq__ops_8f90_source.html#l00032">32</a> of file <a class="el" href="eq__ops_8f90_source.html">eq_ops.f90</a>.</p>

</div>
</div>
</div><!-- contents -->
<!-- HTML footer for doxygen 1.8.13-->
<!-- start footer part -->
<address class="footer"><small>
<center>this documentation was created with <a href="http://www.doxygen.org/index.html">Doxygen 1.16.1</a> by <a href="mailto:weyenst@gmail.com">Toon Weyens</a></center>
</small></address>
</body>
</html>
