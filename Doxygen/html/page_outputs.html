<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.16.1"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>PB3D: Code outputs</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="clipboard.js"></script>
<script type="text/javascript" src="cookie.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  extensions: ["tex2jax.js", "TeX/AMSmath.js", "TeX/AMSsymbols.js"],
  jax: ["input/TeX","output/HTML-CSS"],
});
</script>
<script type="text/javascript" async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.2/MathJax.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="customdoxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">PB3D<span id="projectnumber">&#160;[2.47]</span>
   </div>
   <div id="projectbrief">Ideal linear high-n MHD stability in 3-D</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.16.1 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search/",'.html');
</script>
<script type="text/javascript">
$(function() { codefold.init(); });
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search',false);
  $(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

</div><!-- top -->
<div id="doc-content">
<div><div class="header">
  <div class="headertitle"><div class="title">Code outputs </div></div>
</div><!--header-->
<div class="contents">
<div class="toc"><h3>Table of Contents</h3>
<ul>
  <li class="level1">
    <a href="#output_files">Output Files </a>
    <ul>
      <li class="level2">
        <a href="#output_file_log">Log file </a>
      </li>
      <li class="level2">
        <a href="#output_file_shell">Shell commands file </a>
      </li>
      <li class="level2">
        <a href="#output_file_HDF5">HDF5 output file </a>
      </li>
      <li class="level2">
        <a href="#output_file_EV">Eigenvalue summary file </a>
      </li>
      <li class="level2">
        <a href="#output_file_E_rec">Energy reconstruction file </a>
      </li>
      <li class="level2">
        <a href="#output_file_mem">Memory usage file </a>
      </li>
    </ul>
  </li>
  <li class="level1">
    <a href="#output_plots">Output Plots </a>
  </li>
</ul>
</div>
<div class="textblock"><p></p>
<p>This page describes the various outputs that PB3D and POST can produce.</p>
<p>On the one hand, there are various text output files, which are discussed in section <a class="el" href="#output_files" title="Output Files">Output Files</a>.</p>
<p>Furthermore, a multitude of plots can be produced. This is the topic of section <a class="el" href="#output_plots" title="Output Plots">Output Plots</a>.</p>
<h1 class="doxsection"><a class="anchor" id="output_files"></a>
Output Files</h1>
<p>Some of these files are opened in open_output(), but others are opened afterwards.</p>
<h2 class="doxsection"><a class="anchor" id="output_file_log"></a>
Log file</h2>
<p>Both PB3D and POST produce a log file, in addition to what is produced on the screen.</p>
<p>These log files are called <span class="tt">PB3D_out.txt</span> and <span class="tt">POST_out.txt</span> and they contain the same information as the output on the screen, but without the special formatting provided by the foul library (see <a class="el" href="page_installation.html#installation_introduction" title="Introduction">Introduction</a>).</p>
<h2 class="doxsection"><a class="anchor" id="output_file_shell"></a>
Shell commands file</h2>
<p>Some output routines make use of use_execute_command_line() in order to execute shell commands. This can be, for example, the creation of a plot by calling GnuPlot, among other things.</p>
<p>However, this often does not work well by default (see <a class="el" href="page_inputs.html#fni30" title="fni30">30</a> in <a class="el" href="page_inputs.html" title="Input variables">Input variables</a>). In PB3D and POST, therefore, by default, these commands are not executed, but written to an output file. After execution of PB3D and POST has finished, this file can be made executed.</p>
<p>This behavior can be changed using the <span class="tt">&ndash;do_execute_command_line</span> flag (see <a class="el" href="page_inputs.html" title="Input variables">Input variables</a>).</p>
<h2 class="doxsection"><a class="anchor" id="output_file_HDF5"></a>
HDF5 output file</h2>
<p>PB3D writes variables to an HDF5 output file during execution, as shown in table <a class="el" href="#output_file_HDF5_tab" title="output_file_HDF5_tab">1</a>. Note that there is a difference between the equilibrium styles because of the way how the equilibrium codes provide output:</p><ul>
<li>VMEC (<span class="tt">eq_style = 1</span>) produces double Fourier series:<ul>
<li>This can be evaluated at arbitrary angular points.</li>
<li>In PB3D, the equilibrium and perturbation variables are therefore already calculated on the field-aligned grid.</li>
<li>Parallel integration can then be done directly.</li>
</ul>
</li>
<li>HELENA (<span class="tt">eq_style = 2</span>) produces 2-D tables for the poloidal cross-section.<ul>
<li>This needs to be interpolated along the magnetic field lines before parallel integration.</li>
<li>The equilibrium and perturbation variables are calculated first in the HELENA grid.</li>
</ul>
</li>
</ul>
<a class="anchor" id="output_file_HDF5_tab"></a>
<table class="doxtable">
<caption>Table 1. HDF5 output file</caption>
<tr>
<th width="24%">variable type </th><th width="38%">VMEC (<span class="tt">eq_style = 1</span>) </th><th width="38%">HELENA (<span class="tt">eq_style = 2</span>) </th></tr>
<tr>
<td rowspan="1">inputs </td><td colspan="2">in preliminary phase </td></tr>
<tr>
<td rowspan="10">grids of <a class="el" href="structgrid__vars_1_1grid__type.html" title="Type for grids.">grid_vars.grid_type</a> </td><td colspan="2" bgcolor="LightGray" align="center"><b>equilibrium</b> </td></tr>
<tr>
<td colspan="2">field-aligned-grid at every Richardson level</td></tr>
<tr>
<td></td><td>also output HELENA grid at first Richardson level</td></tr>
<tr>
<td></td><td>used later for interpolation to field-aligned grid</td></tr>
<tr>
<td colspan="2" bgcolor="LightGray" align="center"><b>perturbation</b> </td></tr>
<tr>
<td colspan="2">field-aligned-grid at every Richardson level</td></tr>
<tr>
<td></td><td>also output HELENA grid at first Richardson level</td></tr>
<tr>
<td></td><td>used later for interpolation to field-aligned grid</td></tr>
<tr>
<td colspan="2" bgcolor="LightGray" align="center"><b>solution</b> </td></tr>
<tr>
<td colspan="2">only at first Richardson level</td></tr>
<tr>
<td rowspan="1">flux equilibria of <a class="el" href="structeq__vars_1_1eq__1__type.html" title="flux equilibrium type">eq_vars.eq_1_type</a> </td><td colspan="2">only at first Richardson level </td></tr>
<tr>
<td rowspan="3">metric equilibria of <a class="el" href="structeq__vars_1_1eq__2__type.html" title="metric equilibrium type">eq_vars.eq_2_type</a> </td><td colspan="2">only at first Richardson level </td></tr>
<tr>
<td></td><td>also output HELENA grid at first Richardson level</td></tr>
<tr>
<td></td><td>used later for interpolation to field-aligned grid</td></tr>
<tr>
<td rowspan="1">vacuums of <a class="el" href="structvac__vars_1_1vac__type.html" title="vacuum type">vac_vars.vac_type</a> </td><td>at every Richardson level </td><td>only at first Richardson level </td></tr>
<tr>
<td rowspan="1">solutions of <a class="el" href="structsol__vars_1_1sol__type.html" title="solution type">sol_vars.sol_type</a> </td><td colspan="2">at every Richardson level </td></tr>
</table>
<p>This data is used for Richardson restart (see variable <code>rich_restart_lvl</code> in <a class="el" href="page_inputs.html" title="Input variables">Input variables</a>).</p>
<p>In the post-processing phase, POST reads this data as well.</p>
<h2 class="doxsection"><a class="anchor" id="output_file_EV"></a>
Eigenvalue summary file</h2>
<p>In each Richardson extrapolation level, after the solution of the eigenvalue system of equations, eigenvalues are stored in PB3D.</p><ul>
<li>For SLEPC, the results are saved in the procedure store_results():<ul>
<li>If normalization is used, the normalization time scale is also stored.</li>
<li>If an unphysical complex eigenvalue is detected, this is indicated. See <code>option</code> retain_all_sol in <a class="el" href="page_inputs.html#inputs_PB3D_file" title="Input file">Input file</a>.</li>
</ul>
</li>
</ul>
<h2 class="doxsection"><a class="anchor" id="output_file_E_rec"></a>
Energy reconstruction file</h2>
<p>If energy reconstruction is performed by POST (see <code>plot_E_rec</code> in <a class="el" href="page_inputs.html" title="Input variables">Input variables</a>), the individual terms that make up the perturbed potential energy as well as the kinetic energy of the perturbation are calculated and plot. (<a class="el" href="#fno3" title="fno3">3</a>) Furthermore, the integration of these quantities over the whole volume, is returned in an output file.</p>
<p>In table <a class="el" href="#e_rec_tab" title="e_rec_tab">2</a>, an overview is given of the different terms. Here, \(\rho\) is the density, \(\sigma = \frac{\vec{B}\cdot\vec{J}}{B^2}\) is the parallel current and \(\kappa = \frac{\vec{B}}{B} \cdot \nabla \frac{\vec{B}}{B}\) is the magnetic curvature. See calc_e().</p>
<a class="anchor" id="e_rec_tab"></a>
<table class="doxtable">
<caption>Table 2. energy reconstruction</caption>
<tr>
<th>potential energy \(E_\text{pot}\) </th><th>kinetic energy \(E_\text{kin}\) </th></tr>
<tr>
<td><ul>
<li>
normal line bending term \(\frac{1}{\left|\nabla\psi\right|^2 }\left(\frac{\nabla \psi}{\left|\nabla \psi\right|^2}\cdot \vec{Q}\right)^2\)  </li>
<li>
gedesic line bending term \(\mathcal{J}^2\frac{\left|\nabla \psi\right|^2}{B^2} \left( \frac{\nabla \psi \times \vec{B}}{B^2}\cdot \vec{Q} \right)^2\)  </li>
<li>
normal ballooning term \(-2 p&#39; \left(\nabla \psi \cdot \vec{\xi}\right)^2 \left(\nabla \psi \cdot \vec{\kappa}\right)\)  </li>
<li>
geodesic ballooning term \(-2 p&#39; \left( \nabla \psi \cdot \vec{\xi} \right) \left( \frac{\nabla \psi \times \vec{B}}{\left|\nabla \psi \right|^2} \cdot \vec{\xi}\right)^* \left(\frac{\nabla \psi \times \vec{B}}{\left|\nabla \psi \right|^2} \cdot \vec{\kappa}\right)\)  </li>
<li>
normal kink term \(-2 \sigma \left(\nabla \psi \cdot \vec{\xi}\right)^* \left(\frac{\nabla \psi \times \vec{B}}{B^2}\cdot \vec{Q} \right)\)  </li>
<li>
geodesic kink term \( 2 \sigma \left(\frac{\nabla \psi \times \vec{B}}{B^2} \cdot \vec{\xi}\right)^* \left(\nabla \psi\cdot \vec{Q} \right)\)  </li>
</ul>
</td><td><ul>
<li>
normal kinetic term \(\frac{1}{\left|\nabla\psi\right|^2 }\left(\frac{\nabla \psi}{\left|\nabla \psi\right|^2}\cdot \vec{\xi}\right)^2\)  </li>
<li>
gedesic kinetic term \(\mathcal{J}^2\frac{\left|\nabla \psi\right|^2}{B^2} \left( \frac{\nabla \psi \times \vec{B}}{B^2}\cdot \vec{\xi} \right)^2\)  </li>
</ul>
</td></tr>
</table>
<h2 class="doxsection"><a class="anchor" id="output_file_mem"></a>
Memory usage file</h2>
<p>The memory usage of PB3D and POST can be monitored using the optional input argument <span class="tt">&ndash;mem_info</span> (see <a class="el" href="page_inputs.html#inputs_PB3D_cmd" title="Command-line inputs">Command-line inputs</a>).</p>
<p>This is a rather crude implementation and more advance profiling methods should be used, such as <a href="http://www.scalasca.org/">Scalasca</a> on top of <a href="http://www.vi-hps.org/projects/score-p/">Score-P</a>.</p>
<dl class="section note"><dt>Note</dt><dd>Debug version only</dd></dl>
<h1 class="doxsection"><a class="anchor" id="output_plots"></a>
Output Plots</h1>
<p>A multitude of plots can be produced by PB3D and POST.</p>
<p>POST can produce all the plots that PB3D can, and some more.</p>
<p>The plots themselves fall in two categories:</p><ul>
<li>Plots using an external program.<ul>
<li>Produced by <a class="el" href="interfaceoutput__ops_1_1print__ex__2d.html" title="Print 2-D output on a file.">output_ops.print_ex_2d()</a> or <a class="el" href="interfaceoutput__ops_1_1print__ex__3d.html" title="Print 3-D output on a file.">output_ops.print_ex_3d()</a> combined with draw_ex().</li>
<li>A list of external programs is given in draw_ex().</li>
<li>These plots require a shell command to be run, which is disabled by default and the commands are stored in a <a class="el" href="#output_file_shell" title="Shell commands file">Shell commands file</a>.</li>
<li>The produced plots can be 2-D or 3-D, and they can be interactive or not, depending on the <code>ex_plot_style</code> (see <a class="el" href="page_inputs.html" title="Input variables">Input variables</a>).</li>
</ul>
</li>
<li>Data files that can be used to produce plots with visualization software:<ul>
<li>The software used here was <a href="https://visit.llnl.gov/">VisIt</a>, based on personal preference, but <a href="https://www.paraview.org/">ParaView</a> or other VTK-based solutions should work equally well.</li>
<li>Every plot creates two output files: one heavy-data HDF5 file and one <a href="www.xdmf.org/">XDMF</a> file that contains specifics about the HDF5 file.</li>
<li>This is necessary, as HDF5 itself is too general a format for general visualization tools to interpret easily.</li>
<li>The XDMF file that accompanies each HDF5 file basically contains information about the saved variables, such as whether they are vectors or scalars, and on which grid type they are defined.</li>
<li>This is the file that should be opened by the visualzation software.</li>
<li>The dimensions of these plots can be 2-D or 3-D, depending on <code>eq_style</code>. See <a class="el" href="page_inputs.html#fni19" title="fni19">19</a> and <a class="el" href="page_inputs.html#fni20" title="fni20">20</a> in <a class="el" href="page_inputs.html" title="Input variables">Input variables</a>.</li>
</ul>
</li>
</ul>
<p>An overview of possible plots is now given in table <a class="el" href="#output_plots_tab" title="output_plots_tab">3</a>. The name of the respective input parameter is provided as well. See <a class="el" href="page_inputs.html" title="Input variables">Input variables</a>.</p>
<a class="anchor" id="output_plots_tab"></a>
<table class="doxtable">
<caption>Table 3. possible plots</caption>
<tr>
<th width="20%">plot type </th><th width="40%">external plot </th><th width="40%">HDF5 plot </th></tr>
<tr>
<td rowspan="1">flux quantities (<span class="tt">plot_flux_q</span>) </td><td><ul>
<li>
pressure \(p\)</li>
<li>
poloidal flux \(\Psi_\text{pol}\)</li>
<li>
toroidal flux \(\Psi_\text{tor}\)</li>
</ul>
</td><td><ul>
<li>
safety factor \(q\)</li>
<li>
rotational transform \(\iota\)</li>
<li>
pressure \(p\)</li>
<li>
poloidal flux \(\Psi_\text{pol}\)</li>
<li>
toroidal flux \(\Psi_\text{tor}\)</li>
</ul>
</td></tr>
<tr>
<td rowspan="1">resonance (<span class="tt">plot_resonance</span>) </td><td>safety factor \(q\) (poloidal flux) or rotational transform \(\iota\) (toroidal flux) with the indication of the resonant flux surfaces (<a class="el" href="#fno1" title="fno1">1</a>) </td><td>surfaces of resonant values for safety factor \(q\) (poloidal flux) or rotational transform \(\iota\) (toroidal flux) (<a class="el" href="#fno1" title="fno1">1</a>) </td></tr>
<tr>
<td rowspan="1">magnetic grid (<span class="tt">plot_magn_grid</span>) </td><td bgcolor="LightGray"></td><td>magnetic grid lines in the magnetic flux surfaces, as a time collection </td></tr>
<tr>
<td rowspan="1">magnetic field \(\vec{B}\) (<span class="tt">plot_B</span>) </td><td bgcolor="LightGray"></td><td>co- and contravariant components of magnetic field, as well as magnitude and vector plot </td></tr>
<tr>
<td rowspan="1">current density \(\vec{J}\) (<span class="tt">plot_J</span>) </td><td bgcolor="LightGray"></td><td>co- and contravariant components of current density, as well as magnitude and vector plot </td></tr>
<tr>
<td rowspan="1">magnetic curvature \(\vec{\kappa}\) (<span class="tt">plot_kappa</span>) </td><td bgcolor="LightGray"></td><td>co- and contravariant components of magnetic curvature, as well as magnitude and vector plot </td></tr>
<tr>
<td rowspan="1">solution normal mode \(\vec{\xi}\) (<span class="tt">plot_sol_xi</span>) </td><td bgcolor="LightGray"></td><td>real and imaginary part and phase of perturbation of position, as well as vector plot </td></tr>
<tr>
<td rowspan="1">perturbated magnetic field due to solution normal mode \(\vec{Q}\) (<span class="tt">plot_sol_Q</span>) </td><td bgcolor="LightGray"></td><td>real and imaginary part and phase of perturbation of magnetic field, as well as vector plot </td></tr>
<tr>
<td rowspan="1">energy reconstruction (<span class="tt">plot_E_rec</span>) </td><td bgcolor="LightGray"></td><td>different components of energy reconstruction, integrated as well as profiles (<a class="el" href="#fno2" title="fno2">2</a>) </td></tr>
</table>
<dl class="section note"><dt>Note</dt><dd><ol type="1">
<li><a class="anchor" id="fno1"></a>See <code>use_pol_flux_F</code> in <a class="el" href="page_inputs.html" title="Input variables">Input variables</a>.</li>
<li><a class="anchor" id="fno2"></a>The integrated energy reconstruction terms are also output to a file. See <a class="el" href="#output_file_E_rec" title="Energy reconstruction file">Energy reconstruction file</a>.</li>
<li><a class="anchor" id="fno3"></a>Energy reconstruction only works well when <span class="tt"> POST_style = 2 </span> is used, i.e. when the same grid is used as for PB3D. </li>
</ol>
</dd></dl>
</div></div><!-- contents -->
</div><!-- PageDoc -->
<!-- HTML footer for doxygen 1.8.13-->
<!-- start footer part -->
<address class="footer"><small>
<center>this documentation was created with <a href="http://www.doxygen.org/index.html">Doxygen 1.16.1</a> by <a href="mailto:weyenst@gmail.com">Toon Weyens</a></center>
</small></address>
</body>
</html>
