<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.13"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>PB3D: General code structure</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    extensions: ["tex2jax.js", "TeX/AMSmath.js", "TeX/AMSsymbols.js"],
    jax: ["input/TeX","output/HTML-CSS"],
});
</script><script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.2/MathJax.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="customdoxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">PB3D
   &#160;<span id="projectnumber">[2.32]</span>
   </div>
   <div id="projectbrief">Ideal linear high-n MHD stability in 3-D</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">General code structure </div>  </div>
</div><!--header-->
<div class="contents">
<div class="toc"><h3>Table of Contents</h3>
<ul><li class="level1"><a href="#overview_PB3D_flowchart">PB3D flowchart</a></li>
<li class="level1"><a href="#overview_jobs">Equilibrium &amp; Perturbation Jobs</a><ul><li class="level2"><a href="#overview_jobs_X">Perturbation jobs</a></li>
<li class="level2"><a href="#overview_jobs_eq">Equilibrium jobs</a></li>
</ul>
</li>
<li class="level1"><a href="#detail_PB3D">Detailed PB3D Flowchart</a></li>
<li class="level1"><a href="#overview_POST">POST Overview</a></li>
</ul>
</div>
<div class="textblock"><p>This page describes the general code structure of PB3D, as well as its accompanying post-process program POST. It is more complete than the documentation that can be found in <a class="el" href="citelist.html#CITEREF_Weyens2017PB3D">[16]</a>.</p>
<h1><a class="anchor" id="overview_PB3D_flowchart"></a>
PB3D flowchart</h1>
<p>In <a class="el" href="page_overview.html#flowchart_fig">figure 1</a>, the top-level flowchart of PB3D is shown (adapted from <a class="el" href="citelist.html#CITEREF_Weyens2017PB3D">[16]</a>):</p>
<p><a class="anchor" id="flowchart_fig"></a></p><div class="image">
<object type="image/svg+xml" data="flowchart.svg" width="40%">flowchart.svg</object>
<div class="caption">
<b>Figure</b> <b>1</b> <b></b>: basic PB3D flowchart</div></div>
 <p>Roughly speaking, the main body of the code is taken up by four driver routines:</p><ul>
<li>input driver</li>
<li>equilibrium driver</li>
<li>perturbation driver</li>
<li>solution driver</li>
</ul>
<p>The <b>input driver</b> sets the other drivers up by reading input options as well as quantities from equilibrium codes, and converting them to the internal PB3D format.</p>
<p>The <b>equilibrium driver</b> uses these input variables to set up equilibrium quantities.</p><ul>
<li>On the one hand these consist of flux equilibrium quantities (stored in a <a class="el" href="structeq__vars_1_1eq__1__type.html" title="flux equilibrium type ">eq_vars.eq_1_type</a>) that only depend on the flux coordinates, such as the pressure \(p\), the safety factor \(q\), etc.</li>
<li>On the other hand, they consist of metric equilibrium quantities (stored in a <a class="el" href="structeq__vars_1_1eq__2__type.html" title="metric equilibrium type ">eq_vars.eq_2_type</a>) that depend on the angular position as well, such as the metric quantities of the grid \(g_{ij} = \vec{e}_i \cdot \vec{e}_j\) and \(h_{ij} = \nabla u^i \cdot \nabla u^j\), as well as derived quantities such as the parallel current \(\sigma = \frac{\vec{B}\cdot\vec{J}}{B^2}\), etc. <a class="el" href="citelist.html#CITEREF_weyens2014theory">[15]</a></li>
</ul>
<p>The <b>perturbation driver</b> uses both types of equation variables to calculate perturbation quantites. Again, there are two types.</p><ul>
<li>The first type of variables are the vectorial perturbation quantities (stored in a <a class="el" href="structx__vars_1_1x__1__type.html" title="vectorial perturbation type ">x_vars.x_1_type</a>), which contains the geodesic component of the perturbation \(U = \frac{\nabla \times \vec{B}}{\left|\nabla \psi\right|^2} \cdot \vec{\xi}\) where \(\vec{\xi}\) is the perturbation. Also the parallel derivatives of these quantities are calculated.</li>
<li>The other type re the tensorial perturbation quantities (stored in a <a class="el" href="structx__vars_1_1x__2__type.html" title="tensorial perturbation type ">x_vars.x_2_type</a>), and it combines the vectorial perturbation quantities with the equilibrium quantities to form the tensorial quantities \(\widetilde{PV}_{k,m}^i\) and \(\widetilde{KV}_{k,m}^i\) that represent the perturbed potential energy as well as the kinetic energy of the perturbation <a class="el" href="citelist.html#CITEREF_weyens2014theory">[15]</a>.</li>
</ul>
<p>These are also complemented by \(\delta_{k,m}^\text{vac}\), the vacuum contribution to the perturbed potential energy (<a class="el" href="page_overview.html#fng1">1</a>).</p>
<p>After integrating them along the magnetic field lines, these magnetic integrals form the building blocks of the discretized matrices \(\overline{\text{A}}\) and \(\overline{\text{B}}\) in the generalized system of eigenvalue equations \(\overline{\text{A}} \vec{X} = \lambda \overline{\text{B}}\vec{X}\).</p>
<p>These matrices are set up in the <b>solution driver</b>, which currently works with the SLEPc library that is build on the PETSc library for sparse linear algebra. After solution, the eigenvalues and -vectors are stored appropriately.</p>
<p>Finally, it is checked whether another Richardson level should be attempted or not in <b>Richardson converged?</b>, and if so, the number of parallel grid points is doubled.</p>
<h1><a class="anchor" id="overview_jobs"></a>
Equilibrium &amp; Perturbation Jobs</h1>
<p>The general code structure explained in <a class="el" href="page_overview.html#overview_PB3D_flowchart">PB3D flowchart</a> basically comes down to setting up the matrices to be solved for the eigenvalues and eigenvectors. In general, the dimensions of these variables are too large (see the grids in <a class="el" href="page_overview.html#detail_PB3D">Detailed PB3D Flowchart</a>) for them to fit in memory. A structure of two nested loops is therefore employed in PB3D, called <b>jobs</b>, to keep the memory requirements under a user-defined maximum (see <code>max_tot_mem</code> in <a class="el" href="page_inputs.html">Input variables</a>).</p>
<h2><a class="anchor" id="overview_jobs_X"></a>
Perturbation jobs</h2>
<p><b>perturbation jobs</b> are used to divided the calculation of the tensorial perturbation quantities, which come in pairs of mode numbers. These combinations are blocked, where each block fits in memory. These blocks are the perturbation jobs.</p>
<p>They form the inner loop.</p>
<dl class="section see"><dt>See also</dt><dd>See <a class="el" href="namespacex__ops.html#a677c88d85fe1bfbf3579a2421ce16f2f" title="Divides the perturbation jobs. ">divide_x_jobs()</a>.</dd></dl>
<h2><a class="anchor" id="overview_jobs_eq"></a>
Equilibrium jobs</h2>
<p>As a result the memory still needs to hold all the relevant equilibrium and vectorial perturbation quantities necessary for the individual perturbation jobs during the whole time these jobs are being calculated. <b>equilibrium jobs</b> are therefore employed in an outer loop to divide these equilibrium and vectorial perturbation quantities in manageable chunks.</p>
<p>To be more precise, the parallel range over which variables are to be integrated in the magnetic integrals (see <a class="el" href="page_overview.html#detail_PB3D">Detailed PB3D Flowchart</a>), is cut in pieces. The advantage here is that only the results from the sub-integrals have to be saved and updated, not the function values themselves.</p>
<dl class="section see"><dt>See also</dt><dd>See <a class="el" href="namespaceeq__ops.html#a8fae749abe55865d8135fef536a8e8f1" title="Divides the equilibrium jobs. ">divide_eq_jobs()</a>.</dd></dl>
<h1><a class="anchor" id="detail_PB3D"></a>
Detailed PB3D Flowchart</h1>
<p>The different blocks if figure <a class="el" href="page_overview.html#flowchart_fig">1</a> are expanded in table <a class="el" href="page_overview.html#flowchart_PB3D_tab">1</a>. The cells that are typeset in <span style="color:LightBlue">light blue</span> are only performed for the first equilibrium job of either the restart Richardson level, or the first Richardson level if this is not provided. </p><a class="anchor" id="flowchart_PB3D_tab"></a>
<table class="doxtable">
<caption>Table 1. detailed PB3D flowchart</caption>
<tr>
<th width="10%">variable type </th><th width="45%">VMEC (<code>eq_style = 1</code>) </th><th width="45%">HELENA (<code>eq_style = 2</code>)   </th></tr>
<tr>
<td rowspan="1" bgcolor="LightGray"><b> PB3D initialize </b></td><td colspan="2">the PB3D structure is set up, such as the MPI communicator, etc.   </td></tr>
<tr>
<td rowspan="8" bgcolor="LightGray"><b> input driver </b></td><td colspan="2">The arguments are parsed (see <a class="el" href="namespacefiles__ops.html#a051584112f6e4f6e60b0ef824dffbf5e" title="Parses the command line arguments. ">parse_args()</a>)   </td></tr>
<tr>
<td colspan="2">The input files are opened (see <a class="el" href="namespacefiles__ops.html#a63a81a5a451f787025429878b2cec81b" title="Open the input files. ">open_input()</a> and <a class="el" href="page_inputs.html">Input variables</a>)   </td></tr>
<tr>
<td colspan="2">The user inputs are processed (see <a class="el" href="namespaceinput__ops.html#a434acca4f59f9dc1d91e04f846133684" title="Reads input options from user-provided input file. ">read_input_opts()</a>)   </td></tr>
<tr>
<td colspan="2">The equilibrium code output is read and converted to the internal PB3D format (see <a class="el" href="namespaceinput__ops.html#a577c897cc266961eb40bb5ef747fa077" title="Reads the equilibrium input file if no Richardson restart. ">read_input_eq()</a>)   </td></tr>
<tr>
<td colspan="2">Normalization constants are calculated (see <a class="el" href="namespaceeq__ops.html#a7cd38586e386e1bc684a327ebcc4c1de" title="Sets up normalization constants. ">calc_normalization_const()</a>) and the input is normalized (see <a class="el" href="namespaceeq__ops.html#a1b4c764da73624722d7e76498a2b80a9" title="Normalize input quantities. ">normalize_input()</a>)   </td></tr>
<tr>
<td colspan="2">Output files are opened (see <a class="el" href="namespacefiles__ops.html#ad681a9e8083a6f664cf0f9d17ebe279c" title="Open the output files. ">open_output()</a> and <a class="el" href="page_outputs.html">Code outputs</a>)   </td></tr>
<tr>
<td colspan="2">Input variables are written to HDF5 output (see <a class="el" href="namespaceinput__ops.html#a6a1237ee3005ebd6f4978e7092ab2dc5" title="Print input quantities to an output file. ">print_output_in()</a>)  </td></tr>
<tr>
<td colspan="2">Some other variables are broadcasted directly to all the processes using MPI (see <a class="el" href="namespacempi__ops.html#a932eba1c998dd7a0f1191b55cd754be3" title="Broadcasts options (e.g. user-prescribed) that are not passed through the HDF5 output file (i...">broadcast_input_opts()</a>)   </td></tr>
<tr>
<td rowspan="14" bgcolor="LightGray"><b> equilibrium driver </b> </td><td>normal part of equilibrium grid is set up, as for the angular part, the field-lines are necessary which are not yet calculated  </td><td>the equilibrium grid is set up equal to the HELENA output grid   </td></tr>
<tr>
<td colspan="2">flux equilibrium quantities (see <a class="el" href="structeq__vars_1_1eq__1__type.html" title="flux equilibrium type ">eq_vars.eq_1_type</a>) are calculated (see <a class="el" href="interfaceeq__ops_1_1calc__eq.html" title="Calculate the equilibrium quantities on a grid determined by straight field lines. ">eq_ops.calc_eq()</a>)   </td></tr>
<tr>
<td colspan="2" bgcolor="LightBlue">flux equilibrium quantities are written to HDF5 output (see <a class="el" href="interfaceeq__ops_1_1print__output__eq.html" title="Print equilibrium quantities to an output file: ">eq_ops.print_output_eq()</a>)   </td></tr>
<tr>
<td>equilibrium grid is completed by tracing the field lines (see <a class="el" href="namespacegrid__ops.html#a06107dbdfd1dd62e372cc29ab0255bad" title="Calculate equilibrium grid that follows magnetic field lines. ">calc_ang_grid_eq_b()</a>)  </td><td>an additional, field-aligned equilibrium grid is set up by tracing the field lines (see <a class="el" href="namespacegrid__ops.html#ad16495ddd320562451c2325bafecf2d8" title="Sets up the field-aligned equilibrium grid. ">setup_grid_eq_b()</a>), and it is written to HDF5 output (see <a class="el" href="namespacegrid__ops.html#a4827e794d37334c0cad9bb2016e64d46" title="Print grid variables to an output file. ">print_output_grid()</a>)   </td></tr>
<tr>
<td>the equilibrium grid is written to output  </td><td bgcolor="LightBlue">the equilibrium grid is written to the output  </td></tr>
<tr>
<td>the metric equilibrium variables (see <a class="el" href="structeq__vars_1_1eq__2__type.html" title="metric equilibrium type ">eq_vars.eq_2_type</a>) are calculated (see <a class="el" href="interfaceeq__ops_1_1calc__eq.html" title="Calculate the equilibrium quantities on a grid determined by straight field lines. ">eq_ops.calc_eq()</a>)  </td><td bgcolor="LightBlue">the metric equilibrium variables (see <a class="el" href="structeq__vars_1_1eq__2__type.html" title="metric equilibrium type ">eq_vars.eq_2_type</a>) are calculated (see <a class="el" href="interfaceeq__ops_1_1calc__eq.html" title="Calculate the equilibrium quantities on a grid determined by straight field lines. ">eq_ops.calc_eq()</a>)  </td></tr>
<tr>
<td></td><td bgcolor="LightBlue">the metric equilibrium variables are written to the output (see <a class="el" href="interfaceeq__ops_1_1print__output__eq.html" title="Print equilibrium quantities to an output file: ">eq_ops.print_output_eq()</a>)  </td></tr>
<tr>
<td>store equilibrium quantities necessary for vacuum calculation (see <a class="el" href="namespacevac__ops.html#a37220702fbf378626a0f2c12f446e0aa" title="Stores calculation of the vacuum response by storing the necessary variables. ">store_vac()</a>)  </td><td bgcolor="LightBlue">store equilibrium quantities necessary for vacuum calculation (see <a class="el" href="namespacevac__ops.html#a37220702fbf378626a0f2c12f446e0aa" title="Stores calculation of the vacuum response by storing the necessary variables. ">store_vac()</a>)   </td></tr>
<tr>
<td>possible plot of magnetic field, current density and/or curvature in (field-aligned) equilibrium grid (see <a class="el" href="namespaceeq__ops.html#a73a8c3cea1e8a636b4978bc626e0fab0" title="Plots the magnetic fields. ">b_plot()</a>, <a class="el" href="namespaceeq__ops.html#afabdf28e5c26ceb87e6eb8cf3809919d" title="Plots the current. ">j_plot()</a>, <a class="el" href="namespaceeq__ops.html#ad173efd111cb85c11bc2bc78a7555096" title="Plots the curvature. ">kappa_plot()</a>)  </td><td bgcolor="LightBlue">possible plot of magnetic field, current density and/or curvature in (HELENA) equilibrium grid (see <a class="el" href="namespaceeq__ops.html#a73a8c3cea1e8a636b4978bc626e0fab0" title="Plots the magnetic fields. ">b_plot()</a>, <a class="el" href="namespaceeq__ops.html#afabdf28e5c26ceb87e6eb8cf3809919d" title="Plots the current. ">j_plot()</a>, <a class="el" href="namespaceeq__ops.html#ad173efd111cb85c11bc2bc78a7555096" title="Plots the curvature. ">kappa_plot()</a>)  </td></tr>
<tr>
<td>redistribute the equilibrium grid (see <a class="el" href="namespacegrid__ops.html#ab10ef5b486ee3861df2da4e53bc22630" title="Redistribute a grid to match the normal distribution of solution grid. ">redistribute_output_grid()</a>)  </td><td bgcolor="LightBlue">redistribute the equilibrium grid (see <a class="el" href="namespacegrid__ops.html#ab10ef5b486ee3861df2da4e53bc22630" title="Redistribute a grid to match the normal distribution of solution grid. ">redistribute_output_grid()</a>)  </td></tr>
<tr>
<td colspan="2" bgcolor="LightBlue">redistribute the flux equilibrium quantities (see <a class="el" href="interfaceeq__ops_1_1redistribute__output__eq.html" title="Redistribute the equilibrium variables, but only the Flux variables are saved. ">eq_ops.redistribute_output_eq()</a>)   </td></tr>
<tr>
<td>redistribute the metric equilibrium quantities (see <a class="el" href="interfaceeq__ops_1_1redistribute__output__eq.html" title="Redistribute the equilibrium variables, but only the Flux variables are saved. ">eq_ops.redistribute_output_eq()</a>)  </td><td bgcolor="LightBlue">redistribute the metric equilibrium quantities (see <a class="el" href="interfaceeq__ops_1_1redistribute__output__eq.html" title="Redistribute the equilibrium variables, but only the Flux variables are saved. ">eq_ops.redistribute_output_eq()</a>)   </td></tr>
<tr>
<td></td><td>The field-aligned equilibrium grid is redistributed (see <a class="el" href="namespacegrid__ops.html#ab10ef5b486ee3861df2da4e53bc22630" title="Redistribute a grid to match the normal distribution of solution grid. ">redistribute_output_grid()</a>)   </td></tr>
<tr>
<td colspan="2">possible plot of magnetic field lines in flux surfaces (see <a class="el" href="namespacegrid__ops.html#addd76b7b3be0b51e0863ae0cdfef41e6" title="Plots the grid in real 3-D space. ">magn_grid_plot()</a>) if last equilibrium job   </td></tr>
<tr>
<td rowspan="11" bgcolor="LightGray"><b> perturbation driver </b></td><td></td><td>the metric equilibrium quantities are inerpolated in the field-aligned equilibrium grid (see <a class="el" href="namespacehelena__ops.html#a7796861de18ae7ac9c3aa07a8628be38" title="Interpolate variables resulting from HELENA equilibria to another grid (angularly). ">interp_hel_on_grid()</a>)   </td></tr>
<tr>
<td>determine perturbation grid (see <a class="el" href="namespacegrid__ops.html#a1047889ec84da6e56aae619570a16988" title="Sets up the general perturbation grid, in which the perturbation variables are calculated. ">setup_grid_x()</a>) and write it to HDF5 ouput (see <a class="el" href="namespacegrid__ops.html#a4827e794d37334c0cad9bb2016e64d46" title="Print grid variables to an output file. ">print_output_grid()</a>)  </td><td bgcolor="LightBlue">determine perturbation grid (see <a class="el" href="namespacegrid__ops.html#a1047889ec84da6e56aae619570a16988" title="Sets up the general perturbation grid, in which the perturbation variables are calculated. ">setup_grid_x()</a>) and write it to HDF5 ouput (see <a class="el" href="namespacegrid__ops.html#a4827e794d37334c0cad9bb2016e64d46" title="Print grid variables to an output file. ">print_output_grid()</a>)   </td></tr>
<tr>
<td></td><td>set up field-aligned perturbation grid and write to output  </td></tr>
<tr>
<td colspan="2" bgcolor="LightBlue">set up mode number information (see setup_nm_x()) and check them (see <a class="el" href="namespacex__ops.html#a7d9275e2d927d92548416f21b983b604" title="Checks whether the high-n approximation is valid: ">check_x_modes()</a>) if first perturbation job  </td></tr>
<tr>
<td colspan="2" bgcolor="LightBlue">possibly plot resonance (see <a class="el" href="namespacex__ops.html#abdaf1308e13cede3a153e8c6cf35a637" title="plot -profile or -profile in flux coordinates with  or  indicated if requested. ">resonance_plot()</a>) if first perturbation job  </td></tr>
<tr>
<td>the vectorial perturbation variables (see <a class="el" href="structx__vars_1_1x__1__type.html" title="vectorial perturbation type ">x_vars.x_1_type</a>) are calculated (see <a class="el" href="interfacex__ops_1_1calc__x.html" title="Calculates either vectorial or tensorial perturbation variables. ">x_ops.calc_x()</a>)  </td><td bgcolor="LightBlue">the vectorial perturbation variables (see <a class="el" href="structx__vars_1_1x__1__type.html" title="vectorial perturbation type ">x_vars.x_1_type</a>) are calculated (see <a class="el" href="interfacex__ops_1_1calc__x.html" title="Calculates either vectorial or tensorial perturbation variables. ">x_ops.calc_x()</a>)   </td></tr>
<tr>
<td></td><td>write vectorial perturbation variables to output (see <a class="el" href="interfacex__ops_1_1print__output__x.html" title="Print either vectorial or tensorial perturbation quantities of a certain order to an output file...">x_ops.print_output_x()</a>)   </td></tr>
<tr>
<td></td><td>interpolate vectorial perturbation variables on field-aligned grid (see <a class="el" href="namespacehelena__ops.html#a7796861de18ae7ac9c3aa07a8628be38" title="Interpolate variables resulting from HELENA equilibria to another grid (angularly). ">interp_hel_on_grid()</a>)   </td></tr>
<tr>
<td colspan="2">calculate tensorial perturbation variables (see <a class="el" href="interfacex__ops_1_1calc__x.html" title="Calculates either vectorial or tensorial perturbation variables. ">x_ops.calc_x()</a>)   </td></tr>
<tr>
<td colspan="2">calculate magnetic integrals (see <a class="el" href="namespacex__ops.html#a6df79622d1b95d54ab3e542751a5881d" title="Calculate the magnetic integrals from  and  in an equidistant grid where the step size can vary depen...">calc_magn_ints()</a>)   </td></tr>
<tr>
<td colspan="2">write magnetic integrals to output (see <a class="el" href="interfacex__ops_1_1print__output__x.html" title="Print either vectorial or tensorial perturbation quantities of a certain order to an output file...">x_ops.print_output_x()</a>)   </td></tr>
<tr>
<td rowspan="3" bgcolor="LightGray"><b> solution driver </b></td><td>calculate vacuum (see calc_vac())  </td><td bgcolor="LightBlue">calculate vacuum (see calc_vac())   </td></tr>
<tr>
<td colspan="2" bgcolor="LightBlue">set up the solution grid (see <a class="el" href="namespacegrid__ops.html#aeff1569cb9a043b03ed49250524fbd95" title="Sets up the general solution grid, in which the solution variables are calculated. ">setup_grid_sol()</a>) and write to HDF5 output (see <a class="el" href="namespacegrid__ops.html#a4827e794d37334c0cad9bb2016e64d46" title="Print grid variables to an output file. ">print_output_grid()</a>)   </td></tr>
<tr>
<td colspan="2">solve system of equations (see <a class="el" href="namespaceslepc__ops.html#a79c420987056c225931b51c8d30ece1f" title="Solve the eigenvalue system using SLEPC. ">solve_ev_system_slepc()</a>)   </td></tr>
<tr>
<td rowspan="1" bgcolor="LightGray"><b> Richardson converged? </b></td><td colspan="2">check for convergence of Richardson levels by comparing solution eigenvalues (see <a class="el" href="namespacerich__ops.html#ac00cce686d45540b238b3b6e39c9bdeb" title="Decides whether convergence has been reached for the Richardson extrapolation. ">check_conv()</a>)   </td></tr>
<tr>
<td rowspan="1" bgcolor="LightGray"><b> PB3D finalize </b></td><td colspan="2">clean up   </td></tr>
</table>
<h1><a class="anchor" id="overview_POST"></a>
POST Overview</h1>
<p>The POST program for post-processing of PB3D results consists of just one driver.</p><ul>
<li>In the first part, everything is set up (see <a class="el" href="namespacedriver__post.html#af527706d4e696d4e507443d2f74194ef" title="Initializes the POST driver. ">init_post()</a>):<ul>
<li>This includes initializing the variables written to HDF5 in PB3D.</li>
<li>Furthermore, the output grids are created</li>
<li>Also, 1-D flux plots are produced, which are part of the plots that PB3D is able to produce (see <code>plot_flux_q</code>, <code>plot_resonance</code> and <code>plot_magn_grid</code> in table <a class="el" href="page_outputs.html#output_plots_tab">3</a> in <a class="el" href="page_outputs.html">Code outputs</a>) can be created here.</li>
</ul>
</li>
<li>After that, new outputs are calculated and plot (see <a class="el" href="namespacedriver__post.html#a33b3c6f9018a0ddc92dce77394b8ab37" title="The main driver routine for postprocessing. ">run_driver_post()</a>):<ul>
<li>Quantities are calculated on the output grids.</li>
<li>Using these, plots are first produced that do not depend on the solution vector from PB3D, and are also part of the plots that PB3D is able to produce (see <code>plot_B</code>, <code>plot_J</code>, <code>plot_kappa</code> in table <a class="el" href="page_outputs.html#output_plots_tab">3</a> in <a class="el" href="page_outputs.html">Code outputs</a>).</li>
<li>Finally, other plots are produced that do depend on these (see <code>plot_sol_xi</code>, <code>plot_sol_Q</code>, <code>plot_E_rec</code> in table <a class="el" href="page_outputs.html#output_plots_tab">3</a> in <a class="el" href="page_outputs.html">Code outputs</a>).</li>
</ul>
</li>
</ul>
<p>POST also knows the concept of equilibrium jobs, but not that of perturbation jobs (see <a class="el" href="page_overview.html#overview_jobs">Equilibrium &amp; Perturbation Jobs</a>). This is necessary for larger outputs that quickly overflow memory. The HDF5 output files are updated at every equilibrium job, but, with reasonable safety, they can already be looked at in a visualizer.</p>
<dl class="section note"><dt>Note</dt><dd><ol type="1">
<li><a class="anchor" id="fng1"></a>This is not yet implemented. </li>
</ol>
</dd></dl>
</div></div><!-- contents -->
<!-- HTML footer for doxygen 1.8.13-->
<!-- start footer part -->
<address class="footer"><small>
<center>this documentation was created with <a href="http://www.doxygen.org/index.html">Doxygen 1.8.13</a> by <a href="mailto:weyenst@gmail.com">Toon Weyens</a></center>
</small></address>
</body>
</html>
