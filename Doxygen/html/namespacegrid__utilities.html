<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.16.1"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>PB3D: grid_utilities Module Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="clipboard.js"></script>
<script type="text/javascript" src="cookie.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  extensions: ["tex2jax.js", "TeX/AMSmath.js", "TeX/AMSsymbols.js"],
  jax: ["input/TeX","output/HTML-CSS"],
});
</script>
<script type="text/javascript" async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.2/MathJax.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="customdoxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">PB3D<span id="projectnumber">&#160;[2.47]</span>
   </div>
   <div id="projectbrief">Ideal linear high-n MHD stability in 3-D</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.16.1 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search/",'.html');
</script>
<script type="text/javascript">
$(function() { codefold.init(); });
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search',false);
  $(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

</div><!-- top -->
<div id="doc-content">
<div class="header">
  <div class="summary">
<a href="#nested-classes">Interfaces and Types</a> &#124;
<a href="#func-members">Functions/Subroutines</a> &#124;
<a href="#var-members">Variables</a>  </div>
  <div class="headertitle"><div class="title">grid_utilities Module Reference</div></div>
</div><!--header-->
<div class="contents">

<p>Numerical utilities related to the grids and different coordinate systems.  
<a href="#details">More...</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 id="header-nested-classes" class="groupheader"><a id="nested-classes" name="nested-classes"></a>
Interfaces and Types</h2></td></tr>
<tr class="memitem:coord_5Ff2e" id="r_coord_5Ff2e"><td class="memItemLeft">interface &#160;</td><td class="memItemRight"><a class="el" href="interfacegrid__utilities_1_1coord__f2e.html">coord_f2e</a></td></tr>
<tr class="memdesc:"><td class="mdescLeft">&#160;</td><td class="mdescRight">Converts Flux coordinates \(\left(r,\theta,\zeta\right)_\text{F}\) to Equilibrium coordinates \(\left(r,\theta,\zeta\right)_\text{E}\).  <a href="interfacegrid__utilities_1_1coord__f2e.html#details">More...</a><br /></td></tr>
<tr class="memitem:coord_5Fe2f" id="r_coord_5Fe2f"><td class="memItemLeft">interface &#160;</td><td class="memItemRight"><a class="el" href="interfacegrid__utilities_1_1coord__e2f.html">coord_e2f</a></td></tr>
<tr class="memdesc:"><td class="mdescLeft">&#160;</td><td class="mdescRight">Converts Equilibrium coordinates \(\left(r,\theta,\zeta\right)_\text{E}\). to Flux coordinates \(\left(r,\theta,\zeta\right)_\text{F}\).  <a href="interfacegrid__utilities_1_1coord__e2f.html#details">More...</a><br /></td></tr>
<tr class="memitem:calc_5Feqd_5Fgrid" id="r_calc_5Feqd_5Fgrid"><td class="memItemLeft">interface &#160;</td><td class="memItemRight"><a class="el" href="interfacegrid__utilities_1_1calc__eqd__grid.html">calc_eqd_grid</a></td></tr>
<tr class="memdesc:"><td class="mdescLeft">&#160;</td><td class="mdescRight">Calculate grid of equidistant points, where optionally the last point can be excluded.  <a href="interfacegrid__utilities_1_1calc__eqd__grid.html#details">More...</a><br /></td></tr>
<tr class="memitem:calc_5Ftor_5Fdiff" id="r_calc_5Ftor_5Fdiff"><td class="memItemLeft">interface &#160;</td><td class="memItemRight"><a class="el" href="interfacegrid__utilities_1_1calc__tor__diff.html">calc_tor_diff</a></td></tr>
<tr class="memdesc:"><td class="mdescLeft">&#160;</td><td class="mdescRight">Calculates the toroidal difference for a magnitude calculated on three toroidal points: two extremities and one in the middle.  <a href="interfacegrid__utilities_1_1calc__tor__diff.html#details">More...</a><br /></td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 id="header-func-members" class="groupheader"><a id="func-members" name="func-members"></a>
Functions/Subroutines</h2></td></tr>
<tr class="memitem:a904387b563db02ccf082e549730fd89b" id="r_a904387b563db02ccf082e549730fd89b"><td class="memItemLeft">integer function, public&#160;</td><td class="memItemRight"><a class="el" href="#a904387b563db02ccf082e549730fd89b">calc_xyz_grid</a> (grid_eq, grid_xyz, x, y, z, l, r)</td></tr>
<tr class="memdesc:a904387b563db02ccf082e549730fd89b"><td class="mdescLeft">&#160;</td><td class="mdescRight">Calculates \(X\), \(Y\) and \(Z\) on a grid <code>grid_XYZ</code>, determined through its E(quilibrium) coordinates.  <br /></td></tr>
<tr class="memitem:a414a1a11924bc935afca3a89fc31f2f5" id="r_a414a1a11924bc935afca3a89fc31f2f5"><td class="memItemLeft">integer function, public&#160;</td><td class="memItemRight"><a class="el" href="#a414a1a11924bc935afca3a89fc31f2f5">extend_grid_f</a> (grid_in, grid_ext, grid_eq, n_theta_plot, n_zeta_plot, lim_theta_plot, lim_zeta_plot)</td></tr>
<tr class="memdesc:a414a1a11924bc935afca3a89fc31f2f5"><td class="mdescLeft">&#160;</td><td class="mdescRight">Extend a grid angularly.  <br /></td></tr>
<tr class="memitem:a95c875f5ded5852b27f73141c74a0ef6" id="r_a95c875f5ded5852b27f73141c74a0ef6"><td class="memItemLeft">integer function, public&#160;</td><td class="memItemRight"><a class="el" href="#a95c875f5ded5852b27f73141c74a0ef6">copy_grid</a> (grid_a, grid_b, lims_b, i_lim)</td></tr>
<tr class="memdesc:a95c875f5ded5852b27f73141c74a0ef6"><td class="mdescLeft">&#160;</td><td class="mdescRight">Copy a grid A to a new grid B, that was not yet initialized.  <br /></td></tr>
<tr class="memitem:af08c7fe5a537be1a8fa3eba462c77e7e" id="r_af08c7fe5a537be1a8fa3eba462c77e7e"><td class="memItemLeft">integer function, public&#160;</td><td class="memItemRight"><a class="el" href="#af08c7fe5a537be1a8fa3eba462c77e7e">calc_int_vol</a> (ang_1, ang_2, norm, j, f, f_int)</td></tr>
<tr class="memdesc:af08c7fe5a537be1a8fa3eba462c77e7e"><td class="mdescLeft">&#160;</td><td class="mdescRight">Calculates volume integral on a 3D grid.  <br /></td></tr>
<tr class="memitem:a67001ff9bbcad707aacf17f90a748d90" id="r_a67001ff9bbcad707aacf17f90a748d90"><td class="memItemLeft">integer function, public&#160;</td><td class="memItemRight"><a class="el" href="#a67001ff9bbcad707aacf17f90a748d90">trim_grid</a> (grid_in, grid_out, norm_id)</td></tr>
<tr class="memdesc:a67001ff9bbcad707aacf17f90a748d90"><td class="mdescLeft">&#160;</td><td class="mdescRight">Trim a grid, removing any overlap between the different regions.  <br /></td></tr>
<tr class="memitem:a4679f24af8e02793070f4e27b43e00b6" id="r_a4679f24af8e02793070f4e27b43e00b6"><td class="memItemLeft">integer function, public&#160;</td><td class="memItemRight"><a class="el" href="#a4679f24af8e02793070f4e27b43e00b6">untrim_grid</a> (grid_in, grid_out, size_ghost)</td></tr>
<tr class="memdesc:a4679f24af8e02793070f4e27b43e00b6"><td class="mdescLeft">&#160;</td><td class="mdescRight">Untrims a trimmed grid by introducing an asymmetric ghost regions at the right.  <br /></td></tr>
<tr class="memitem:ad5b259a284efcf05eb3fd5deaca19662" id="r_ad5b259a284efcf05eb3fd5deaca19662"><td class="memItemLeft">integer function, public&#160;</td><td class="memItemRight"><a class="el" href="#ad5b259a284efcf05eb3fd5deaca19662">calc_vec_comp</a> (grid, grid_eq, eq_1, eq_2, v_com, norm_disc_prec, v_mag, base_name, max_transf, v_flux_tor, v_flux_pol, xyz, compare_tor_pos)</td></tr>
<tr class="memdesc:ad5b259a284efcf05eb3fd5deaca19662"><td class="mdescLeft">&#160;</td><td class="mdescRight">Calculates contra- and covariant components of a vector in multiple coordinate systems.  <br /></td></tr>
<tr class="memitem:a8b3114d164cbf016c0c6bb1232e6314e" id="r_a8b3114d164cbf016c0c6bb1232e6314e"><td class="memItemLeft">integer function, public&#160;</td><td class="memItemRight"><a class="el" href="#a8b3114d164cbf016c0c6bb1232e6314e">calc_n_par_x_rich</a> (n_par_x_rich, only_half_grid)</td></tr>
<tr class="memdesc:a8b3114d164cbf016c0c6bb1232e6314e"><td class="mdescLeft">&#160;</td><td class="mdescRight">Calculates the local number of parallel grid points for this Richardson level, taking into account that it ould be half the actual number.  <br /></td></tr>
<tr class="memitem:ae8cbf5a9167339a1f5a2ba07a03d20e2" id="r_ae8cbf5a9167339a1f5a2ba07a03d20e2"><td class="memItemLeft">integer function, public&#160;</td><td class="memItemRight"><a class="el" href="#ae8cbf5a9167339a1f5a2ba07a03d20e2">nufft</a> (x, f, f_f, plot_name)</td></tr>
<tr class="memdesc:ae8cbf5a9167339a1f5a2ba07a03d20e2"><td class="mdescLeft">&#160;</td><td class="mdescRight">calculates the cosine and sine mode numbers of a function defined on a non-regular grid.  <br /></td></tr>
<tr class="memitem:a169b137ec246579a2fa94fa4612104d1" id="r_a169b137ec246579a2fa94fa4612104d1"><td class="memItemLeft">subroutine, public&#160;</td><td class="memItemRight"><a class="el" href="#a169b137ec246579a2fa94fa4612104d1">find_compr_range</a> (r_f, lim_r, lim_id)</td></tr>
<tr class="memdesc:a169b137ec246579a2fa94fa4612104d1"><td class="mdescLeft">&#160;</td><td class="mdescRight">finds smallest range that comprises a minimum and maximum value.  <br /></td></tr>
<tr class="memitem:affe51bbe076dd311eb565873be815407" id="r_affe51bbe076dd311eb565873be815407"><td class="memItemLeft">integer function, public&#160;</td><td class="memItemRight"><a class="el" href="#affe51bbe076dd311eb565873be815407">calc_arc_angle</a> (grid, eq_1, eq_2, arc, use_e)</td></tr>
<tr class="memdesc:affe51bbe076dd311eb565873be815407"><td class="mdescLeft">&#160;</td><td class="mdescRight">Calculate arclength angle.  <br /></td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 id="header-var-members" class="groupheader"><a id="var-members" name="var-members"></a>
Variables</h2></td></tr>
<tr class="memitem:a0743c0341d508034b14aee614fa4f8a9" id="r_a0743c0341d508034b14aee614fa4f8a9"><td class="memItemLeft">logical, public&#160;</td><td class="memItemRight"><a class="el" href="#a0743c0341d508034b14aee614fa4f8a9">debug_calc_int_vol</a> = .false.</td></tr>
<tr class="memdesc:a0743c0341d508034b14aee614fa4f8a9"><td class="mdescLeft">&#160;</td><td class="mdescRight">plot debug information for <a class="el" href="#af08c7fe5a537be1a8fa3eba462c77e7e" title="Calculates volume integral on a 3D grid.">calc_int_vol()</a>  <br /></td></tr>
<tr class="memitem:ab420036236dc8a9a69e180550499d95b" id="r_ab420036236dc8a9a69e180550499d95b"><td class="memItemLeft">logical, public&#160;</td><td class="memItemRight"><a class="el" href="#ab420036236dc8a9a69e180550499d95b">debug_calc_vec_comp</a> = .false.</td></tr>
<tr class="memdesc:ab420036236dc8a9a69e180550499d95b"><td class="mdescLeft">&#160;</td><td class="mdescRight">plot debug information for <a class="el" href="#ad5b259a284efcf05eb3fd5deaca19662" title="Calculates contra- and covariant components of a vector in multiple coordinate systems.">calc_vec_comp()</a>  <br /></td></tr>
</table>
<a name="details" id="details"></a><h2 id="header-details" class="groupheader">Detailed Description</h2>
<div class="textblock"><p>Numerical utilities related to the grids and different coordinate systems. </p>
</div><a name="doc-func-members" id="doc-func-members"></a><h2 id="header-doc-func-members" class="groupheader">Function/Subroutine Documentation</h2>
<a id="affe51bbe076dd311eb565873be815407" name="affe51bbe076dd311eb565873be815407"></a>
<h2 class="memtitle"><span class="permalink"><a href="#affe51bbe076dd311eb565873be815407">&#9670;&#160;</a></span>calc_arc_angle()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">integer function, public grid_utilities::calc_arc_angle </td>
          <td>(</td>
          <td class="paramtype">type(<a class="el" href="structgrid__vars_1_1grid__type.html">grid_type</a>), intent(in)</td>          <td class="paramname"><span class="paramname"><em>grid</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">type(<a class="el" href="structeq__vars_1_1eq__1__type.html">eq_1_type</a>), intent(in)</td>          <td class="paramname"><span class="paramname"><em>eq_1</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">type(<a class="el" href="structeq__vars_1_1eq__2__type.html">eq_2_type</a>), intent(in)</td>          <td class="paramname"><span class="paramname"><em>eq_2</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real(dp), dimension(:,:,:), intent(inout), allocatable</td>          <td class="paramname"><span class="paramname"><em>arc</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">logical, intent(in), optional</td>          <td class="paramname"><span class="paramname"><em>use_e</em></span>&#160;)</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Calculate arclength angle. </p>
<p>This angle is based on the calculation of the arclength from the start of the grid, and then normalizing it from \(\min(\gamma)\ldots\max(\gamma)\), where \(\gamma\) is the parallel angle.</p>
<p>By default, the Flux variables are used, but this can be changed with <code>use_E</code>.</p>
<dl class="section note"><dt>Note</dt><dd>For field-aligned grids the projection is taken on the poloidal cross-section. For non-axisymmetric equilibria, this makes little sense.</dd></dl>
<dl class="section return"><dt>Returns</dt><dd>ierr </dd></dl>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">grid</td><td>equilibrium grid </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">eq_1</td><td>flux equilibrium variables </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">eq_2</td><td>metric equilibrium variables </td></tr>
    <tr><td class="paramdir">[in,out]</td><td class="paramname">arc</td><td>arclength angle </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">use_e</td><td>use E variables instead of F </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="grid__utilities_8f90_source.html#l03038">3038</a> of file <a class="el" href="grid__utilities_8f90_source.html">grid_utilities.f90</a>.</p>
<div id="dynsection-0" onclick="return dynsection.toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;"><span class="dynarrow"><span class="arrowhead closed"></span></span>Here is the call graph for this function:</div>
<div id="dynsection-0-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-0-content" class="dyncontent" style="display:none;">
<div class="center"><iframe scrolling="no" loading="lazy" frameborder="0" src="namespacegrid__utilities_affe51bbe076dd311eb565873be815407_cgraph.svg" width="390" height="71"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>

</div>
</div>
<a id="af08c7fe5a537be1a8fa3eba462c77e7e" name="af08c7fe5a537be1a8fa3eba462c77e7e"></a>
<h2 class="memtitle"><span class="permalink"><a href="#af08c7fe5a537be1a8fa3eba462c77e7e">&#9670;&#160;</a></span>calc_int_vol()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">integer function, public grid_utilities::calc_int_vol </td>
          <td>(</td>
          <td class="paramtype">real(dp), dimension(:,:,:), intent(in)</td>          <td class="paramname"><span class="paramname"><em>ang_1</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real(dp), dimension(:,:,:), intent(in)</td>          <td class="paramname"><span class="paramname"><em>ang_2</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real(dp), dimension(:), intent(in)</td>          <td class="paramname"><span class="paramname"><em>norm</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real(dp), dimension(:,:,:), intent(in)</td>          <td class="paramname"><span class="paramname"><em>j</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">complex(dp), dimension(:,:,:,:), intent(in)</td>          <td class="paramname"><span class="paramname"><em>f</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">complex(dp), dimension(:), intent(inout)</td>          <td class="paramname"><span class="paramname"><em>f_int</em></span>&#160;)</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Calculates volume integral on a 3D grid. </p>
<p>Two angular and one normal variable have to be provided on a the grid.</p>
<p>If the <span class="tt">i</span>'th dimension of the grid is equal to one, the function to be integrated is assumed not to vary in this dimension.</p>
<p>Furthermore, if <code>i</code> is 1 or 2, the corresponding <span class="tt">i</span>'th (angular) variable is the only variable that is assumed to vary in that dimension. The other angular variable as well as the normal variable are assumed to be constant like the function itself, resulting in a factor \(2 \pi\). However, if <code>i</code> is 3, an error is displayed as this does not represent a physical situation.</p>
<p>A common case through which to understand this is the axisymmetric case where the first angular variable \(\theta\) varies in the dimensions 1 and 3, the second angular variable \(\zeta\) varies only in the dimension 2, and the normal variable only varies in the dimension 3.</p>
<p>Alternatively, there is the case of a grid-aligned set of coordinates \(\theta\) and \(\alpha\), where the first dimension corresponds to the direction along the magnetic field line, the second to the geodesical direction and the third to the normal direction. If the calculations for different field lines are decoupled, the variation in the second dimension is not taken into account and no integration happens along it.</p>
<p>Internally, the angular variables and the normal variable are related to the coordinates \(\left(x,y,z\right)\) that correspond to the three dimensions. They thus form a computational orthogonal grid to which the original coordinates are related through the transformation of Jacobians:      </p><p class="formulaDsp">
\[\mathcal{J}_{xyz} = \mathcal{J}_\text{F}
             \frac{\partial r_\text{F}}{\partial z}
             \left(\frac{\partial \gamma_1}{\partial x}
             \frac{\gamma_2}{\partial y}-
             \frac{\partial \gamma_1}{\partial y}
             \frac{\gamma_2}{\partial x}\right) , \]
</p>
<p> where \(\gamma_1\) and \(\gamma_2\) are <code>ang_1</code> and <code>ang_2</code>, so that the integral becomes       </p><p class="formulaDsp">
\[ \sum_{x,y,z} \left[ f\left(x,y,z\right) \mathcal{J}_\text{F}
             \frac{\partial r_\text{F}}{\partial z}
             \left(\frac{\partial \gamma_1}{\partial x}
             \frac{\gamma_2}{\partial y}-
             \frac{\partial \gamma_1}{\partial y}
             \frac{\gamma_2}{\partial x}\right)
             \Delta_x \Delta_y \Delta_z \right] \]
</p>
<p> where \(\Delta_x\), \(\Delta_y\) and \(\Delta_z\) are all trivially equal to 1.</p>
<p>The integrand has to be evaluated at the intermediate positions inside the cells. This is done by taking the average of the \(2^3=8\) points for <code>fj</code> = \(f  J_\text{F}\) as well as the transformation of the Jacobian to \(\left(x,y,z\right)\) coordinates.</p>
<dl class="section see"><dt>See also</dt><dd>See <a class="el" href="structgrid__vars_1_1grid__type.html" title="Type for grids.">grid_vars.grid_type</a> for a discussion on <code>ang_1</code> and <code>ang_2</code>.</dd></dl>
<dl class="section note"><dt>Note</dt><dd><ol type="1">
<li>if the coordinates are independent, this method is equivalent to the repeated numerical integration using the trapezoidal method, <b>NOT</b> Simpson's 3/8 rule!</li>
<li>by setting <code>debug_calc_int_vol</code>, this method can be compared to the trapezoidal and simple method for independent coordinates, again <b>NOT</b> for Simpson's 3/8 rule!</li>
<li>The Simpson's 3/8 rule could be developed but it is not of great importance.</li>
</ol>
</dd></dl>
<dl class="section return"><dt>Returns</dt><dd>ierr </dd></dl>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">ang_1</td><td>coordinate variable \(\gamma_1\) </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">ang_2</td><td>coordinate variable \(\gamma_2\) </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">norm</td><td>coordinate variable \(r_\text{F}\) </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">j</td><td>Jacobian </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">f</td><td>input f(n_par,n_geo,n_r,size_X^2) </td></tr>
    <tr><td class="paramdir">[in,out]</td><td class="paramname">f_int</td><td>output integrated f </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="grid__utilities_8f90_source.html#l01319">1319</a> of file <a class="el" href="grid__utilities_8f90_source.html">grid_utilities.f90</a>.</p>
<div id="dynsection-1" onclick="return dynsection.toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;"><span class="dynarrow"><span class="arrowhead closed"></span></span>Here is the call graph for this function:</div>
<div id="dynsection-1-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-1-content" class="dyncontent" style="display:none;">
<div class="center"><iframe scrolling="no" loading="lazy" frameborder="0" src="namespacegrid__utilities_af08c7fe5a537be1a8fa3eba462c77e7e_cgraph.svg" width="864" height="184"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
<div id="dynsection-2" onclick="return dynsection.toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;"><span class="dynarrow"><span class="arrowhead closed"></span></span>Here is the caller graph for this function:</div>
<div id="dynsection-2-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-2-content" class="dyncontent" style="display:none;">
<div class="center"><iframe scrolling="no" loading="lazy" frameborder="0" src="namespacegrid__utilities_af08c7fe5a537be1a8fa3eba462c77e7e_icgraph.svg" width="864" height="107"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>

</div>
</div>
<a id="a8b3114d164cbf016c0c6bb1232e6314e" name="a8b3114d164cbf016c0c6bb1232e6314e"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a8b3114d164cbf016c0c6bb1232e6314e">&#9670;&#160;</a></span>calc_n_par_x_rich()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">integer function, public grid_utilities::calc_n_par_x_rich </td>
          <td>(</td>
          <td class="paramtype">integer, intent(inout)</td>          <td class="paramname"><span class="paramname"><em>n_par_x_rich</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">logical, intent(in), optional</td>          <td class="paramname"><span class="paramname"><em>only_half_grid</em></span>&#160;)</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Calculates the local number of parallel grid points for this Richardson level, taking into account that it ould be half the actual number. </p>
<dl class="section see"><dt>See also</dt><dd>calc_ang_grid_eq_b().</dd></dl>
<dl class="section return"><dt>Returns</dt><dd>ierr </dd></dl>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in,out]</td><td class="paramname">n_par_x_rich</td><td>n_par_X for this Richardson level </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">only_half_grid</td><td>calculate only half grid with even points </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="grid__utilities_8f90_source.html#l02861">2861</a> of file <a class="el" href="grid__utilities_8f90_source.html">grid_utilities.f90</a>.</p>
<div id="dynsection-3" onclick="return dynsection.toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;"><span class="dynarrow"><span class="arrowhead closed"></span></span>Here is the caller graph for this function:</div>
<div id="dynsection-3-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-3-content" class="dyncontent" style="display:none;">
<div class="center"><iframe scrolling="no" loading="lazy" frameborder="0" src="namespacegrid__utilities_a8b3114d164cbf016c0c6bb1232e6314e_icgraph.svg" width="1102" height="108"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>

</div>
</div>
<a id="ad5b259a284efcf05eb3fd5deaca19662" name="ad5b259a284efcf05eb3fd5deaca19662"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ad5b259a284efcf05eb3fd5deaca19662">&#9670;&#160;</a></span>calc_vec_comp()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">integer function, public grid_utilities::calc_vec_comp </td>
          <td>(</td>
          <td class="paramtype">type(<a class="el" href="structgrid__vars_1_1grid__type.html">grid_type</a>), intent(in)</td>          <td class="paramname"><span class="paramname"><em>grid</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">type(<a class="el" href="structgrid__vars_1_1grid__type.html">grid_type</a>), intent(in)</td>          <td class="paramname"><span class="paramname"><em>grid_eq</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">type(<a class="el" href="structeq__vars_1_1eq__1__type.html">eq_1_type</a>), intent(in)</td>          <td class="paramname"><span class="paramname"><em>eq_1</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">type(<a class="el" href="structeq__vars_1_1eq__2__type.html">eq_2_type</a>), intent(in)</td>          <td class="paramname"><span class="paramname"><em>eq_2</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real(dp), dimension(:,:,:,:,:), intent(inout)</td>          <td class="paramname"><span class="paramname"><em>v_com</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">integer, intent(in)</td>          <td class="paramname"><span class="paramname"><em>norm_disc_prec</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real(dp), dimension(:,:,:), intent(inout), optional</td>          <td class="paramname"><span class="paramname"><em>v_mag</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">character(len=*), intent(in), optional</td>          <td class="paramname"><span class="paramname"><em>base_name</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">integer, intent(in), optional</td>          <td class="paramname"><span class="paramname"><em>max_transf</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real(dp), dimension(:,:), intent(inout), optional, allocatable</td>          <td class="paramname"><span class="paramname"><em>v_flux_tor</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real(dp), dimension(:,:), intent(inout), optional, allocatable</td>          <td class="paramname"><span class="paramname"><em>v_flux_pol</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real(dp), dimension(:,:,:,:), intent(in), optional</td>          <td class="paramname"><span class="paramname"><em>xyz</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">logical, intent(in), optional</td>          <td class="paramname"><span class="paramname"><em>compare_tor_pos</em></span>&#160;)</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Calculates contra- and covariant components of a vector in multiple coordinate systems. </p>
<p>Chain of coordinate systems considered:</p><ol type="1">
<li>Flux F: \((\alpha,\psi,\theta)\),</li>
<li>Magnetic M: \((\psi,\theta,\zeta)\),<ul>
<li>H: \((\psi,\theta,\phi)\) if HELENA is used,</li>
<li>V: \((r,\theta,\zeta)\) if VMEC is used,</li>
</ul>
</li>
<li>Cylindrical C: \((R,\varphi,Z)\),</li>
<li>Cartesian X: \((X,Y,Z)\), as well as the magnitude, starting from the input in Flux coordinates. Note that the Cartesian components in X, Y and Z can be used to plot the real vector and that covariant components should be equal to contravariant components in this coordinate system.</li>
</ol>
<p>Also, the fluxes can be calculated and plot by providing a <code>base_name</code>.</p>
<p>By default, the cartesian components are returned, but this can be indicated differently by providing <code>max_transf</code>.</p>
<dl class="section note"><dt>Note</dt><dd><ol type="1">
<li>Plots for different Richardson levels can be combined to show the total grid by just plotting them all individually and sequentially.</li>
<li>The metric factors and transformation matrices have to be allocated. They can be calculated using the routines from <a class="el" href="namespaceeq__ops.html" title="Operations on the equilibrium variables.">eq_ops</a>, for <span class="tt">deriv = [0,0,0]</span>.</li>
<li>For VMEC, the trigonometric factors of <code>grid_XYZ</code> must be calculated beforehand. Optionally, by providing <code>X</code>, <code>Y</code> and <code>Z</code>, the ones calculated in this routine are overwritten. This is useful for, for example, slab geometries.</li>
<li>The normalization factors are taken into account and the output is transformed back to unnormalized values.</li>
</ol>
</dd></dl>
<dl class="section return"><dt>Returns</dt><dd>ierr </dd></dl>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">grid</td><td>grid on which vector is calculated </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">grid_eq</td><td>grid on which equilibrium variables are calculated </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">eq_1</td><td>flux equilibrium quantities </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">eq_2</td><td>metric equilibrium variables </td></tr>
    <tr><td class="paramdir">[in,out]</td><td class="paramname">v_com</td><td>covariant and contravariant components <span class="tt">(dim1,dim2,dim3,3,2)</span> </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">norm_disc_prec</td><td>precision for normal derivatives </td></tr>
    <tr><td class="paramdir">[in,out]</td><td class="paramname">v_mag</td><td>magnitude <span class="tt">(dim1,dim2,dim3)</span> </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">base_name</td><td>base name for output plotting </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">max_transf</td><td>maximum transformation level (2: Magnetic, 3: Equilibrium, 4: Cylindrical, 5: Cartesian [def]) </td></tr>
    <tr><td class="paramdir">[in,out]</td><td class="paramname">v_flux_pol</td><td>poloidal flux as function of normal coordinate for all toroidal positions </td></tr>
    <tr><td class="paramdir">[in,out]</td><td class="paramname">v_flux_tor</td><td>toroidal flux as function of normal coordinate for all poloidal positions </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">xyz</td><td>\(X\), \(Y\) and \(Z\) of grid </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">compare_tor_pos</td><td>compare toroidal positions </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="grid__utilities_8f90_source.html#l01856">1856</a> of file <a class="el" href="grid__utilities_8f90_source.html">grid_utilities.f90</a>.</p>
<div id="dynsection-4" onclick="return dynsection.toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;"><span class="dynarrow"><span class="arrowhead closed"></span></span>Here is the call graph for this function:</div>
<div id="dynsection-4-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-4-content" class="dyncontent" style="display:none;">
<div class="center"><iframe scrolling="no" loading="lazy" frameborder="0" src="namespacegrid__utilities_ad5b259a284efcf05eb3fd5deaca19662_cgraph.svg" width="1174" height="484"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
<div id="dynsection-5" onclick="return dynsection.toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;"><span class="dynarrow"><span class="arrowhead closed"></span></span>Here is the caller graph for this function:</div>
<div id="dynsection-5-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-5-content" class="dyncontent" style="display:none;">
<div class="center"><iframe scrolling="no" loading="lazy" frameborder="0" src="namespacegrid__utilities_ad5b259a284efcf05eb3fd5deaca19662_icgraph.svg" width="888" height="247"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>

</div>
</div>
<a id="a904387b563db02ccf082e549730fd89b" name="a904387b563db02ccf082e549730fd89b"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a904387b563db02ccf082e549730fd89b">&#9670;&#160;</a></span>calc_xyz_grid()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">integer function, public grid_utilities::calc_xyz_grid </td>
          <td>(</td>
          <td class="paramtype">type(<a class="el" href="structgrid__vars_1_1grid__type.html">grid_type</a>), intent(in)</td>          <td class="paramname"><span class="paramname"><em>grid_eq</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">type(<a class="el" href="structgrid__vars_1_1grid__type.html">grid_type</a>), intent(in)</td>          <td class="paramname"><span class="paramname"><em>grid_xyz</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real(dp), dimension(:,:,:), intent(inout)</td>          <td class="paramname"><span class="paramname"><em>x</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real(dp), dimension(:,:,:), intent(inout)</td>          <td class="paramname"><span class="paramname"><em>y</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real(dp), dimension(:,:,:), intent(inout)</td>          <td class="paramname"><span class="paramname"><em>z</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real(dp), dimension(:,:,:), intent(inout), optional</td>          <td class="paramname"><span class="paramname"><em>l</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real(dp), dimension(:,:,:), intent(inout), optional</td>          <td class="paramname"><span class="paramname"><em>r</em></span>&#160;)</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Calculates \(X\), \(Y\) and \(Z\) on a grid <code>grid_XYZ</code>, determined through its E(quilibrium) coordinates. </p>
<p>Furthermore, a grid <code>grid_eq</code> must be provided, which is the grid in which the variables concerning \(R\) and \(Z\) are tabulated, i.e. the full equilibrium grid in E(quilibrium) coordinates.</p>
<p>Of this grid, however, only <code>r_E</code> is used, and the rest ignored. It can therefore be provided without the angular part, i.e. by reconstructing it with a subset.</p>
<p>If VMEC is the equilibrium model, this routine also optionally calculates \(\lambda\) on the grid, as this is also needed some times. for HELENA this variable is not used.</p>
<p>Optionally, \(R\) and \(\lambda\) (only for VMEC) can be returned.</p>
<dl class="section note"><dt>Note</dt><dd><ol type="1">
<li>For VMEC, the trigonometric factors of <code>grid_XYZ</code> must be calculated beforehand.</li>
<li>The normalization factor <code>R_0</code> for length is taken into account and the output is transformed back to unnormalized values.</li>
</ol>
</dd></dl>
<dl class="section return"><dt>Returns</dt><dd>ierr </dd></dl>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">grid_eq</td><td>equilibrium grid </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">grid_xyz</td><td>grid for which to calculate \(X\), \(Y\), \(Z\) and optionally \(L\) </td></tr>
    <tr><td class="paramdir">[in,out]</td><td class="paramname">x</td><td>\(X\) of grid </td></tr>
    <tr><td class="paramdir">[in,out]</td><td class="paramname">y</td><td>\(Y\) of grid </td></tr>
    <tr><td class="paramdir">[in,out]</td><td class="paramname">z</td><td>\(Z\) of grid </td></tr>
    <tr><td class="paramdir">[in,out]</td><td class="paramname">l</td><td>\(\lambda\) of grid </td></tr>
    <tr><td class="paramdir">[in,out]</td><td class="paramname">r</td><td>\(R\) of grid </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="grid__utilities_8f90_source.html#l00798">798</a> of file <a class="el" href="grid__utilities_8f90_source.html">grid_utilities.f90</a>.</p>
<div id="dynsection-6" onclick="return dynsection.toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;"><span class="dynarrow"><span class="arrowhead closed"></span></span>Here is the caller graph for this function:</div>
<div id="dynsection-6-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-6-content" class="dyncontent" style="display:none;">
<div class="center"><iframe scrolling="no" loading="lazy" frameborder="0" src="namespacegrid__utilities_a904387b563db02ccf082e549730fd89b_icgraph.svg" width="1174" height="559"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>

</div>
</div>
<a id="a95c875f5ded5852b27f73141c74a0ef6" name="a95c875f5ded5852b27f73141c74a0ef6"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a95c875f5ded5852b27f73141c74a0ef6">&#9670;&#160;</a></span>copy_grid()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">integer function, public grid_utilities::copy_grid </td>
          <td>(</td>
          <td class="paramtype">class(<a class="el" href="structgrid__vars_1_1grid__type.html">grid_type</a>), intent(in)</td>          <td class="paramname"><span class="paramname"><em>grid_a</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">class(<a class="el" href="structgrid__vars_1_1grid__type.html">grid_type</a>), intent(inout)</td>          <td class="paramname"><span class="paramname"><em>grid_b</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">integer, dimension(3,2), intent(in), optional</td>          <td class="paramname"><span class="paramname"><em>lims_b</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">integer, dimension(2), intent(in), optional</td>          <td class="paramname"><span class="paramname"><em>i_lim</em></span>&#160;)</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Copy a grid A to a new grid B, that was not yet initialized. </p>
<p>This new grid can contain a subsection of the previous grid in all dimensions. It can also be a divided grid, by providing the limits</p>
<dl class="section note"><dt>Note</dt><dd><ol type="1">
<li>The normal limits for the divided grid should be given in terms of the normal dimension of <code>grid</code> B.</li>
<li>if the grids are not purely normal, the procedure can currently only handle the copying of a <code>grid_A</code> that is not divided.</li>
</ol>
</dd></dl>
<dl class="section return"><dt>Returns</dt><dd>ierr </dd></dl>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">grid_a</td><td>grid to be initialized </td></tr>
    <tr><td class="paramdir">[in,out]</td><td class="paramname">grid_b</td><td>grid to be initialized </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">lims_b</td><td>ranges for subset of grid </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">i_lim</td><td>min. and max. local normal index </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="grid__utilities_8f90_source.html#l01188">1188</a> of file <a class="el" href="grid__utilities_8f90_source.html">grid_utilities.f90</a>.</p>
<div id="dynsection-7" onclick="return dynsection.toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;"><span class="dynarrow"><span class="arrowhead closed"></span></span>Here is the caller graph for this function:</div>
<div id="dynsection-7-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-7-content" class="dyncontent" style="display:none;">
<div class="center"><iframe scrolling="no" loading="lazy" frameborder="0" src="namespacegrid__utilities_a95c875f5ded5852b27f73141c74a0ef6_icgraph.svg" width="736" height="91"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>

</div>
</div>
<a id="a414a1a11924bc935afca3a89fc31f2f5" name="a414a1a11924bc935afca3a89fc31f2f5"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a414a1a11924bc935afca3a89fc31f2f5">&#9670;&#160;</a></span>extend_grid_f()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">integer function, public grid_utilities::extend_grid_f </td>
          <td>(</td>
          <td class="paramtype">type(<a class="el" href="structgrid__vars_1_1grid__type.html">grid_type</a>), intent(in)</td>          <td class="paramname"><span class="paramname"><em>grid_in</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">type(<a class="el" href="structgrid__vars_1_1grid__type.html">grid_type</a>), intent(inout)</td>          <td class="paramname"><span class="paramname"><em>grid_ext</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">type(<a class="el" href="structgrid__vars_1_1grid__type.html">grid_type</a>), intent(in), optional</td>          <td class="paramname"><span class="paramname"><em>grid_eq</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">integer, intent(in), optional</td>          <td class="paramname"><span class="paramname"><em>n_theta_plot</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">integer, intent(in), optional</td>          <td class="paramname"><span class="paramname"><em>n_zeta_plot</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real(dp), dimension(2), intent(in), optional</td>          <td class="paramname"><span class="paramname"><em>lim_theta_plot</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real(dp), dimension(2), intent(in), optional</td>          <td class="paramname"><span class="paramname"><em>lim_zeta_plot</em></span>&#160;)</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Extend a grid angularly. </p>
<p>This is done using equidistant variables of <code>n_theta_plot</code> and <code>n_zeta_plot</code> angular and own <code>loc_n_r</code> points in F coordinates.</p>
<p>Optionally, the grid can also be converted to E coordinates if the equilibrium grid is provided. This is required for many operations, such as the calculation of \(X\), \(Y\) and \(Z\) through calc_XYZ_grid().</p>
<dl class="section note"><dt>Note</dt><dd>For VMEC, it can be slow, as <a class="el" href="interfacegrid__utilities_1_1coord__f2e.html" title="Converts Flux coordinates  to Equilibrium coordinates .">grid_utilities.coord_f2e()</a> is used.</dd></dl>
<dl class="section return"><dt>Returns</dt><dd>ierr </dd></dl>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">grid_in</td><td>grid to be extended </td></tr>
    <tr><td class="paramdir">[in,out]</td><td class="paramname">grid_ext</td><td>extended grid </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">grid_eq</td><td>equilibrium grid </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">n_theta_plot</td><td>number of poins in theta direction </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">n_zeta_plot</td><td>number of poins in zeta direction </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">lim_theta_plot</td><td>limits in theta </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">lim_zeta_plot</td><td>limits in zeta </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="grid__utilities_8f90_source.html#l01094">1094</a> of file <a class="el" href="grid__utilities_8f90_source.html">grid_utilities.f90</a>.</p>
<div id="dynsection-8" onclick="return dynsection.toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;"><span class="dynarrow"><span class="arrowhead closed"></span></span>Here is the call graph for this function:</div>
<div id="dynsection-8-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-8-content" class="dyncontent" style="display:none;">
<div class="center"><iframe scrolling="no" loading="lazy" frameborder="0" src="namespacegrid__utilities_a414a1a11924bc935afca3a89fc31f2f5_cgraph.svg" width="920" height="230"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
<div id="dynsection-9" onclick="return dynsection.toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;"><span class="dynarrow"><span class="arrowhead closed"></span></span>Here is the caller graph for this function:</div>
<div id="dynsection-9-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-9-content" class="dyncontent" style="display:none;">
<div class="center"><iframe scrolling="no" loading="lazy" frameborder="0" src="namespacegrid__utilities_a414a1a11924bc935afca3a89fc31f2f5_icgraph.svg" width="896" height="143"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>

</div>
</div>
<a id="a169b137ec246579a2fa94fa4612104d1" name="a169b137ec246579a2fa94fa4612104d1"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a169b137ec246579a2fa94fa4612104d1">&#9670;&#160;</a></span>find_compr_range()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">subroutine, public grid_utilities::find_compr_range </td>
          <td>(</td>
          <td class="paramtype">real(dp), dimension(:), intent(in)</td>          <td class="paramname"><span class="paramname"><em>r_f</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real(dp), dimension(2), intent(in)</td>          <td class="paramname"><span class="paramname"><em>lim_r</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">integer, dimension(2), intent(inout)</td>          <td class="paramname"><span class="paramname"><em>lim_id</em></span>&#160;)</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>finds smallest range that comprises a minimum and maximum value. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">r_f</td><td>all values of coordinate </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">lim_r</td><td>limiting range </td></tr>
    <tr><td class="paramdir">[in,out]</td><td class="paramname">lim_id</td><td>limiting indices </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="grid__utilities_8f90_source.html#l02994">2994</a> of file <a class="el" href="grid__utilities_8f90_source.html">grid_utilities.f90</a>.</p>
<div id="dynsection-10" onclick="return dynsection.toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;"><span class="dynarrow"><span class="arrowhead closed"></span></span>Here is the caller graph for this function:</div>
<div id="dynsection-10-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-10-content" class="dyncontent" style="display:none;">
<div class="center"><iframe scrolling="no" loading="lazy" frameborder="0" src="namespacegrid__utilities_a169b137ec246579a2fa94fa4612104d1_icgraph.svg" width="1363" height="311"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>

</div>
</div>
<a id="ae8cbf5a9167339a1f5a2ba07a03d20e2" name="ae8cbf5a9167339a1f5a2ba07a03d20e2"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ae8cbf5a9167339a1f5a2ba07a03d20e2">&#9670;&#160;</a></span>nufft()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">integer function, public grid_utilities::nufft </td>
          <td>(</td>
          <td class="paramtype">real(dp), dimension(:), intent(in)</td>          <td class="paramname"><span class="paramname"><em>x</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real(dp), dimension(:), intent(in)</td>          <td class="paramname"><span class="paramname"><em>f</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real(dp), dimension(:,:), intent(inout), allocatable</td>          <td class="paramname"><span class="paramname"><em>f_f</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">character(len=*), intent(in), optional</td>          <td class="paramname"><span class="paramname"><em>plot_name</em></span>&#160;)</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>calculates the cosine and sine mode numbers of a function defined on a non-regular grid. </p>
<p>If a plot name is provided, the modes are plotted.</p>
<dl class="section note"><dt>Note</dt><dd>The fundamental interval is assumed to be \(0\ldots  2\pi\) but there should be no overlap between the first and last point.</dd></dl>
<dl class="section return"><dt>Returns</dt><dd>ierr </dd></dl>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">x</td><td>coordinate values </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">f</td><td>function values </td></tr>
    <tr><td class="paramdir">[in,out]</td><td class="paramname">f_f</td><td>Fourier modes for \(\cos\) and \(\sin\) </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">plot_name</td><td>name of possible plot </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="grid__utilities_8f90_source.html#l02900">2900</a> of file <a class="el" href="grid__utilities_8f90_source.html">grid_utilities.f90</a>.</p>
<div id="dynsection-11" onclick="return dynsection.toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;"><span class="dynarrow"><span class="arrowhead closed"></span></span>Here is the call graph for this function:</div>
<div id="dynsection-11-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-11-content" class="dyncontent" style="display:none;">
<div class="center"><iframe scrolling="no" loading="lazy" frameborder="0" src="namespacegrid__utilities_ae8cbf5a9167339a1f5a2ba07a03d20e2_cgraph.svg" width="1134" height="315"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
<div id="dynsection-12" onclick="return dynsection.toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;"><span class="dynarrow"><span class="arrowhead closed"></span></span>Here is the caller graph for this function:</div>
<div id="dynsection-12-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-12-content" class="dyncontent" style="display:none;">
<div class="center"><iframe scrolling="no" loading="lazy" frameborder="0" src="namespacegrid__utilities_ae8cbf5a9167339a1f5a2ba07a03d20e2_icgraph.svg" width="896" height="242"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>

</div>
</div>
<a id="a67001ff9bbcad707aacf17f90a748d90" name="a67001ff9bbcad707aacf17f90a748d90"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a67001ff9bbcad707aacf17f90a748d90">&#9670;&#160;</a></span>trim_grid()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">integer function, public grid_utilities::trim_grid </td>
          <td>(</td>
          <td class="paramtype">type(<a class="el" href="structgrid__vars_1_1grid__type.html">grid_type</a>), intent(in)</td>          <td class="paramname"><span class="paramname"><em>grid_in</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">type(<a class="el" href="structgrid__vars_1_1grid__type.html">grid_type</a>), intent(inout)</td>          <td class="paramname"><span class="paramname"><em>grid_out</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">integer, dimension(2), intent(inout), optional</td>          <td class="paramname"><span class="paramname"><em>norm_id</em></span>&#160;)</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Trim a grid, removing any overlap between the different regions. </p>
<p>by default, the routine assumes a symmetric ghost region and cuts as many grid points from the end of the previous process as from the beginning of the next process, but if the number of overlapping grid points is odd, the next process looses one more point.</p>
<p>optionally, the trimmed indices in the normal direction can be provided in <code>norm_id</code>, i.e. the indices in the old, untrimmed grid that correspond to the start and end indices of the trimmed grid. E.g. if</p><ul>
<li>proc 0: 3 ... 25</li>
<li>proc 1: 20 ... 50</li>
</ul>
<p>then the trimmed grid will be:</p><ul>
<li>proc 0: 3 ... 22</li>
<li>proc 1: 23 ... 50</li>
</ul>
<p>which is shifted down by 2 to</p><ul>
<li>proc 0: 1 ... 20</li>
<li>proc 1: 21 ... 48</li>
</ul>
<p>in the trimmed grid. The indices of the previous step (3 &amp; 22 and 23 &amp; 50) are saved in <code>norm_id</code>.</p>
<dl class="section return"><dt>Returns</dt><dd>ierr </dd></dl>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">grid_in</td><td>input grid </td></tr>
    <tr><td class="paramdir">[in,out]</td><td class="paramname">grid_out</td><td>trimmed grid </td></tr>
    <tr><td class="paramdir">[in,out]</td><td class="paramname">norm_id</td><td>normal indices corresponding to trimmed part </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="grid__utilities_8f90_source.html#l01635">1635</a> of file <a class="el" href="grid__utilities_8f90_source.html">grid_utilities.f90</a>.</p>
<div id="dynsection-13" onclick="return dynsection.toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;"><span class="dynarrow"><span class="arrowhead closed"></span></span>Here is the caller graph for this function:</div>
<div id="dynsection-13-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-13-content" class="dyncontent" style="display:none;">
<div class="center"><iframe scrolling="no" loading="lazy" frameborder="0" src="namespacegrid__utilities_a67001ff9bbcad707aacf17f90a748d90_icgraph.svg" width="1246" height="1644"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>

</div>
</div>
<a id="a4679f24af8e02793070f4e27b43e00b6" name="a4679f24af8e02793070f4e27b43e00b6"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a4679f24af8e02793070f4e27b43e00b6">&#9670;&#160;</a></span>untrim_grid()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">integer function, public grid_utilities::untrim_grid </td>
          <td>(</td>
          <td class="paramtype">type(<a class="el" href="structgrid__vars_1_1grid__type.html">grid_type</a>), intent(in)</td>          <td class="paramname"><span class="paramname"><em>grid_in</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">type(<a class="el" href="structgrid__vars_1_1grid__type.html">grid_type</a>), intent(inout)</td>          <td class="paramname"><span class="paramname"><em>grid_out</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">integer, intent(in)</td>          <td class="paramname"><span class="paramname"><em>size_ghost</em></span>&#160;)</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Untrims a trimmed grid by introducing an asymmetric ghost regions at the right. </p>
<p>The width of the ghost region has to be provided.</p>
<dl class="section note"><dt>Note</dt><dd><ol type="1">
<li>the ghosted grid should be deallocated (with dealloc_grid()).</li>
<li>the input grid has to be trimmed.</li>
</ol>
</dd></dl>
<dl class="section return"><dt>Returns</dt><dd>ierr </dd></dl>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">grid_in</td><td>input grid </td></tr>
    <tr><td class="paramdir">[in,out]</td><td class="paramname">grid_out</td><td>ghosted grid </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">size_ghost</td><td>width of ghost region </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="grid__utilities_8f90_source.html#l01763">1763</a> of file <a class="el" href="grid__utilities_8f90_source.html">grid_utilities.f90</a>.</p>
<div id="dynsection-14" onclick="return dynsection.toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;"><span class="dynarrow"><span class="arrowhead closed"></span></span>Here is the caller graph for this function:</div>
<div id="dynsection-14-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-14-content" class="dyncontent" style="display:none;">
<div class="center"><iframe scrolling="no" loading="lazy" frameborder="0" src="namespacegrid__utilities_a4679f24af8e02793070f4e27b43e00b6_icgraph.svg" width="920" height="56"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>

</div>
</div>
<a name="doc-var-members" id="doc-var-members"></a><h2 id="header-doc-var-members" class="groupheader">Variable Documentation</h2>
<a id="a0743c0341d508034b14aee614fa4f8a9" name="a0743c0341d508034b14aee614fa4f8a9"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a0743c0341d508034b14aee614fa4f8a9">&#9670;&#160;</a></span>debug_calc_int_vol</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">logical, public grid_utilities::debug_calc_int_vol = .false.</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>plot debug information for <a class="el" href="#af08c7fe5a537be1a8fa3eba462c77e7e" title="Calculates volume integral on a 3D grid.">calc_int_vol()</a> </p>
<dl class="section note"><dt>Note</dt><dd>Debug version only </dd></dl>

<p class="definition">Definition at line <a class="el" href="grid__utilities_8f90_source.html#l00025">25</a> of file <a class="el" href="grid__utilities_8f90_source.html">grid_utilities.f90</a>.</p>

</div>
</div>
<a id="ab420036236dc8a9a69e180550499d95b" name="ab420036236dc8a9a69e180550499d95b"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ab420036236dc8a9a69e180550499d95b">&#9670;&#160;</a></span>debug_calc_vec_comp</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">logical, public grid_utilities::debug_calc_vec_comp = .false.</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>plot debug information for <a class="el" href="#ad5b259a284efcf05eb3fd5deaca19662" title="Calculates contra- and covariant components of a vector in multiple coordinate systems.">calc_vec_comp()</a> </p>
<dl class="section note"><dt>Note</dt><dd>Debug version only </dd></dl>

<p class="definition">Definition at line <a class="el" href="grid__utilities_8f90_source.html#l00027">27</a> of file <a class="el" href="grid__utilities_8f90_source.html">grid_utilities.f90</a>.</p>

</div>
</div>
</div><!-- contents -->
<!-- HTML footer for doxygen 1.8.13-->
<!-- start footer part -->
<address class="footer"><small>
<center>this documentation was created with <a href="http://www.doxygen.org/index.html">Doxygen 1.16.1</a> by <a href="mailto:weyenst@gmail.com">Toon Weyens</a></center>
</small></address>
</body>
</html>
